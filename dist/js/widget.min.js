var WIDGET_COMMON_CONFIG={AUTH_PATH_URL:"v1/widget/auth",LOGGER_CLIENT_ID:"1088527147109-6q1o2vtihn34292pjt4ckhmhck0rk0o7.apps.googleusercontent.com",LOGGER_CLIENT_SECRET:"nlZyrcPLg6oEwO9f9Wfn29Wh",LOGGER_REFRESH_TOKEN:"1/xzt4kwzE1H7W9VnKB8cAaCx6zb4Es4nKEoqaYHdTD15IgOrJDtdun6zK6XiATCKT",STORAGE_ENV:"prod",STORE_URL:"https://store-dot-rvaserver2.appspot.com/"},RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.LoggerUtils=function(){"use strict";function e(e,t){var i=null;e.event?(i=e,i.file_url&&(i.file_format=n(i.file_url)),i.company_id=a,i.display_id=r,t(i)):t(i)}function t(){var e=new Date,t=e.getUTCFullYear(),n=e.getUTCMonth()+1,i=e.getUTCDate();return 10>n&&(n="0"+n),10>i&&(i="0"+i),t+n+i}function n(e){var t,n=/[?#&]/;return e&&"string"==typeof e?(t=e.substr(e.lastIndexOf(".")+1),n.test(t)&&(t=t.substr(0,-1!==t.indexOf("?")?t.indexOf("?"):t.length),t=t.substr(0,-1!==t.indexOf("#")?t.indexOf("#"):t.length),t=t.substr(0,-1!==t.indexOf("&")?t.indexOf("&"):t.length)),t.toLowerCase()):null}function i(e){var n={kind:"bigquery#tableDataInsertAllRequest",skipInvalidRows:!1,ignoreUnknownValues:!1,templateSuffix:t(),rows:[{insertId:""}]},i=JSON.parse(JSON.stringify(n));return i.rows[0].insertId=Math.random().toString(36).substr(2).toUpperCase(),i.rows[0].json=JSON.parse(JSON.stringify(e)),i.rows[0].json.ts=(new Date).toISOString(),i}function s(t,n){e(n,function(e){null!==e&&RiseVision.Common.Logger.log(t,e)})}function o(e,t){a=e,r=t}var r="",a="";return{getInsertData:i,getFileFormat:n,logEvent:s,setIds:o}}(),RiseVision.Common.Logger=function(e){"use strict";function t(e){var t=new XMLHttpRequest;return new Date-c<358e4?e({}):(t.open("POST",s,!0),t.onloadend=function(){var n=JSON.parse(t.response);e({token:n.access_token,refreshedAt:new Date})},t.send(),void 0)}function n(e){return r&&l===e}function i(i,s){function g(t){var n,r,a=new XMLHttpRequest;r=o.replace("TABLE_ID",i),c=t.refreshedAt||c,u=t.token||u,n=e.getInsertData(s),a.open("POST",r,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Authorization","Bearer "+u),s.cb&&"function"==typeof s.cb&&(a.onloadend=function(){s.cb(a.response)}),a.send(JSON.stringify(n))}if(!(!i||!s||s.hasOwnProperty("event")&&!s.event||s.hasOwnProperty("event")&&n(s.event)))return r=!0,l=s.event,setTimeout(function(){r=!1},a),t(g)}var s="https://www.googleapis.com/oauth2/v3/token?client_id="+WIDGET_COMMON_CONFIG.LOGGER_CLIENT_ID+"&client_secret="+WIDGET_COMMON_CONFIG.LOGGER_CLIENT_SECRET+"&refresh_token="+WIDGET_COMMON_CONFIG.LOGGER_REFRESH_TOKEN+"&grant_type=refresh_token",o="https://www.googleapis.com/bigquery/v2/projects/client-side-events/datasets/Widget_Events/tables/TABLE_ID/insertAll",r=!1,a=1e3,l="",c=0,u="";return{log:i}}(RiseVision.Common.LoggerUtils),"undefined"!=typeof angular&&angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","locales/translation_").constant("LOCALES_SUFIX",".json");var config={STORAGE_ENV:"prod"},RiseVision=RiseVision||{};RiseVision.WebPage={},RiseVision.WebPage=function(e,t){"use strict";function n(){t.rpc.call("","rsevent_ready",null,f.getString("id"),!0,!0,!0,!0,!1)}function i(e){function t(t){var n=!0,i=t.target.getResponseHeader("X-Frame-Options");i&&"SAMEORIGIN"===i.toUpperCase()&&(n=!1,y.show("Please note that the X-Frame-Options header has been detected in the request response for the web page provided and will prevent the web page from appearing.")),e&&"function"==typeof e&&e(n)}var n="https://proxy.risevision.com/"+v,i=new XMLHttpRequest;i.addEventListener("load",t),i.open("GET",n),i.send()}function s(){var t=e.getElementById("container"),n=e.getElementById("webpage-frame"),i=f.getInt("rsH")/f.getInt("rsW")*100;t&&n&&(t.style.visibility="hidden",t.setAttribute("style","padding-bottom:"+i+"%"))}function o(){var t=e.getElementById("webpage-frame"),n=e.getElementById("container");n&&t&&(t.onload=function(){t.onload=null,n.style.visibility="visible"},t.setAttribute("src",v))}function r(){var t=e.getElementById("webpage-frame");t&&(t.src="about:blank")}function a(){y=new RiseVision.Common.Message(e.getElementById("container"),e.getElementById("messageContainer")),v=m.url,-1===v.indexOf("://")&&(v="http://"+v),i(function(e){e&&s(),n()})}function l(){return"webpage_events"}function c(e){RiseVision.Common.LoggerUtils.logEvent(l(),e)}function u(){r()}function g(){o()}function d(){u()}function p(e){m=JSON.parse(JSON.stringify(e)),a()}var f=new t.Prefs,m=null,v="",y=null;return{getTableName:l,logEvent:c,setAdditionalParams:p,pause:u,play:g,stop:d}}(document,gadgets);var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Message=function(e,t){"use strict";function n(){try{t.style.height=e.style.height}catch(n){console.warn("Can't initialize Message - ",n.message)}}function i(){if(o){for(;t.firstChild;)t.removeChild(t.firstChild);t.style.display="none",e.style.visibility="visible",o=!1}}function s(n){var i,s=document.createDocumentFragment();o?(i=t.querySelector(".message"),i.innerHTML=n):(e.style.visibility="hidden",t.style.display="block",i=document.createElement("p"),i.innerHTML=n,i.setAttribute("class","message"),s.appendChild(i),t.appendChild(s),o=!0)}var o=!1;return n(),{hide:i,show:s}},function(e,t,n){"use strict";function i(e,t){var n,i="",s="";Array.isArray(e)&&e.length>0&&Array.isArray(t)&&t.length>0&&("companyId"===e[0]&&(i=t[0]),"displayId"===e[1]&&(s=t[1]?t[1]:"preview"),RiseVision.Common.LoggerUtils.setIds(i,s),"additionalParams"===e[2]&&(n=JSON.parse(t[2]),RiseVision.WebPage.setAdditionalParams(n)))}function s(){RiseVision.WebPage.play()}function o(){RiseVision.WebPage.pause()}function r(){RiseVision.WebPage.stop()}var a=(new n.Prefs).getString("id");e.oncontextmenu=function(){return!1},t.body.onmousedown=function(){return!1},a&&""!==a&&(n.rpc.register("rscmd_play_"+a,s),n.rpc.register("rscmd_pause_"+a,o),n.rpc.register("rscmd_stop_"+a,r),n.rpc.register("rsparam_set_"+a,i),n.rpc.call("","rsparam_get",null,a,["companyId","displayId","additionalParams"]))}(window,document,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-6"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsiV0lER0VUX0NPTU1PTl9DT05GSUciLCJBVVRIX1BBVEhfVVJMIiwiTE9HR0VSX0NMSUVOVF9JRCIsIkxPR0dFUl9DTElFTlRfU0VDUkVUIiwiTE9HR0VSX1JFRlJFU0hfVE9LRU4iLCJTVE9SQUdFX0VOViIsIlNUT1JFX1VSTCIsIlJpc2VWaXNpb24iLCJDb21tb24iLCJMb2dnZXJVdGlscyIsImdldEV2ZW50UGFyYW1zIiwicGFyYW1zIiwiY2IiLCJqc29uIiwiZXZlbnQiLCJmaWxlX3VybCIsImZpbGVfZm9ybWF0IiwiZ2V0RmlsZUZvcm1hdCIsImNvbXBhbnlfaWQiLCJjb21wYW55SWQiLCJkaXNwbGF5X2lkIiwiZGlzcGxheUlkIiwiZ2V0U3VmZml4IiwiZGF0ZSIsIkRhdGUiLCJ5ZWFyIiwiZ2V0VVRDRnVsbFllYXIiLCJtb250aCIsImdldFVUQ01vbnRoIiwiZGF5IiwiZ2V0VVRDRGF0ZSIsInVybCIsInN0ciIsImhhc1BhcmFtcyIsInN1YnN0ciIsImxhc3RJbmRleE9mIiwidGVzdCIsImluZGV4T2YiLCJsZW5ndGgiLCJ0b0xvd2VyQ2FzZSIsImdldEluc2VydERhdGEiLCJCQVNFX0lOU0VSVF9TQ0hFTUEiLCJraW5kIiwic2tpcEludmFsaWRSb3dzIiwiaWdub3JlVW5rbm93blZhbHVlcyIsInRlbXBsYXRlU3VmZml4Iiwicm93cyIsImluc2VydElkIiwiZGF0YSIsIkpTT04iLCJwYXJzZSIsInN0cmluZ2lmeSIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInRvVXBwZXJDYXNlIiwidHMiLCJ0b0lTT1N0cmluZyIsImxvZ0V2ZW50IiwidGFibGUiLCJMb2dnZXIiLCJsb2ciLCJzZXRJZHMiLCJjb21wYW55IiwiZGlzcGxheSIsInV0aWxzIiwicmVmcmVzaFRva2VuIiwieGhyIiwiWE1MSHR0cFJlcXVlc3QiLCJyZWZyZXNoRGF0ZSIsIm9wZW4iLCJSRUZSRVNIX1VSTCIsIm9ubG9hZGVuZCIsInJlc3AiLCJyZXNwb25zZSIsInRva2VuIiwiYWNjZXNzX3Rva2VuIiwicmVmcmVzaGVkQXQiLCJzZW5kIiwiaXNUaHJvdHRsZWQiLCJ0aHJvdHRsZSIsImxhc3RFdmVudCIsInRhYmxlTmFtZSIsImluc2VydFdpdGhUb2tlbiIsInJlZnJlc2hEYXRhIiwiaW5zZXJ0RGF0YSIsInNlcnZpY2VVcmwiLCJyZXBsYWNlIiwic2V0UmVxdWVzdEhlYWRlciIsImhhc093blByb3BlcnR5Iiwic2V0VGltZW91dCIsInRocm90dGxlRGVsYXkiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uc3RhbnQiLCJjb25maWciLCJXZWJQYWdlIiwiZG9jdW1lbnQiLCJnYWRnZXRzIiwiX3JlYWR5IiwicnBjIiwiY2FsbCIsIl9wcmVmcyIsImdldFN0cmluZyIsIl92YWxpZGF0ZVVybCIsImhhbmRsZVByb3h5UmVzcG9uc2UiLCJlIiwic3VjY2VzcyIsImhlYWRlciIsInRhcmdldCIsImdldFJlc3BvbnNlSGVhZGVyIiwiX21lc3NhZ2UiLCJzaG93IiwicHJveHlVcmwiLCJfdXJsIiwicmVxdWVzdCIsImFkZEV2ZW50TGlzdGVuZXIiLCJfY29uZmlndXJlUGFnZSIsImNvbnRhaW5lciIsImdldEVsZW1lbnRCeUlkIiwiZnJhbWUiLCJhc3BlY3RSYXRpbyIsImdldEludCIsInN0eWxlIiwidmlzaWJpbGl0eSIsInNldEF0dHJpYnV0ZSIsIl9sb2FkRnJhbWUiLCJvbmxvYWQiLCJfdW5sb2FkRnJhbWUiLCJzcmMiLCJfaW5pdCIsIk1lc3NhZ2UiLCJfYWRkaXRpb25hbFBhcmFtcyIsImdldFRhYmxlTmFtZSIsInBhdXNlIiwicGxheSIsInN0b3AiLCJzZXRBZGRpdGlvbmFsUGFyYW1zIiwiYWRkaXRpb25hbFBhcmFtcyIsIlByZWZzIiwibWFpbkNvbnRhaW5lciIsIm1lc3NhZ2VDb250YWluZXIiLCJoZWlnaHQiLCJjb25zb2xlIiwid2FybiIsIm1lc3NhZ2UiLCJoaWRlIiwiX2FjdGl2ZSIsImZpcnN0Q2hpbGQiLCJyZW1vdmVDaGlsZCIsInAiLCJmcmFnbWVudCIsImNyZWF0ZURvY3VtZW50RnJhZ21lbnQiLCJxdWVyeVNlbGVjdG9yIiwiaW5uZXJIVE1MIiwiY3JlYXRlRWxlbWVudCIsImFwcGVuZENoaWxkIiwid2luZG93IiwiY29uZmlndXJlIiwibmFtZXMiLCJ2YWx1ZXMiLCJBcnJheSIsImlzQXJyYXkiLCJpZCIsIm9uY29udGV4dG1lbnUiLCJib2R5Iiwib25tb3VzZWRvd24iLCJyZWdpc3RlciIsIl9nYXEiLCJwdXNoIiwiZ2EiLCJ0eXBlIiwiYXN5bmMiLCJsb2NhdGlvbiIsInByb3RvY29sIiwicyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwicGFyZW50Tm9kZSIsImluc2VydEJlZm9yZSJdLCJtYXBwaW5ncyI6IkFBQ0EsR0FBSUEsdUJBQ0ZDLGNBQWUsaUJBQ2ZDLGlCQUFrQiw0RUFDbEJDLHFCQUFzQiwyQkFDdEJDLHFCQUFzQixxRUFDdEJDLFlBQWEsT0FDYkMsVUFBVyw2Q0FJVEMsV0FBYUEsY0FDakJBLFlBQVdDLE9BQVNELFdBQVdDLFdBRS9CRCxXQUFXQyxPQUFPQyxZQUFjLFdBQzlCLFlBVUEsU0FBU0MsR0FBZUMsRUFBUUMsR0FDOUIsR0FBSUMsR0FBTyxJQUdQRixHQUFPRyxPQUNURCxFQUFPRixFQUVIRSxFQUFLRSxXQUNQRixFQUFLRyxZQUFjQyxFQUFjSixFQUFLRSxXQUd4Q0YsRUFBS0ssV0FBYUMsRUFDbEJOLEVBQUtPLFdBQWFDLEVBRWxCVCxFQUFHQyxJQUdIRCxFQUFHQyxHQUtQLFFBQVNTLEtBQ1AsR0FBSUMsR0FBTyxHQUFJQyxNQUNiQyxFQUFPRixFQUFLRyxpQkFDWkMsRUFBUUosRUFBS0ssY0FBZ0IsRUFDN0JDLEVBQU1OLEVBQUtPLFlBVWIsT0FSWSxJQUFSSCxJQUNGQSxFQUFRLElBQU1BLEdBR04sR0FBTkUsSUFDRkEsRUFBTSxJQUFNQSxHQUdQSixFQUFPRSxFQUFRRSxFQU14QixRQUFTWixHQUFjYyxHQUNyQixHQUNFQyxHQURFQyxFQUFZLE9BR2hCLE9BQUtGLElBQXNCLGdCQUFSQSxJQUluQkMsRUFBTUQsRUFBSUcsT0FBT0gsRUFBSUksWUFBWSxLQUFPLEdBR3BDRixFQUFVRyxLQUFLSixLQUNqQkEsRUFBTUEsRUFBSUUsT0FBTyxFQUF5QixLQUFyQkYsRUFBSUssUUFBUSxLQUFlTCxFQUFJSyxRQUFRLEtBQU9MLEVBQUlNLFFBRXZFTixFQUFNQSxFQUFJRSxPQUFPLEVBQXlCLEtBQXJCRixFQUFJSyxRQUFRLEtBQWVMLEVBQUlLLFFBQVEsS0FBT0wsRUFBSU0sUUFFdkVOLEVBQU1BLEVBQUlFLE9BQU8sRUFBeUIsS0FBckJGLEVBQUlLLFFBQVEsS0FBZUwsRUFBSUssUUFBUSxLQUFPTCxFQUFJTSxTQUdsRU4sRUFBSU8sZUFkRixLQWlCWCxRQUFTQyxHQUFjN0IsR0FDckIsR0FBSThCLElBQ0ZDLEtBQVEscUNBQ1JDLGlCQUFtQixFQUNuQkMscUJBQXVCLEVBQ3ZCQyxlQUFrQnZCLElBQ2xCd0IsT0FDRUMsU0FBWSxNQUdoQkMsRUFBT0MsS0FBS0MsTUFBTUQsS0FBS0UsVUFBVVYsR0FNakMsT0FKQU8sR0FBS0YsS0FBSyxHQUFHQyxTQUFXSyxLQUFLQyxTQUFTQyxTQUFTLElBQUlwQixPQUFPLEdBQUdxQixjQUM3RFAsRUFBS0YsS0FBSyxHQUFHakMsS0FBT29DLEtBQUtDLE1BQU1ELEtBQUtFLFVBQVV4QyxJQUM5Q3FDLEVBQUtGLEtBQUssR0FBR2pDLEtBQUsyQyxJQUFLLEdBQUloQyxPQUFPaUMsY0FFM0JULEVBR1QsUUFBU1UsR0FBU0MsRUFBT2hELEdBQ3ZCRCxFQUFlQyxFQUFRLFNBQVNFLEdBQ2pCLE9BQVRBLEdBQ0ZOLFdBQVdDLE9BQU9vRCxPQUFPQyxJQUFJRixFQUFPOUMsS0FNMUMsUUFBU2lELEdBQU9DLEVBQVNDLEdBQ3ZCN0MsRUFBWTRDLEVBQ1oxQyxFQUFZMkMsRUF0R2IsR0FBSTNDLEdBQVksR0FDZkYsRUFBWSxFQXdHZCxRQUNFcUIsY0FBaUJBLEVBQ2pCdkIsY0FBaUJBLEVBQ2pCeUMsU0FBWUEsRUFDWkksT0FBVUEsTUFJZHZELFdBQVdDLE9BQU9vRCxPQUFTLFNBQVVLLEdBQ25DLFlBaUJBLFNBQVNDLEdBQWF0RCxHQUNwQixHQUFJdUQsR0FBTSxHQUFJQyxlQUVkLE9BQUksSUFBSTVDLE1BQVM2QyxFQUFjLE1BQ3RCekQsT0FHVHVELEVBQUlHLEtBQUssT0FBUUMsR0FBYSxHQUM5QkosRUFBSUssVUFBWSxXQUNkLEdBQUlDLEdBQU94QixLQUFLQyxNQUFNaUIsRUFBSU8sU0FFMUI5RCxJQUFLK0QsTUFBT0YsRUFBS0csYUFBY0MsWUFBYSxHQUFJckQsU0FHbEQyQyxFQUFJVyxPQVBKWCxRQVVGLFFBQVNZLEdBQVlqRSxHQUNuQixNQUFPa0UsSUFBYUMsSUFBY25FLEVBTXBDLFFBQVMrQyxHQUFJcUIsRUFBV3ZFLEdBYXRCLFFBQVN3RSxHQUFnQkMsR0FDdkIsR0FDRUMsR0FBWXRELEVBRFZvQyxFQUFNLEdBQUlDLGVBR2RyQyxHQUFNdUQsRUFBV0MsUUFBUSxXQUFZTCxHQUNyQ2IsRUFBY2UsRUFBWVAsYUFBZVIsRUFDekNNLEVBQVFTLEVBQVlULE9BQVNBLEVBQzdCVSxFQUFhcEIsRUFBTXpCLGNBQWM3QixHQUdqQ3dELEVBQUlHLEtBQUssT0FBUXZDLEdBQUssR0FDdEJvQyxFQUFJcUIsaUJBQWlCLGVBQWdCLG9CQUNyQ3JCLEVBQUlxQixpQkFBaUIsZ0JBQWlCLFVBQVliLEdBRTlDaEUsRUFBT0MsSUFBMkIsa0JBQWRELEdBQU9DLEtBQzdCdUQsRUFBSUssVUFBWSxXQUNkN0QsRUFBT0MsR0FBR3VELEVBQUlPLFlBSWxCUCxFQUFJVyxLQUFLN0IsS0FBS0UsVUFBVWtDLElBaEMxQixNQUFLSCxJQUFjdkUsR0FBV0EsRUFBTzhFLGVBQWUsV0FBYTlFLEVBQU9HLE9BQ3JFSCxFQUFPOEUsZUFBZSxVQUFZVixFQUFZcEUsRUFBT0csUUFrQ3hELE1BOUJBa0UsSUFBVyxFQUNYQyxFQUFZdEUsRUFBT0csTUFFbkI0RSxXQUFXLFdBQ1RWLEdBQVcsR0FDVlcsR0F5Qkl6QixFQUFhaUIsR0EzRXRCLEdBQUlaLEdBQWMsd0RBQTBEdkUscUJBQXFCRSxpQkFDN0Ysa0JBQW9CRixxQkFBcUJHLHFCQUN6QyxrQkFBb0JILHFCQUFxQkkscUJBQ3pDLDRCQUVBa0YsRUFBYSxzSEFDZk4sR0FBVyxFQUNYVyxFQUFnQixJQUNoQlYsRUFBWSxHQUNaWixFQUFjLEVBQ2RNLEVBQVEsRUFvRVYsUUFDRWQsSUFBT0EsSUFFUnRELFdBQVdDLE9BQU9DLGFBRUUsbUJBQVptRixVQUNUQSxRQUFRQyxPQUFPLG9DQUNaQyxTQUFTLGlCQUFrQix3QkFDM0JBLFNBQVMsZ0JBQWlCLFFBRy9CLElBQUlDLFNBQ0YxRixZQUFhLFFBS1hFLFdBQWFBLGNBQ2pCQSxZQUFXeUYsV0FFWHpGLFdBQVd5RixRQUFVLFNBQVdDLEVBQVVDLEdBRXhDLFlBWUEsU0FBU0MsS0FDUEQsRUFBUUUsSUFBSUMsS0FBSyxHQUFJLGdCQUFpQixLQUFNQyxFQUFPQyxVQUFVLE9BQzNELEdBQU0sR0FBTSxHQUFNLEdBQU0sR0FHNUIsUUFBU0MsR0FBYTVGLEdBSXBCLFFBQVM2RixHQUFvQkMsR0FDM0IsR0FBSUMsSUFBVSxFQUNaQyxFQUFTRixFQUFFRyxPQUFPQyxrQkFBa0Isa0JBRWxDRixJQUFvQyxlQUF6QkEsRUFBT3JELGdCQUNwQm9ELEdBQVUsRUFDVkksRUFBU0MsS0FBSyxrS0FHWnBHLEdBQXFCLGtCQUFQQSxJQUNoQkEsRUFBRytGLEdBYlAsR0FBSU0sR0FBVyxnQ0FBa0NDLEVBQy9DQyxFQUFVLEdBQUkvQyxlQWdCaEIrQyxHQUFRQyxpQkFBaUIsT0FBUVgsR0FDakNVLEVBQVE3QyxLQUFLLE1BQU8yQyxHQUNwQkUsRUFBUXJDLE9BR1YsUUFBU3VDLEtBQ1AsR0FBSUMsR0FBWXJCLEVBQVNzQixlQUFlLGFBQ3RDQyxFQUFRdkIsRUFBU3NCLGVBQWUsaUJBQ2hDRSxFQUFnQm5CLEVBQU9vQixPQUFPLE9BQVNwQixFQUFPb0IsT0FBTyxPQUFVLEdBRTdESixJQUFhRSxJQUVmRixFQUFVSyxNQUFNQyxXQUFhLFNBRzdCTixFQUFVTyxhQUFhLFFBQVMsa0JBQW9CSixFQUFjLE1BSXRFLFFBQVNLLEtBQ1AsR0FBSU4sR0FBUXZCLEVBQVNzQixlQUFlLGlCQUNsQ0QsRUFBWXJCLEVBQVNzQixlQUFlLFlBRWxDRCxJQUFhRSxJQUNmQSxFQUFNTyxPQUFTLFdBQ2JQLEVBQU1PLE9BQVMsS0FHZlQsRUFBVUssTUFBTUMsV0FBYSxXQUcvQkosRUFBTUssYUFBYSxNQUFPWCxJQUk5QixRQUFTYyxLQUNQLEdBQUlSLEdBQVF2QixFQUFTc0IsZUFBZSxnQkFFaENDLEtBQ0ZBLEVBQU1TLElBQU0sZUFLaEIsUUFBU0MsS0FDUG5CLEVBQVcsR0FBSXhHLFlBQVdDLE9BQU8ySCxRQUFRbEMsRUFBU3NCLGVBQWUsYUFDL0R0QixFQUFTc0IsZUFBZSxxQkFHMUJMLEVBQU9rQixFQUFrQnJHLElBR0csS0FBeEJtRixFQUFLN0UsUUFBUSxTQUNmNkUsRUFBTyxVQUFZQSxHQUdyQlYsRUFBYSxTQUFTRyxHQUNoQkEsR0FDRlUsSUFHRmxCLE1BT0osUUFBU2tDLEtBQ1AsTUFBTyxpQkFHVCxRQUFTM0UsR0FBUy9DLEdBQ2hCSixXQUFXQyxPQUFPQyxZQUFZaUQsU0FBUzJFLElBQWdCMUgsR0FHekQsUUFBUzJILEtBQ1BOLElBR0YsUUFBU08sS0FDUFQsSUFHRixRQUFTVSxLQUNQRixJQUdGLFFBQVNHLEdBQW9CQyxHQUMzQk4sRUFBb0JuRixLQUFLQyxNQUFNRCxLQUFLRSxVQUFVdUYsSUFFOUNSLElBM0hGLEdBQUk1QixHQUFTLEdBQUlKLEdBQVF5QyxNQUN2QlAsRUFBb0IsS0FDcEJsQixFQUFPLEdBRUxILEVBQVcsSUEwSGYsUUFDRXNCLGFBQWdCQSxFQUNoQjNFLFNBQVlBLEVBQ1orRSxvQkFBdUJBLEVBQ3ZCSCxNQUFTQSxFQUNUQyxLQUFRQSxFQUNSQyxLQUFRQSxJQUdUdkMsU0FBVUMsUUFFYixJQUFJM0YsWUFBYUEsY0FDakJBLFlBQVdDLE9BQVNELFdBQVdDLFdBRS9CRCxXQUFXQyxPQUFPMkgsUUFBVSxTQUFVUyxFQUFlQyxHQUNuRCxZQUlBLFNBQVNYLEtBQ1AsSUFDRVcsRUFBaUJsQixNQUFNbUIsT0FBU0YsRUFBY2pCLE1BQU1tQixPQUNwRCxNQUFPcEMsR0FDUHFDLFFBQVFDLEtBQUssOEJBQStCdEMsRUFBRXVDLFVBT2xELFFBQVNDLEtBQ1AsR0FBSUMsRUFBUyxDQUVYLEtBQU9OLEVBQWlCTyxZQUN0QlAsRUFBaUJRLFlBQVlSLEVBQWlCTyxXQUloRFAsR0FBaUJsQixNQUFNM0QsUUFBVSxPQUdqQzRFLEVBQWNqQixNQUFNQyxXQUFhLFVBRWpDdUIsR0FBVSxHQUlkLFFBQVNuQyxHQUFLaUMsR0FDWixHQUNFSyxHQURFQyxFQUFXdEQsU0FBU3VELHdCQUduQkwsSUFpQkhHLEVBQUlULEVBQWlCWSxjQUFjLFlBQ25DSCxFQUFFSSxVQUFZVCxJQWhCZEwsRUFBY2pCLE1BQU1DLFdBQWEsU0FFakNpQixFQUFpQmxCLE1BQU0zRCxRQUFVLFFBR2pDc0YsRUFBSXJELFNBQVMwRCxjQUFjLEtBQzNCTCxFQUFFSSxVQUFZVCxFQUNkSyxFQUFFekIsYUFBYSxRQUFTLFdBRXhCMEIsRUFBU0ssWUFBWU4sR0FDckJULEVBQWlCZSxZQUFZTCxHQUU3QkosR0FBVSxHQWhEZCxHQUFJQSxJQUFVLENBMERkLE9BRkFqQixNQUdFZ0IsS0FBUUEsRUFDUmxDLEtBQVFBLElBTVosU0FBVzZDLEVBQVE1RCxFQUFVQyxHQUMzQixZQWFBLFNBQVM0RCxHQUFVQyxFQUFPQyxHQUN4QixHQUFJdEIsR0FDRnZILEVBQVksR0FDWkUsRUFBWSxFQUVWNEksT0FBTUMsUUFBUUgsSUFBVUEsRUFBTXpILE9BQVMsR0FBSzJILE1BQU1DLFFBQVFGLElBQVdBLEVBQU8xSCxPQUFTLElBRXRFLGNBQWJ5SCxFQUFNLEtBQ1I1SSxFQUFZNkksRUFBTyxJQUlKLGNBQWJELEVBQU0sS0FFTjFJLEVBREUySSxFQUFPLEdBQ0dBLEVBQU8sR0FHUCxXQUtoQnpKLFdBQVdDLE9BQU9DLFlBQVlxRCxPQUFPM0MsRUFBV0UsR0FHL0IscUJBQWIwSSxFQUFNLEtBQ1JyQixFQUFtQnpGLEtBQUtDLE1BQU04RyxFQUFPLElBRXJDekosV0FBV3lGLFFBQVF5QyxvQkFBb0JDLEtBSzdDLFFBQVNILEtBQ1BoSSxXQUFXeUYsUUFBUXVDLE9BR3JCLFFBQVNELEtBQ1AvSCxXQUFXeUYsUUFBUXNDLFFBR3JCLFFBQVNFLEtBQ1BqSSxXQUFXeUYsUUFBUXdDLE9BckRyQixHQUFJMkIsSUFBSyxHQUFJakUsR0FBUXlDLE9BQVFwQyxVQUFVLEtBR3ZDc0QsR0FBT08sY0FBZ0IsV0FDckIsT0FBTyxHQUdUbkUsRUFBU29FLEtBQUtDLFlBQWMsV0FDMUIsT0FBTyxHQWdETEgsR0FBYSxLQUFQQSxJQUNSakUsRUFBUUUsSUFBSW1FLFNBQVMsY0FBZ0JKLEVBQUk1QixHQUN6Q3JDLEVBQVFFLElBQUltRSxTQUFTLGVBQWlCSixFQUFJN0IsR0FDMUNwQyxFQUFRRSxJQUFJbUUsU0FBUyxjQUFnQkosRUFBSTNCLEdBQ3pDdEMsRUFBUUUsSUFBSW1FLFNBQVMsZUFBaUJKLEVBQUlMLEdBQzFDNUQsRUFBUUUsSUFBSUMsS0FBSyxHQUFJLGNBQWUsS0FBTThELEdBQUssWUFBYSxZQUFhLHVCQUcxRU4sT0FBUTVELFNBQVVDLFFBS3JCLElBQUlzRSxNQUFPQSxRQUVYQSxNQUFLQyxNQUFNLGNBQWUsa0JBQzFCRCxLQUFLQyxNQUFNLG1CQUVYLFdBQ0UsR0FBSUMsR0FBS3pFLFNBQVMwRCxjQUFjLFNBQVdlLEdBQUdDLEtBQU8sa0JBQW1CRCxFQUFHRSxPQUFRLEVBQ25GRixFQUFHekMsS0FBTyxVQUFZaEMsU0FBUzRFLFNBQVNDLFNBQVcsY0FBZ0IsY0FBZ0IsNkJBQ25GLElBQUlDLEdBQUk5RSxTQUFTK0UscUJBQXFCLFVBQVUsRUFBSUQsR0FBRUUsV0FBV0MsYUFBYVIsRUFBSUsiLCJmaWxlIjoianMvd2lkZ2V0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGV4cG9ydGVkIFdJREdFVF9DT01NT05fQ09ORklHICovXG52YXIgV0lER0VUX0NPTU1PTl9DT05GSUcgPSB7XG4gIEFVVEhfUEFUSF9VUkw6IFwidjEvd2lkZ2V0L2F1dGhcIixcbiAgTE9HR0VSX0NMSUVOVF9JRDogXCIxMDg4NTI3MTQ3MTA5LTZxMW8ydnRpaG4zNDI5MnBqdDRja2htaGNrMHJrMG83LmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tXCIsXG4gIExPR0dFUl9DTElFTlRfU0VDUkVUOiBcIm5sWnlyY1BMZzZvRXdPOWY5V2ZuMjlXaFwiLFxuICBMT0dHRVJfUkVGUkVTSF9UT0tFTjogXCIxL3h6dDRrd3pFMUg3VzlWbktCOGNBYUN4NnpiNEVzNG5LRW9xYVlIZFREMTVJZ09ySkR0ZHVuNnpLNlhpQVRDS1RcIixcbiAgU1RPUkFHRV9FTlY6IFwicHJvZFwiLFxuICBTVE9SRV9VUkw6IFwiaHR0cHM6Ly9zdG9yZS1kb3QtcnZhc2VydmVyMi5hcHBzcG90LmNvbS9cIlxufTtcbi8qIGdsb2JhbCBXSURHRVRfQ09NTU9OX0NPTkZJRyAqL1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLkNvbW1vbiA9IFJpc2VWaXNpb24uQ29tbW9uIHx8IHt9O1xuXG5SaXNlVmlzaW9uLkNvbW1vbi5Mb2dnZXJVdGlscyA9IChmdW5jdGlvbigpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgIHZhciBkaXNwbGF5SWQgPSBcIlwiLFxuICAgIGNvbXBhbnlJZCA9IFwiXCI7XG5cbiAgLypcbiAgICogIFByaXZhdGUgTWV0aG9kc1xuICAgKi9cblxuICAvKiBSZXRyaWV2ZSBwYXJhbWV0ZXJzIHRvIHBhc3MgdG8gdGhlIGV2ZW50IGxvZ2dlci4gKi9cbiAgZnVuY3Rpb24gZ2V0RXZlbnRQYXJhbXMocGFyYW1zLCBjYikge1xuICAgIHZhciBqc29uID0gbnVsbDtcblxuICAgIC8vIGV2ZW50IGlzIHJlcXVpcmVkLlxuICAgIGlmIChwYXJhbXMuZXZlbnQpIHtcbiAgICAgIGpzb24gPSBwYXJhbXM7XG5cbiAgICAgIGlmIChqc29uLmZpbGVfdXJsKSB7XG4gICAgICAgIGpzb24uZmlsZV9mb3JtYXQgPSBnZXRGaWxlRm9ybWF0KGpzb24uZmlsZV91cmwpO1xuICAgICAgfVxuXG4gICAgICBqc29uLmNvbXBhbnlfaWQgPSBjb21wYW55SWQ7XG4gICAgICBqc29uLmRpc3BsYXlfaWQgPSBkaXNwbGF5SWQ7XG5cbiAgICAgIGNiKGpzb24pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGNiKGpzb24pO1xuICAgIH1cbiAgfVxuXG4gIC8vIEdldCBzdWZmaXggZm9yIEJRIHRhYmxlIG5hbWUuXG4gIGZ1bmN0aW9uIGdldFN1ZmZpeCgpIHtcbiAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCksXG4gICAgICB5ZWFyID0gZGF0ZS5nZXRVVENGdWxsWWVhcigpLFxuICAgICAgbW9udGggPSBkYXRlLmdldFVUQ01vbnRoKCkgKyAxLFxuICAgICAgZGF5ID0gZGF0ZS5nZXRVVENEYXRlKCk7XG5cbiAgICBpZiAobW9udGggPCAxMCkge1xuICAgICAgbW9udGggPSBcIjBcIiArIG1vbnRoO1xuICAgIH1cblxuICAgIGlmIChkYXkgPCAxMCkge1xuICAgICAgZGF5ID0gXCIwXCIgKyBkYXk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHllYXIgKyBtb250aCArIGRheTtcbiAgfVxuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gZ2V0RmlsZUZvcm1hdCh1cmwpIHtcbiAgICB2YXIgaGFzUGFyYW1zID0gL1s/IyZdLyxcbiAgICAgIHN0cjtcblxuICAgIGlmICghdXJsIHx8IHR5cGVvZiB1cmwgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHN0ciA9IHVybC5zdWJzdHIodXJsLmxhc3RJbmRleE9mKFwiLlwiKSArIDEpO1xuXG4gICAgLy8gZG9uJ3QgaW5jbHVkZSBhbnkgcGFyYW1zIGFmdGVyIHRoZSBmaWxlbmFtZVxuICAgIGlmIChoYXNQYXJhbXMudGVzdChzdHIpKSB7XG4gICAgICBzdHIgPSBzdHIuc3Vic3RyKDAgLChzdHIuaW5kZXhPZihcIj9cIikgIT09IC0xKSA/IHN0ci5pbmRleE9mKFwiP1wiKSA6IHN0ci5sZW5ndGgpO1xuXG4gICAgICBzdHIgPSBzdHIuc3Vic3RyKDAsIChzdHIuaW5kZXhPZihcIiNcIikgIT09IC0xKSA/IHN0ci5pbmRleE9mKFwiI1wiKSA6IHN0ci5sZW5ndGgpO1xuXG4gICAgICBzdHIgPSBzdHIuc3Vic3RyKDAsIChzdHIuaW5kZXhPZihcIiZcIikgIT09IC0xKSA/IHN0ci5pbmRleE9mKFwiJlwiKSA6IHN0ci5sZW5ndGgpO1xuICAgIH1cblxuICAgIHJldHVybiBzdHIudG9Mb3dlckNhc2UoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldEluc2VydERhdGEocGFyYW1zKSB7XG4gICAgdmFyIEJBU0VfSU5TRVJUX1NDSEVNQSA9IHtcbiAgICAgIFwia2luZFwiOiBcImJpZ3F1ZXJ5I3RhYmxlRGF0YUluc2VydEFsbFJlcXVlc3RcIixcbiAgICAgIFwic2tpcEludmFsaWRSb3dzXCI6IGZhbHNlLFxuICAgICAgXCJpZ25vcmVVbmtub3duVmFsdWVzXCI6IGZhbHNlLFxuICAgICAgXCJ0ZW1wbGF0ZVN1ZmZpeFwiOiBnZXRTdWZmaXgoKSxcbiAgICAgIFwicm93c1wiOiBbe1xuICAgICAgICBcImluc2VydElkXCI6IFwiXCJcbiAgICAgIH1dXG4gICAgfSxcbiAgICBkYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShCQVNFX0lOU0VSVF9TQ0hFTUEpKTtcblxuICAgIGRhdGEucm93c1swXS5pbnNlcnRJZCA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyKS50b1VwcGVyQ2FzZSgpO1xuICAgIGRhdGEucm93c1swXS5qc29uID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShwYXJhbXMpKTtcbiAgICBkYXRhLnJvd3NbMF0uanNvbi50cyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcblxuICAgIHJldHVybiBkYXRhO1xuICB9XG5cbiAgZnVuY3Rpb24gbG9nRXZlbnQodGFibGUsIHBhcmFtcykge1xuICAgIGdldEV2ZW50UGFyYW1zKHBhcmFtcywgZnVuY3Rpb24oanNvbikge1xuICAgICAgaWYgKGpzb24gIT09IG51bGwpIHtcbiAgICAgICAgUmlzZVZpc2lvbi5Db21tb24uTG9nZ2VyLmxvZyh0YWJsZSwganNvbik7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKiBTZXQgdGhlIENvbXBhbnkgYW5kIERpc3BsYXkgSURzLiAqL1xuICBmdW5jdGlvbiBzZXRJZHMoY29tcGFueSwgZGlzcGxheSkge1xuICAgIGNvbXBhbnlJZCA9IGNvbXBhbnk7XG4gICAgZGlzcGxheUlkID0gZGlzcGxheTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJnZXRJbnNlcnREYXRhXCI6IGdldEluc2VydERhdGEsXG4gICAgXCJnZXRGaWxlRm9ybWF0XCI6IGdldEZpbGVGb3JtYXQsXG4gICAgXCJsb2dFdmVudFwiOiBsb2dFdmVudCxcbiAgICBcInNldElkc1wiOiBzZXRJZHNcbiAgfTtcbn0pKCk7XG5cblJpc2VWaXNpb24uQ29tbW9uLkxvZ2dlciA9IChmdW5jdGlvbih1dGlscykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgUkVGUkVTSF9VUkwgPSBcImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92My90b2tlbj9jbGllbnRfaWQ9XCIgKyBXSURHRVRfQ09NTU9OX0NPTkZJRy5MT0dHRVJfQ0xJRU5UX0lEICtcbiAgICAgIFwiJmNsaWVudF9zZWNyZXQ9XCIgKyBXSURHRVRfQ09NTU9OX0NPTkZJRy5MT0dHRVJfQ0xJRU5UX1NFQ1JFVCArXG4gICAgICBcIiZyZWZyZXNoX3Rva2VuPVwiICsgV0lER0VUX0NPTU1PTl9DT05GSUcuTE9HR0VSX1JFRlJFU0hfVE9LRU4gK1xuICAgICAgXCImZ3JhbnRfdHlwZT1yZWZyZXNoX3Rva2VuXCI7XG5cbiAgdmFyIHNlcnZpY2VVcmwgPSBcImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL2JpZ3F1ZXJ5L3YyL3Byb2plY3RzL2NsaWVudC1zaWRlLWV2ZW50cy9kYXRhc2V0cy9XaWRnZXRfRXZlbnRzL3RhYmxlcy9UQUJMRV9JRC9pbnNlcnRBbGxcIixcbiAgICB0aHJvdHRsZSA9IGZhbHNlLFxuICAgIHRocm90dGxlRGVsYXkgPSAxMDAwLFxuICAgIGxhc3RFdmVudCA9IFwiXCIsXG4gICAgcmVmcmVzaERhdGUgPSAwLFxuICAgIHRva2VuID0gXCJcIjtcblxuICAvKlxuICAgKiAgUHJpdmF0ZSBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiByZWZyZXNoVG9rZW4oY2IpIHtcbiAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cbiAgICBpZiAobmV3IERhdGUoKSAtIHJlZnJlc2hEYXRlIDwgMzU4MDAwMCkge1xuICAgICAgcmV0dXJuIGNiKHt9KTtcbiAgICB9XG5cbiAgICB4aHIub3BlbihcIlBPU1RcIiwgUkVGUkVTSF9VUkwsIHRydWUpO1xuICAgIHhoci5vbmxvYWRlbmQgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciByZXNwID0gSlNPTi5wYXJzZSh4aHIucmVzcG9uc2UpO1xuXG4gICAgICBjYih7IHRva2VuOiByZXNwLmFjY2Vzc190b2tlbiwgcmVmcmVzaGVkQXQ6IG5ldyBEYXRlKCkgfSk7XG4gICAgfTtcblxuICAgIHhoci5zZW5kKCk7XG4gIH1cblxuICBmdW5jdGlvbiBpc1Rocm90dGxlZChldmVudCkge1xuICAgIHJldHVybiB0aHJvdHRsZSAmJiAobGFzdEV2ZW50ID09PSBldmVudCk7XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIGxvZyh0YWJsZU5hbWUsIHBhcmFtcykge1xuICAgIGlmICghdGFibGVOYW1lIHx8ICFwYXJhbXMgfHwgKHBhcmFtcy5oYXNPd25Qcm9wZXJ0eShcImV2ZW50XCIpICYmICFwYXJhbXMuZXZlbnQpIHx8XG4gICAgICAocGFyYW1zLmhhc093blByb3BlcnR5KFwiZXZlbnRcIikgJiYgaXNUaHJvdHRsZWQocGFyYW1zLmV2ZW50KSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aHJvdHRsZSA9IHRydWU7XG4gICAgbGFzdEV2ZW50ID0gcGFyYW1zLmV2ZW50O1xuXG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICB0aHJvdHRsZSA9IGZhbHNlO1xuICAgIH0sIHRocm90dGxlRGVsYXkpO1xuXG4gICAgZnVuY3Rpb24gaW5zZXJ0V2l0aFRva2VuKHJlZnJlc2hEYXRhKSB7XG4gICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCksXG4gICAgICAgIGluc2VydERhdGEsIHVybDtcblxuICAgICAgdXJsID0gc2VydmljZVVybC5yZXBsYWNlKFwiVEFCTEVfSURcIiwgdGFibGVOYW1lKTtcbiAgICAgIHJlZnJlc2hEYXRlID0gcmVmcmVzaERhdGEucmVmcmVzaGVkQXQgfHwgcmVmcmVzaERhdGU7XG4gICAgICB0b2tlbiA9IHJlZnJlc2hEYXRhLnRva2VuIHx8IHRva2VuO1xuICAgICAgaW5zZXJ0RGF0YSA9IHV0aWxzLmdldEluc2VydERhdGEocGFyYW1zKTtcblxuICAgICAgLy8gSW5zZXJ0IHRoZSBkYXRhLlxuICAgICAgeGhyLm9wZW4oXCJQT1NUXCIsIHVybCwgdHJ1ZSk7XG4gICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkNvbnRlbnQtVHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb25cIik7XG4gICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkF1dGhvcml6YXRpb25cIiwgXCJCZWFyZXIgXCIgKyB0b2tlbik7XG5cbiAgICAgIGlmIChwYXJhbXMuY2IgJiYgdHlwZW9mIHBhcmFtcy5jYiA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIHhoci5vbmxvYWRlbmQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICBwYXJhbXMuY2IoeGhyLnJlc3BvbnNlKTtcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgeGhyLnNlbmQoSlNPTi5zdHJpbmdpZnkoaW5zZXJ0RGF0YSkpO1xuICAgIH1cblxuICAgIHJldHVybiByZWZyZXNoVG9rZW4oaW5zZXJ0V2l0aFRva2VuKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJsb2dcIjogbG9nXG4gIH07XG59KShSaXNlVmlzaW9uLkNvbW1vbi5Mb2dnZXJVdGlscyk7XG4vKiBleHBvcnRlZCBjb25maWcgKi9cbmlmICh0eXBlb2YgYW5ndWxhciAhPT0gXCJ1bmRlZmluZWRcIikge1xuICBhbmd1bGFyLm1vZHVsZShcInJpc2V2aXNpb24uY29tbW9uLmkxOG4uY29uZmlnXCIsIFtdKVxuICAgIC5jb25zdGFudChcIkxPQ0FMRVNfUFJFRklYXCIsIFwibG9jYWxlcy90cmFuc2xhdGlvbl9cIilcbiAgICAuY29uc3RhbnQoXCJMT0NBTEVTX1NVRklYXCIsIFwiLmpzb25cIik7XG59XG5cbnZhciBjb25maWcgPSB7XG4gIFNUT1JBR0VfRU5WOiBcInByb2RcIlxufTtcblxuLyogZ2xvYmFsIGdhZGdldHMgKi9cblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5XZWJQYWdlID0ge307XG5cblJpc2VWaXNpb24uV2ViUGFnZSA9IChmdW5jdGlvbiAoZG9jdW1lbnQsIGdhZGdldHMpIHtcblxuICBcInVzZSBzdHJpY3RcIjtcblxuICAvLyBwcml2YXRlIHZhcmlhYmxlc1xuICB2YXIgX3ByZWZzID0gbmV3IGdhZGdldHMuUHJlZnMoKSxcbiAgICBfYWRkaXRpb25hbFBhcmFtcyA9IG51bGwsXG4gICAgX3VybCA9IFwiXCI7XG5cbiAgdmFyIF9tZXNzYWdlID0gbnVsbDtcblxuICAvKlxuICAgKiAgUHJpdmF0ZSBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBfcmVhZHkoKSB7XG4gICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzZXZlbnRfcmVhZHlcIiwgbnVsbCwgX3ByZWZzLmdldFN0cmluZyhcImlkXCIpLFxuICAgICAgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgZmFsc2UpO1xuICB9XG5cbiAgZnVuY3Rpb24gX3ZhbGlkYXRlVXJsKGNiKSB7XG4gICAgdmFyIHByb3h5VXJsID0gXCJodHRwczovL3Byb3h5LnJpc2V2aXNpb24uY29tL1wiICsgX3VybCxcbiAgICAgIHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblxuICAgIGZ1bmN0aW9uIGhhbmRsZVByb3h5UmVzcG9uc2UoZSkge1xuICAgICAgdmFyIHN1Y2Nlc3MgPSB0cnVlLFxuICAgICAgICBoZWFkZXIgPSBlLnRhcmdldC5nZXRSZXNwb25zZUhlYWRlcihcIlgtRnJhbWUtT3B0aW9uc1wiKTtcblxuICAgICAgaWYgKGhlYWRlciAmJiAoaGVhZGVyLnRvVXBwZXJDYXNlKCkgPT09IFwiU0FNRU9SSUdJTlwiKSkge1xuICAgICAgICBzdWNjZXNzID0gZmFsc2U7XG4gICAgICAgIF9tZXNzYWdlLnNob3coXCJQbGVhc2Ugbm90ZSB0aGF0IHRoZSBYLUZyYW1lLU9wdGlvbnMgaGVhZGVyIGhhcyBiZWVuIGRldGVjdGVkIGluIHRoZSByZXF1ZXN0IHJlc3BvbnNlIGZvciB0aGUgd2ViIHBhZ2UgcHJvdmlkZWQgYW5kIHdpbGwgcHJldmVudCB0aGUgd2ViIHBhZ2UgZnJvbSBhcHBlYXJpbmcuXCIpO1xuICAgICAgfVxuXG4gICAgICBpZiAoY2IgJiYgKHR5cGVvZiBjYiA9PT0gXCJmdW5jdGlvblwiKSkge1xuICAgICAgICBjYihzdWNjZXNzKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsIGhhbmRsZVByb3h5UmVzcG9uc2UpO1xuICAgIHJlcXVlc3Qub3BlbihcIkdFVFwiLCBwcm94eVVybCk7XG4gICAgcmVxdWVzdC5zZW5kKCk7XG4gIH1cblxuICBmdW5jdGlvbiBfY29uZmlndXJlUGFnZSgpIHtcbiAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjb250YWluZXJcIiksXG4gICAgICBmcmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwid2VicGFnZS1mcmFtZVwiKSxcbiAgICAgIGFzcGVjdFJhdGlvID0gIChfcHJlZnMuZ2V0SW50KFwicnNIXCIpIC8gX3ByZWZzLmdldEludChcInJzV1wiKSkgKiAxMDA7XG5cbiAgICBpZiAoY29udGFpbmVyICYmIGZyYW1lKSB7XG4gICAgICAvLyBIaWRpbmcgaWZyYW1lIGNvbnRhaW5lciwgdmlzaWJsZSB3aGVuIHRoZSBpZnJhbWUgc3VjY2Vzc2Z1bGx5IGxvYWRzXG4gICAgICBjb250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XG5cbiAgICAgIC8vIGltcGxlbWVudCByZXNwb25zaXZlIGlmcmFtZVxuICAgICAgY29udGFpbmVyLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwicGFkZGluZy1ib3R0b206XCIgKyBhc3BlY3RSYXRpbyArIFwiJVwiKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBfbG9hZEZyYW1lKCkge1xuICAgIHZhciBmcmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwid2VicGFnZS1mcmFtZVwiKSxcbiAgICAgIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29udGFpbmVyXCIpO1xuXG4gICAgaWYgKGNvbnRhaW5lciAmJiBmcmFtZSkge1xuICAgICAgZnJhbWUub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBmcmFtZS5vbmxvYWQgPSBudWxsO1xuXG4gICAgICAgIC8vIFNob3cgdGhlIGlmcmFtZSBjb250YWluZXJcbiAgICAgICAgY29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSBcInZpc2libGVcIjtcbiAgICAgIH07XG5cbiAgICAgIGZyYW1lLnNldEF0dHJpYnV0ZShcInNyY1wiLCBfdXJsKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBfdW5sb2FkRnJhbWUoKSB7XG4gICAgdmFyIGZyYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ3ZWJwYWdlLWZyYW1lXCIpO1xuXG4gICAgaWYgKGZyYW1lKSB7XG4gICAgICBmcmFtZS5zcmMgPSBcImFib3V0OmJsYW5rXCI7XG4gICAgfVxuXG4gIH1cblxuICBmdW5jdGlvbiBfaW5pdCgpIHtcbiAgICBfbWVzc2FnZSA9IG5ldyBSaXNlVmlzaW9uLkNvbW1vbi5NZXNzYWdlKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29udGFpbmVyXCIpLFxuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtZXNzYWdlQ29udGFpbmVyXCIpKTtcblxuICAgIC8vIENvbmZpZ3VyZSB0aGUgdmFsdWUgZm9yIF91cmxcbiAgICBfdXJsID0gX2FkZGl0aW9uYWxQYXJhbXMudXJsO1xuXG4gICAgLy8gQWRkIGh0dHA6Ly8gaWYgbm8gcHJvdG9jb2wgcGFyYW1ldGVyIGV4aXN0c1xuICAgIGlmIChfdXJsLmluZGV4T2YoXCI6Ly9cIikgPT09IC0xKSB7XG4gICAgICBfdXJsID0gXCJodHRwOi8vXCIgKyBfdXJsO1xuICAgIH1cblxuICAgIF92YWxpZGF0ZVVybChmdW5jdGlvbihzdWNjZXNzKSB7XG4gICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICBfY29uZmlndXJlUGFnZSgpO1xuICAgICAgfVxuXG4gICAgICBfcmVhZHkoKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gZ2V0VGFibGVOYW1lKCkge1xuICAgIHJldHVybiBcIndlYnBhZ2VfZXZlbnRzXCI7XG4gIH1cblxuICBmdW5jdGlvbiBsb2dFdmVudChwYXJhbXMpIHtcbiAgICBSaXNlVmlzaW9uLkNvbW1vbi5Mb2dnZXJVdGlscy5sb2dFdmVudChnZXRUYWJsZU5hbWUoKSwgcGFyYW1zKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhdXNlKCkge1xuICAgIF91bmxvYWRGcmFtZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGxheSgpIHtcbiAgICBfbG9hZEZyYW1lKCk7XG4gIH1cblxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIHBhdXNlKCk7XG4gIH1cblxuICBmdW5jdGlvbiBzZXRBZGRpdGlvbmFsUGFyYW1zKGFkZGl0aW9uYWxQYXJhbXMpIHtcbiAgICBfYWRkaXRpb25hbFBhcmFtcyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoYWRkaXRpb25hbFBhcmFtcykpO1xuXG4gICAgX2luaXQoKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJnZXRUYWJsZU5hbWVcIjogZ2V0VGFibGVOYW1lLFxuICAgIFwibG9nRXZlbnRcIjogbG9nRXZlbnQsXG4gICAgXCJzZXRBZGRpdGlvbmFsUGFyYW1zXCI6IHNldEFkZGl0aW9uYWxQYXJhbXMsXG4gICAgXCJwYXVzZVwiOiBwYXVzZSxcbiAgICBcInBsYXlcIjogcGxheSxcbiAgICBcInN0b3BcIjogc3RvcFxuICB9O1xuXG59KShkb2N1bWVudCwgZ2FkZ2V0cyk7XG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uQ29tbW9uID0gUmlzZVZpc2lvbi5Db21tb24gfHwge307XG5cblJpc2VWaXNpb24uQ29tbW9uLk1lc3NhZ2UgPSBmdW5jdGlvbiAobWFpbkNvbnRhaW5lciwgbWVzc2FnZUNvbnRhaW5lcikge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgX2FjdGl2ZSA9IGZhbHNlO1xuXG4gIGZ1bmN0aW9uIF9pbml0KCkge1xuICAgIHRyeSB7XG4gICAgICBtZXNzYWdlQ29udGFpbmVyLnN0eWxlLmhlaWdodCA9IG1haW5Db250YWluZXIuc3R5bGUuaGVpZ2h0O1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUud2FybihcIkNhbid0IGluaXRpYWxpemUgTWVzc2FnZSAtIFwiLCBlLm1lc3NhZ2UpO1xuICAgIH1cbiAgfVxuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gaGlkZSgpIHtcbiAgICBpZiAoX2FjdGl2ZSkge1xuICAgICAgLy8gY2xlYXIgY29udGVudCBvZiBtZXNzYWdlIGNvbnRhaW5lclxuICAgICAgd2hpbGUgKG1lc3NhZ2VDb250YWluZXIuZmlyc3RDaGlsZCkge1xuICAgICAgICBtZXNzYWdlQ29udGFpbmVyLnJlbW92ZUNoaWxkKG1lc3NhZ2VDb250YWluZXIuZmlyc3RDaGlsZCk7XG4gICAgICB9XG5cbiAgICAgIC8vIGhpZGUgbWVzc2FnZSBjb250YWluZXJcbiAgICAgIG1lc3NhZ2VDb250YWluZXIuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXG4gICAgICAvLyBzaG93IG1haW4gY29udGFpbmVyXG4gICAgICBtYWluQ29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSBcInZpc2libGVcIjtcblxuICAgICAgX2FjdGl2ZSA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHNob3cobWVzc2FnZSkge1xuICAgIHZhciBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSxcbiAgICAgIHA7XG5cbiAgICBpZiAoIV9hY3RpdmUpIHtcbiAgICAgIC8vIGhpZGUgbWFpbiBjb250YWluZXJcbiAgICAgIG1haW5Db250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XG5cbiAgICAgIG1lc3NhZ2VDb250YWluZXIuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcblxuICAgICAgLy8gY3JlYXRlIG1lc3NhZ2UgZWxlbWVudFxuICAgICAgcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwXCIpO1xuICAgICAgcC5pbm5lckhUTUwgPSBtZXNzYWdlO1xuICAgICAgcC5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcIm1lc3NhZ2VcIik7XG5cbiAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKHApO1xuICAgICAgbWVzc2FnZUNvbnRhaW5lci5hcHBlbmRDaGlsZChmcmFnbWVudCk7XG5cbiAgICAgIF9hY3RpdmUgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBtZXNzYWdlIGFscmVhZHkgYmVpbmcgc2hvd24sIHVwZGF0ZSBtZXNzYWdlIHRleHRcbiAgICAgIHAgPSBtZXNzYWdlQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCIubWVzc2FnZVwiKTtcbiAgICAgIHAuaW5uZXJIVE1MID0gbWVzc2FnZTtcbiAgICB9XG4gIH1cblxuICBfaW5pdCgpO1xuXG4gIHJldHVybiB7XG4gICAgXCJoaWRlXCI6IGhpZGUsXG4gICAgXCJzaG93XCI6IHNob3dcbiAgfTtcbn07XG5cbi8qIGdsb2JhbCBSaXNlVmlzaW9uLCBnYWRnZXRzICovXG5cbihmdW5jdGlvbiAod2luZG93LCBkb2N1bWVudCwgZ2FkZ2V0cykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgaWQgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpLmdldFN0cmluZyhcImlkXCIpO1xuXG4gIC8vIERpc2FibGUgY29udGV4dCBtZW51IChyaWdodCBjbGljayBtZW51KVxuICB3aW5kb3cub25jb250ZXh0bWVudSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgZG9jdW1lbnQuYm9keS5vbm1vdXNlZG93biA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBmdW5jdGlvbiBjb25maWd1cmUobmFtZXMsIHZhbHVlcykge1xuICAgIHZhciBhZGRpdGlvbmFsUGFyYW1zLFxuICAgICAgY29tcGFueUlkID0gXCJcIixcbiAgICAgIGRpc3BsYXlJZCA9IFwiXCI7XG5cbiAgICBpZiAoQXJyYXkuaXNBcnJheShuYW1lcykgJiYgbmFtZXMubGVuZ3RoID4gMCAmJiBBcnJheS5pc0FycmF5KHZhbHVlcykgJiYgdmFsdWVzLmxlbmd0aCA+IDApIHtcbiAgICAgIC8vIGNvbXBhbnkgaWRcbiAgICAgIGlmIChuYW1lc1swXSA9PT0gXCJjb21wYW55SWRcIikge1xuICAgICAgICBjb21wYW55SWQgPSB2YWx1ZXNbMF07XG4gICAgICB9XG5cbiAgICAgIC8vIGRpc3BsYXkgaWRcbiAgICAgIGlmIChuYW1lc1sxXSA9PT0gXCJkaXNwbGF5SWRcIikge1xuICAgICAgICBpZiAodmFsdWVzWzFdKSB7XG4gICAgICAgICAgZGlzcGxheUlkID0gdmFsdWVzWzFdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIGRpc3BsYXlJZCA9IFwicHJldmlld1wiO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIHByb3ZpZGUgTG9nZ2VyVXRpbHMgdGhlIGlkcyB0byB1c2VcbiAgICAgIFJpc2VWaXNpb24uQ29tbW9uLkxvZ2dlclV0aWxzLnNldElkcyhjb21wYW55SWQsIGRpc3BsYXlJZCk7XG5cbiAgICAgIC8vIGFkZGl0aW9uYWwgcGFyYW1zXG4gICAgICBpZiAobmFtZXNbMl0gPT09IFwiYWRkaXRpb25hbFBhcmFtc1wiKSB7XG4gICAgICAgIGFkZGl0aW9uYWxQYXJhbXMgPSBKU09OLnBhcnNlKHZhbHVlc1syXSk7XG5cbiAgICAgICAgUmlzZVZpc2lvbi5XZWJQYWdlLnNldEFkZGl0aW9uYWxQYXJhbXMoYWRkaXRpb25hbFBhcmFtcyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcGxheSgpIHtcbiAgICBSaXNlVmlzaW9uLldlYlBhZ2UucGxheSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGF1c2UoKSB7XG4gICAgUmlzZVZpc2lvbi5XZWJQYWdlLnBhdXNlKCk7XG4gIH1cblxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIFJpc2VWaXNpb24uV2ViUGFnZS5zdG9wKCk7XG4gIH1cblxuICBpZiAoaWQgJiYgaWQgIT09IFwiXCIpIHtcbiAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3BsYXlfXCIgKyBpZCwgcGxheSk7XG4gICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9wYXVzZV9cIiArIGlkLCBwYXVzZSk7XG4gICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9zdG9wX1wiICsgaWQsIHN0b3ApO1xuICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNwYXJhbV9zZXRfXCIgKyBpZCwgY29uZmlndXJlKTtcbiAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNwYXJhbV9nZXRcIiwgbnVsbCwgaWQsIFtcImNvbXBhbnlJZFwiLCBcImRpc3BsYXlJZFwiLCBcImFkZGl0aW9uYWxQYXJhbXNcIl0pO1xuICB9XG5cbn0pKHdpbmRvdywgZG9jdW1lbnQsIGdhZGdldHMpO1xuXG5cblxuLyoganNoaW50IGlnbm9yZTpzdGFydCAqL1xudmFyIF9nYXEgPSBfZ2FxIHx8IFtdO1xuXG5fZ2FxLnB1c2goWydfc2V0QWNjb3VudCcsICdVQS01NzA5MjE1OS02J10pO1xuX2dhcS5wdXNoKFsnX3RyYWNrUGFnZXZpZXcnXSk7XG5cbihmdW5jdGlvbigpIHtcbiAgdmFyIGdhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7IGdhLnR5cGUgPSAndGV4dC9qYXZhc2NyaXB0JzsgZ2EuYXN5bmMgPSB0cnVlO1xuICBnYS5zcmMgPSAoJ2h0dHBzOicgPT0gZG9jdW1lbnQubG9jYXRpb24ucHJvdG9jb2wgPyAnaHR0cHM6Ly9zc2wnIDogJ2h0dHA6Ly93d3cnKSArICcuZ29vZ2xlLWFuYWx5dGljcy5jb20vZ2EuanMnO1xuICB2YXIgcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzY3JpcHQnKVswXTsgcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShnYSwgcyk7XG59KSgpO1xuLyoganNoaW50IGlnbm9yZTplbmQgKi9cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
