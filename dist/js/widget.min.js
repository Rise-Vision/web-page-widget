var WIDGET_COMMON_CONFIG={AUTH_PATH_URL:"v1/widget/auth",LOGGER_CLIENT_ID:"1088527147109-6q1o2vtihn34292pjt4ckhmhck0rk0o7.apps.googleusercontent.com",LOGGER_CLIENT_SECRET:"nlZyrcPLg6oEwO9f9Wfn29Wh",LOGGER_REFRESH_TOKEN:"1/xzt4kwzE1H7W9VnKB8cAaCx6zb4Es4nKEoqaYHdTD15IgOrJDtdun6zK6XiATCKT",STORAGE_ENV:"prod",STORE_URL:"https://store-dot-rvaserver2.appspot.com/"},RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.LoggerUtils=function(){"use strict";function e(e,t){var i=null;e.event?(i=e,i.file_url&&(i.file_format=n(i.file_url)),i.company_id=a,i.display_id=r,t(i)):t(i)}function t(){var e=new Date,t=e.getUTCFullYear(),n=e.getUTCMonth()+1,i=e.getUTCDate();return 10>n&&(n="0"+n),10>i&&(i="0"+i),t+n+i}function n(e){var t,n=/[?#&]/;return e&&"string"==typeof e?(t=e.substr(e.lastIndexOf(".")+1),n.test(t)&&(t=t.substr(0,-1!==t.indexOf("?")?t.indexOf("?"):t.length),t=t.substr(0,-1!==t.indexOf("#")?t.indexOf("#"):t.length),t=t.substr(0,-1!==t.indexOf("&")?t.indexOf("&"):t.length)),t.toLowerCase()):null}function i(e){var n={kind:"bigquery#tableDataInsertAllRequest",skipInvalidRows:!1,ignoreUnknownValues:!1,templateSuffix:t(),rows:[{insertId:""}]},i=JSON.parse(JSON.stringify(n));return i.rows[0].insertId=Math.random().toString(36).substr(2).toUpperCase(),i.rows[0].json=JSON.parse(JSON.stringify(e)),i.rows[0].json.ts=(new Date).toISOString(),i}function o(t,n){e(n,function(e){null!==e&&RiseVision.Common.Logger.log(t,e)})}function s(e,t){a=e,r=t}var r="",a="";return{getInsertData:i,getFileFormat:n,logEvent:o,setIds:s}}(),RiseVision.Common.Logger=function(e){"use strict";function t(e){var t=new XMLHttpRequest;return new Date-c<358e4?e({}):(t.open("POST",o,!0),t.onloadend=function(){var n=JSON.parse(t.response);e({token:n.access_token,refreshedAt:new Date})},t.send(),void 0)}function n(e){return r&&l===e}function i(i,o){function g(t){var n,r,a=new XMLHttpRequest;r=s.replace("TABLE_ID",i),c=t.refreshedAt||c,u=t.token||u,n=e.getInsertData(o),a.open("POST",r,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Authorization","Bearer "+u),o.cb&&"function"==typeof o.cb&&(a.onloadend=function(){o.cb(a.response)}),a.send(JSON.stringify(n))}if(!(!i||!o||o.hasOwnProperty("event")&&!o.event||o.hasOwnProperty("event")&&n(o.event)))return r=!0,l=o.event,setTimeout(function(){r=!1},a),t(g)}var o="https://www.googleapis.com/oauth2/v3/token?client_id="+WIDGET_COMMON_CONFIG.LOGGER_CLIENT_ID+"&client_secret="+WIDGET_COMMON_CONFIG.LOGGER_CLIENT_SECRET+"&refresh_token="+WIDGET_COMMON_CONFIG.LOGGER_REFRESH_TOKEN+"&grant_type=refresh_token",s="https://www.googleapis.com/bigquery/v2/projects/client-side-events/datasets/Widget_Events/tables/TABLE_ID/insertAll",r=!1,a=1e3,l="",c=0,u="";return{log:i}}(RiseVision.Common.LoggerUtils),"undefined"!=typeof angular&&angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","locales/translation_").constant("LOCALES_SUFIX",".json");var config={STORAGE_ENV:"prod"},RiseVision=RiseVision||{};RiseVision.WebPage={},RiseVision.WebPage=function(e,t){"use strict";function n(){t.rpc.call("","rsevent_ready",null,y.getString("id"),!0,!0,!0,!0,!1)}function i(e){function t(t){var n=!0,i=t.target.getResponseHeader("X-Frame-Options");i&&"SAMEORIGIN"===i.toUpperCase()&&(d({event:"error",event_details:"X-Frame-Options header",error_details:"SAMEORIGIN",url:_}),O.show("The owner of the Web Page at the URL provided does not allow the Page to be embedded within an iFrame. If possible, please contact the Web Page owner to discuss X-Frame-Options."),n=!1),e&&"function"==typeof e&&e(n)}var n="https://proxy.risevision.com/"+_,i=new XMLHttpRequest;i.addEventListener("load",t),i.open("GET",n),i.send()}function o(){var t=e.getElementById("container"),n=e.getElementById("webpage-frame"),i=y.getInt("rsH")/y.getInt("rsW")*100;t&&n&&(t.style.visibility="hidden",r(n),s(n),0!==E&&(i+=E/y.getInt("rsW")*100),t.setAttribute("style","padding-bottom:"+i+"%"))}function s(e){var t,n=parseFloat(h.zoom);t="-ms-zoom:"+n+";-moz-transform: scale("+n+");-moz-transform-origin: 0 0;-o-transform: scale("+n+");-o-transform-origin: 0 0;-webkit-transform: scale("+n+");-webkit-transform-origin: 0 0;transform: scale("+n+");transform-origin: 0 0;",t+="width: "+1/n*100+"%;height: "+1/n*100+"%;";var i=e.getAttribute("style");i&&(t=i+t),e.setAttribute("style",t)}function r(e){var t="",n=0;if(h.region&&h.region.showRegion&&"region"===h.region.showRegion&&(h.region.horizontal>0&&(n=h.region.horizontal),h.region.vertical>0&&(E=h.region.vertical),0!==n||0!==E)){t="margin: -"+E+"px 0 0 -"+n+"px;";var i=e.getAttribute("style");i&&(t=i+t),e.setAttribute("style",t)}}function a(){R=setInterval(function(){l()},h.refresh)}function l(){var t=e.getElementById("webpage-frame"),n=e.getElementById("container");n&&t&&(t.onload=function(){t.onload=null,n.style.visibility="visible",h.refresh>0&&null===R&&a()},t.setAttribute("src",_))}function c(){var t=e.getElementById("webpage-frame");h.refresh>0&&clearInterval(R),t&&(t.src="about:blank")}function u(){O=new RiseVision.Common.Message(e.getElementById("container"),e.getElementById("messageContainer")),_=h.url,-1===_.indexOf("://")&&(_="http://"+_),i(function(e){e&&o(),n()})}function g(){return"webpage_events"}function d(e){RiseVision.Common.LoggerUtils.logEvent(g(),e)}function f(){c()}function p(){l()}function m(){f()}function v(e){h=JSON.parse(JSON.stringify(e)),u()}var y=new t.Prefs,h=null,_="",E=0,R=null,O=null;return{getTableName:g,logEvent:d,setAdditionalParams:v,pause:f,play:p,stop:m}}(document,gadgets);var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Message=function(e,t){"use strict";function n(){try{t.style.height=e.style.height}catch(n){console.warn("Can't initialize Message - ",n.message)}}function i(){if(s){for(;t.firstChild;)t.removeChild(t.firstChild);t.style.display="none",e.style.visibility="visible",s=!1}}function o(n){var i,o=document.createDocumentFragment();s?(i=t.querySelector(".message"),i.innerHTML=n):(e.style.visibility="hidden",t.style.display="block",i=document.createElement("p"),i.innerHTML=n,i.setAttribute("class","message"),o.appendChild(i),t.appendChild(o),s=!0)}var s=!1;return n(),{hide:i,show:o}},function(e,t,n){"use strict";function i(e,t){var n,i="",o="";Array.isArray(e)&&e.length>0&&Array.isArray(t)&&t.length>0&&("companyId"===e[0]&&(i=t[0]),"displayId"===e[1]&&(o=t[1]?t[1]:"preview"),RiseVision.Common.LoggerUtils.setIds(i,o),"additionalParams"===e[2]&&(n=JSON.parse(t[2]),RiseVision.WebPage.setAdditionalParams(n)))}function o(){RiseVision.WebPage.play()}function s(){RiseVision.WebPage.pause()}function r(){RiseVision.WebPage.stop()}var a=(new n.Prefs).getString("id");e.oncontextmenu=function(){return!1},t.body.onmousedown=function(){return!1},a&&""!==a&&(n.rpc.register("rscmd_play_"+a,o),n.rpc.register("rscmd_pause_"+a,s),n.rpc.register("rscmd_stop_"+a,r),n.rpc.register("rsparam_set_"+a,i),n.rpc.call("","rsparam_get",null,a,["companyId","displayId","additionalParams"]))}(window,document,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-6"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsiV0lER0VUX0NPTU1PTl9DT05GSUciLCJBVVRIX1BBVEhfVVJMIiwiTE9HR0VSX0NMSUVOVF9JRCIsIkxPR0dFUl9DTElFTlRfU0VDUkVUIiwiTE9HR0VSX1JFRlJFU0hfVE9LRU4iLCJTVE9SQUdFX0VOViIsIlNUT1JFX1VSTCIsIlJpc2VWaXNpb24iLCJDb21tb24iLCJMb2dnZXJVdGlscyIsImdldEV2ZW50UGFyYW1zIiwicGFyYW1zIiwiY2IiLCJqc29uIiwiZXZlbnQiLCJmaWxlX3VybCIsImZpbGVfZm9ybWF0IiwiZ2V0RmlsZUZvcm1hdCIsImNvbXBhbnlfaWQiLCJjb21wYW55SWQiLCJkaXNwbGF5X2lkIiwiZGlzcGxheUlkIiwiZ2V0U3VmZml4IiwiZGF0ZSIsIkRhdGUiLCJ5ZWFyIiwiZ2V0VVRDRnVsbFllYXIiLCJtb250aCIsImdldFVUQ01vbnRoIiwiZGF5IiwiZ2V0VVRDRGF0ZSIsInVybCIsInN0ciIsImhhc1BhcmFtcyIsInN1YnN0ciIsImxhc3RJbmRleE9mIiwidGVzdCIsImluZGV4T2YiLCJsZW5ndGgiLCJ0b0xvd2VyQ2FzZSIsImdldEluc2VydERhdGEiLCJCQVNFX0lOU0VSVF9TQ0hFTUEiLCJraW5kIiwic2tpcEludmFsaWRSb3dzIiwiaWdub3JlVW5rbm93blZhbHVlcyIsInRlbXBsYXRlU3VmZml4Iiwicm93cyIsImluc2VydElkIiwiZGF0YSIsIkpTT04iLCJwYXJzZSIsInN0cmluZ2lmeSIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInRvVXBwZXJDYXNlIiwidHMiLCJ0b0lTT1N0cmluZyIsImxvZ0V2ZW50IiwidGFibGUiLCJMb2dnZXIiLCJsb2ciLCJzZXRJZHMiLCJjb21wYW55IiwiZGlzcGxheSIsInV0aWxzIiwicmVmcmVzaFRva2VuIiwieGhyIiwiWE1MSHR0cFJlcXVlc3QiLCJyZWZyZXNoRGF0ZSIsIm9wZW4iLCJSRUZSRVNIX1VSTCIsIm9ubG9hZGVuZCIsInJlc3AiLCJyZXNwb25zZSIsInRva2VuIiwiYWNjZXNzX3Rva2VuIiwicmVmcmVzaGVkQXQiLCJzZW5kIiwiaXNUaHJvdHRsZWQiLCJ0aHJvdHRsZSIsImxhc3RFdmVudCIsInRhYmxlTmFtZSIsImluc2VydFdpdGhUb2tlbiIsInJlZnJlc2hEYXRhIiwiaW5zZXJ0RGF0YSIsInNlcnZpY2VVcmwiLCJyZXBsYWNlIiwic2V0UmVxdWVzdEhlYWRlciIsImhhc093blByb3BlcnR5Iiwic2V0VGltZW91dCIsInRocm90dGxlRGVsYXkiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uc3RhbnQiLCJjb25maWciLCJXZWJQYWdlIiwiZG9jdW1lbnQiLCJnYWRnZXRzIiwiX3JlYWR5IiwicnBjIiwiY2FsbCIsIl9wcmVmcyIsImdldFN0cmluZyIsIl92YWxpZGF0ZVVybCIsImhhbmRsZVByb3h5UmVzcG9uc2UiLCJlIiwic3VjY2VzcyIsImhlYWRlciIsInRhcmdldCIsImdldFJlc3BvbnNlSGVhZGVyIiwiZXZlbnRfZGV0YWlscyIsImVycm9yX2RldGFpbHMiLCJfdXJsIiwiX21lc3NhZ2UiLCJzaG93IiwicHJveHlVcmwiLCJyZXF1ZXN0IiwiYWRkRXZlbnRMaXN0ZW5lciIsIl9jb25maWd1cmVQYWdlIiwiY29udGFpbmVyIiwiZ2V0RWxlbWVudEJ5SWQiLCJmcmFtZSIsImFzcGVjdFJhdGlvIiwiZ2V0SW50Iiwic3R5bGUiLCJ2aXNpYmlsaXR5IiwiX3NldFJlZ2lvbiIsIl9zZXRab29tIiwiX3ZlcnRpY2FsIiwic2V0QXR0cmlidXRlIiwiem9vbVN0eWxlIiwiem9vbSIsInBhcnNlRmxvYXQiLCJfYWRkaXRpb25hbFBhcmFtcyIsImN1cnJlbnRTdHlsZSIsImdldEF0dHJpYnV0ZSIsIm1hcmdpblN0eWxlIiwiaG9yaXpvbnRhbCIsInJlZ2lvbiIsInNob3dSZWdpb24iLCJ2ZXJ0aWNhbCIsIl9zdGFydFJlZnJlc2hJbnRlcnZhbCIsIl9pbnRlcnZhbElkIiwic2V0SW50ZXJ2YWwiLCJfbG9hZEZyYW1lIiwicmVmcmVzaCIsIm9ubG9hZCIsIl91bmxvYWRGcmFtZSIsImNsZWFySW50ZXJ2YWwiLCJzcmMiLCJfaW5pdCIsIk1lc3NhZ2UiLCJnZXRUYWJsZU5hbWUiLCJwYXVzZSIsInBsYXkiLCJzdG9wIiwic2V0QWRkaXRpb25hbFBhcmFtcyIsImFkZGl0aW9uYWxQYXJhbXMiLCJQcmVmcyIsIm1haW5Db250YWluZXIiLCJtZXNzYWdlQ29udGFpbmVyIiwiaGVpZ2h0IiwiY29uc29sZSIsIndhcm4iLCJtZXNzYWdlIiwiaGlkZSIsIl9hY3RpdmUiLCJmaXJzdENoaWxkIiwicmVtb3ZlQ2hpbGQiLCJwIiwiZnJhZ21lbnQiLCJjcmVhdGVEb2N1bWVudEZyYWdtZW50IiwicXVlcnlTZWxlY3RvciIsImlubmVySFRNTCIsImNyZWF0ZUVsZW1lbnQiLCJhcHBlbmRDaGlsZCIsIndpbmRvdyIsImNvbmZpZ3VyZSIsIm5hbWVzIiwidmFsdWVzIiwiQXJyYXkiLCJpc0FycmF5IiwiaWQiLCJvbmNvbnRleHRtZW51IiwiYm9keSIsIm9ubW91c2Vkb3duIiwicmVnaXN0ZXIiLCJfZ2FxIiwicHVzaCIsImdhIiwidHlwZSIsImFzeW5jIiwibG9jYXRpb24iLCJwcm90b2NvbCIsInMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInBhcmVudE5vZGUiLCJpbnNlcnRCZWZvcmUiXSwibWFwcGluZ3MiOiJBQUNBLEdBQUlBLHVCQUNGQyxjQUFlLGlCQUNmQyxpQkFBa0IsNEVBQ2xCQyxxQkFBc0IsMkJBQ3RCQyxxQkFBc0IscUVBQ3RCQyxZQUFhLE9BQ2JDLFVBQVcsNkNBSVRDLFdBQWFBLGNBQ2pCQSxZQUFXQyxPQUFTRCxXQUFXQyxXQUUvQkQsV0FBV0MsT0FBT0MsWUFBYyxXQUM5QixZQVVBLFNBQVNDLEdBQWVDLEVBQVFDLEdBQzlCLEdBQUlDLEdBQU8sSUFHUEYsR0FBT0csT0FDVEQsRUFBT0YsRUFFSEUsRUFBS0UsV0FDUEYsRUFBS0csWUFBY0MsRUFBY0osRUFBS0UsV0FHeENGLEVBQUtLLFdBQWFDLEVBQ2xCTixFQUFLTyxXQUFhQyxFQUVsQlQsRUFBR0MsSUFHSEQsRUFBR0MsR0FLUCxRQUFTUyxLQUNQLEdBQUlDLEdBQU8sR0FBSUMsTUFDYkMsRUFBT0YsRUFBS0csaUJBQ1pDLEVBQVFKLEVBQUtLLGNBQWdCLEVBQzdCQyxFQUFNTixFQUFLTyxZQVViLE9BUlksSUFBUkgsSUFDRkEsRUFBUSxJQUFNQSxHQUdOLEdBQU5FLElBQ0ZBLEVBQU0sSUFBTUEsR0FHUEosRUFBT0UsRUFBUUUsRUFNeEIsUUFBU1osR0FBY2MsR0FDckIsR0FDRUMsR0FERUMsRUFBWSxPQUdoQixPQUFLRixJQUFzQixnQkFBUkEsSUFJbkJDLEVBQU1ELEVBQUlHLE9BQU9ILEVBQUlJLFlBQVksS0FBTyxHQUdwQ0YsRUFBVUcsS0FBS0osS0FDakJBLEVBQU1BLEVBQUlFLE9BQU8sRUFBeUIsS0FBckJGLEVBQUlLLFFBQVEsS0FBZUwsRUFBSUssUUFBUSxLQUFPTCxFQUFJTSxRQUV2RU4sRUFBTUEsRUFBSUUsT0FBTyxFQUF5QixLQUFyQkYsRUFBSUssUUFBUSxLQUFlTCxFQUFJSyxRQUFRLEtBQU9MLEVBQUlNLFFBRXZFTixFQUFNQSxFQUFJRSxPQUFPLEVBQXlCLEtBQXJCRixFQUFJSyxRQUFRLEtBQWVMLEVBQUlLLFFBQVEsS0FBT0wsRUFBSU0sU0FHbEVOLEVBQUlPLGVBZEYsS0FpQlgsUUFBU0MsR0FBYzdCLEdBQ3JCLEdBQUk4QixJQUNGQyxLQUFRLHFDQUNSQyxpQkFBbUIsRUFDbkJDLHFCQUF1QixFQUN2QkMsZUFBa0J2QixJQUNsQndCLE9BQ0VDLFNBQVksTUFHaEJDLEVBQU9DLEtBQUtDLE1BQU1ELEtBQUtFLFVBQVVWLEdBTWpDLE9BSkFPLEdBQUtGLEtBQUssR0FBR0MsU0FBV0ssS0FBS0MsU0FBU0MsU0FBUyxJQUFJcEIsT0FBTyxHQUFHcUIsY0FDN0RQLEVBQUtGLEtBQUssR0FBR2pDLEtBQU9vQyxLQUFLQyxNQUFNRCxLQUFLRSxVQUFVeEMsSUFDOUNxQyxFQUFLRixLQUFLLEdBQUdqQyxLQUFLMkMsSUFBSyxHQUFJaEMsT0FBT2lDLGNBRTNCVCxFQUdULFFBQVNVLEdBQVNDLEVBQU9oRCxHQUN2QkQsRUFBZUMsRUFBUSxTQUFTRSxHQUNqQixPQUFUQSxHQUNGTixXQUFXQyxPQUFPb0QsT0FBT0MsSUFBSUYsRUFBTzlDLEtBTTFDLFFBQVNpRCxHQUFPQyxFQUFTQyxHQUN2QjdDLEVBQVk0QyxFQUNaMUMsRUFBWTJDLEVBdEdiLEdBQUkzQyxHQUFZLEdBQ2ZGLEVBQVksRUF3R2QsUUFDRXFCLGNBQWlCQSxFQUNqQnZCLGNBQWlCQSxFQUNqQnlDLFNBQVlBLEVBQ1pJLE9BQVVBLE1BSWR2RCxXQUFXQyxPQUFPb0QsT0FBUyxTQUFVSyxHQUNuQyxZQWlCQSxTQUFTQyxHQUFhdEQsR0FDcEIsR0FBSXVELEdBQU0sR0FBSUMsZUFFZCxPQUFJLElBQUk1QyxNQUFTNkMsRUFBYyxNQUN0QnpELE9BR1R1RCxFQUFJRyxLQUFLLE9BQVFDLEdBQWEsR0FDOUJKLEVBQUlLLFVBQVksV0FDZCxHQUFJQyxHQUFPeEIsS0FBS0MsTUFBTWlCLEVBQUlPLFNBRTFCOUQsSUFBSytELE1BQU9GLEVBQUtHLGFBQWNDLFlBQWEsR0FBSXJELFNBR2xEMkMsRUFBSVcsT0FQSlgsUUFVRixRQUFTWSxHQUFZakUsR0FDbkIsTUFBT2tFLElBQWFDLElBQWNuRSxFQU1wQyxRQUFTK0MsR0FBSXFCLEVBQVd2RSxHQWF0QixRQUFTd0UsR0FBZ0JDLEdBQ3ZCLEdBQ0VDLEdBQVl0RCxFQURWb0MsRUFBTSxHQUFJQyxlQUdkckMsR0FBTXVELEVBQVdDLFFBQVEsV0FBWUwsR0FDckNiLEVBQWNlLEVBQVlQLGFBQWVSLEVBQ3pDTSxFQUFRUyxFQUFZVCxPQUFTQSxFQUM3QlUsRUFBYXBCLEVBQU16QixjQUFjN0IsR0FHakN3RCxFQUFJRyxLQUFLLE9BQVF2QyxHQUFLLEdBQ3RCb0MsRUFBSXFCLGlCQUFpQixlQUFnQixvQkFDckNyQixFQUFJcUIsaUJBQWlCLGdCQUFpQixVQUFZYixHQUU5Q2hFLEVBQU9DLElBQTJCLGtCQUFkRCxHQUFPQyxLQUM3QnVELEVBQUlLLFVBQVksV0FDZDdELEVBQU9DLEdBQUd1RCxFQUFJTyxZQUlsQlAsRUFBSVcsS0FBSzdCLEtBQUtFLFVBQVVrQyxJQWhDMUIsTUFBS0gsSUFBY3ZFLEdBQVdBLEVBQU84RSxlQUFlLFdBQWE5RSxFQUFPRyxPQUNyRUgsRUFBTzhFLGVBQWUsVUFBWVYsRUFBWXBFLEVBQU9HLFFBa0N4RCxNQTlCQWtFLElBQVcsRUFDWEMsRUFBWXRFLEVBQU9HLE1BRW5CNEUsV0FBVyxXQUNUVixHQUFXLEdBQ1ZXLEdBeUJJekIsRUFBYWlCLEdBM0V0QixHQUFJWixHQUFjLHdEQUEwRHZFLHFCQUFxQkUsaUJBQzdGLGtCQUFvQkYscUJBQXFCRyxxQkFDekMsa0JBQW9CSCxxQkFBcUJJLHFCQUN6Qyw0QkFFQWtGLEVBQWEsc0hBQ2ZOLEdBQVcsRUFDWFcsRUFBZ0IsSUFDaEJWLEVBQVksR0FDWlosRUFBYyxFQUNkTSxFQUFRLEVBb0VWLFFBQ0VkLElBQU9BLElBRVJ0RCxXQUFXQyxPQUFPQyxhQUVFLG1CQUFabUYsVUFDVEEsUUFBUUMsT0FBTyxvQ0FDWkMsU0FBUyxpQkFBa0Isd0JBQzNCQSxTQUFTLGdCQUFpQixRQUcvQixJQUFJQyxTQUNGMUYsWUFBYSxRQUtYRSxXQUFhQSxjQUNqQkEsWUFBV3lGLFdBRVh6RixXQUFXeUYsUUFBVSxTQUFXQyxFQUFVQyxHQUV4QyxZQWNBLFNBQVNDLEtBQ1BELEVBQVFFLElBQUlDLEtBQUssR0FBSSxnQkFBaUIsS0FBTUMsRUFBT0MsVUFBVSxPQUMzRCxHQUFNLEdBQU0sR0FBTSxHQUFNLEdBRzVCLFFBQVNDLEdBQWE1RixHQUlwQixRQUFTNkYsR0FBb0JDLEdBQzNCLEdBQUlDLElBQVUsRUFDWkMsRUFBU0YsRUFBRUcsT0FBT0Msa0JBQWtCLGtCQUVsQ0YsSUFBb0MsZUFBekJBLEVBQU9yRCxnQkFDcEJHLEdBQ0U1QyxNQUFTLFFBQ1RpRyxjQUFpQix5QkFDakJDLGNBQWlCLGFBQ2pCakYsSUFBT2tGLElBR1RDLEVBQVNDLEtBQUsscUxBSWRSLEdBQVUsR0FHUi9GLEdBQXFCLGtCQUFQQSxJQUNoQkEsRUFBRytGLEdBdkJQLEdBQUlTLEdBQVcsZ0NBQWtDSCxFQUMvQ0ksRUFBVSxHQUFJakQsZUEwQmhCaUQsR0FBUUMsaUJBQWlCLE9BQVFiLEdBQ2pDWSxFQUFRL0MsS0FBSyxNQUFPOEMsR0FDcEJDLEVBQVF2QyxPQUdWLFFBQVN5QyxLQUNQLEdBQUlDLEdBQVl2QixFQUFTd0IsZUFBZSxhQUN0Q0MsRUFBUXpCLEVBQVN3QixlQUFlLGlCQUNoQ0UsRUFBZ0JyQixFQUFPc0IsT0FBTyxPQUFTdEIsRUFBT3NCLE9BQU8sT0FBVSxHQUU3REosSUFBYUUsSUFFZkYsRUFBVUssTUFBTUMsV0FBYSxTQUU3QkMsRUFBV0wsR0FDWE0sRUFBU04sR0FHUyxJQUFkTyxJQUNGTixHQUFnQk0sRUFBWTNCLEVBQU9zQixPQUFPLE9BQVUsS0FHdERKLEVBQVVVLGFBQWEsUUFBUyxrQkFBb0JQLEVBQWMsTUFJdEUsUUFBU0ssR0FBU04sR0FDakIsR0FDRVMsR0FERUMsRUFBT0MsV0FBV0MsRUFBa0JGLEtBSXZDRCxHQUFZLFlBQWNDLEVBQU8sMEJBQ0pBLEVBQU8sb0RBRVRBLEVBQU8sdURBRUZBLEVBQU8sb0RBRWZBLEVBQU8sMkJBRy9CRCxHQUFhLFVBQWMsRUFBSUMsRUFBUSxJQUFPLGFBQzdCLEVBQUlBLEVBQVEsSUFBTyxJQUVwQyxJQUFJRyxHQUFlYixFQUFNYyxhQUFhLFFBQ2xDRCxLQUNGSixFQUFZSSxFQUFlSixHQUc3QlQsRUFBTVEsYUFBYSxRQUFTQyxHQUc5QixRQUFTSixHQUFXTCxHQUNsQixHQUFJZSxHQUFjLEdBQ2hCQyxFQUFhLENBRWYsSUFBSUosRUFBa0JLLFFBQVVMLEVBQWtCSyxPQUFPQyxZQUNkLFdBQXhDTixFQUFrQkssT0FBT0MsYUFDdEJOLEVBQWtCSyxPQUFPRCxXQUFhLElBQ3hDQSxFQUFhSixFQUFrQkssT0FBT0QsWUFHcENKLEVBQWtCSyxPQUFPRSxTQUFXLElBQ3RDWixFQUFZSyxFQUFrQkssT0FBT0UsVUFJbkIsSUFBZkgsR0FBb0MsSUFBZFQsR0FBa0IsQ0FDM0NRLEVBQWMsWUFBbUJSLEVBQVksV0FBYVMsRUFBYSxLQUV2RSxJQUFJSCxHQUFlYixFQUFNYyxhQUFhLFFBQ2xDRCxLQUNGRSxFQUFjRixFQUFlRSxHQUcvQmYsRUFBTVEsYUFBYSxRQUFTTyxJQUtsQyxRQUFTSyxLQUNQQyxFQUFjQyxZQUFZLFdBRXhCQyxLQUNDWCxFQUFrQlksU0FHdkIsUUFBU0QsS0FDUCxHQUFJdkIsR0FBUXpCLEVBQVN3QixlQUFlLGlCQUNsQ0QsRUFBWXZCLEVBQVN3QixlQUFlLFlBRWxDRCxJQUFhRSxJQUNmQSxFQUFNeUIsT0FBUyxXQUNiekIsRUFBTXlCLE9BQVMsS0FHZjNCLEVBQVVLLE1BQU1DLFdBQWEsVUFHekJRLEVBQWtCWSxRQUFVLEdBQXFCLE9BQWhCSCxHQUNuQ0QsS0FJSnBCLEVBQU1RLGFBQWEsTUFBT2pCLElBSTlCLFFBQVNtQyxLQUNQLEdBQUkxQixHQUFRekIsRUFBU3dCLGVBQWUsZ0JBRWhDYSxHQUFrQlksUUFBVSxHQUM5QkcsY0FBY04sR0FHWnJCLElBQ0ZBLEVBQU00QixJQUFNLGVBS2hCLFFBQVNDLEtBQ1ByQyxFQUFXLEdBQUkzRyxZQUFXQyxPQUFPZ0osUUFBUXZELEVBQVN3QixlQUFlLGFBQy9EeEIsRUFBU3dCLGVBQWUscUJBRzFCUixFQUFPcUIsRUFBa0J2RyxJQUdHLEtBQXhCa0YsRUFBSzVFLFFBQVEsU0FDZjRFLEVBQU8sVUFBWUEsR0FHckJULEVBQWEsU0FBU0csR0FDaEJBLEdBQ0ZZLElBR0ZwQixNQU9KLFFBQVNzRCxLQUNQLE1BQU8saUJBR1QsUUFBUy9GLEdBQVMvQyxHQUNoQkosV0FBV0MsT0FBT0MsWUFBWWlELFNBQVMrRixJQUFnQjlJLEdBR3pELFFBQVMrSSxLQUNQTixJQUdGLFFBQVNPLEtBQ1BWLElBR0YsUUFBU1csS0FDUEYsSUFHRixRQUFTRyxHQUFvQkMsR0FDM0J4QixFQUFvQnJGLEtBQUtDLE1BQU1ELEtBQUtFLFVBQVUyRyxJQUU5Q1AsSUFwTkYsR0FBSWpELEdBQVMsR0FBSUosR0FBUTZELE1BQ3ZCekIsRUFBb0IsS0FDcEJyQixFQUFPLEdBQ1BnQixFQUFZLEVBQ1pjLEVBQWMsS0FFWjdCLEVBQVcsSUFpTmYsUUFDRXVDLGFBQWdCQSxFQUNoQi9GLFNBQVlBLEVBQ1ptRyxvQkFBdUJBLEVBQ3ZCSCxNQUFTQSxFQUNUQyxLQUFRQSxFQUNSQyxLQUFRQSxJQUdUM0QsU0FBVUMsUUFFYixJQUFJM0YsWUFBYUEsY0FDakJBLFlBQVdDLE9BQVNELFdBQVdDLFdBRS9CRCxXQUFXQyxPQUFPZ0osUUFBVSxTQUFVUSxFQUFlQyxHQUNuRCxZQUlBLFNBQVNWLEtBQ1AsSUFDRVUsRUFBaUJwQyxNQUFNcUMsT0FBU0YsRUFBY25DLE1BQU1xQyxPQUNwRCxNQUFPeEQsR0FDUHlELFFBQVFDLEtBQUssOEJBQStCMUQsRUFBRTJELFVBT2xELFFBQVNDLEtBQ1AsR0FBSUMsRUFBUyxDQUVYLEtBQU9OLEVBQWlCTyxZQUN0QlAsRUFBaUJRLFlBQVlSLEVBQWlCTyxXQUloRFAsR0FBaUJwQyxNQUFNN0QsUUFBVSxPQUdqQ2dHLEVBQWNuQyxNQUFNQyxXQUFhLFVBRWpDeUMsR0FBVSxHQUlkLFFBQVNwRCxHQUFLa0QsR0FDWixHQUNFSyxHQURFQyxFQUFXMUUsU0FBUzJFLHdCQUduQkwsSUFpQkhHLEVBQUlULEVBQWlCWSxjQUFjLFlBQ25DSCxFQUFFSSxVQUFZVCxJQWhCZEwsRUFBY25DLE1BQU1DLFdBQWEsU0FFakNtQyxFQUFpQnBDLE1BQU03RCxRQUFVLFFBR2pDMEcsRUFBSXpFLFNBQVM4RSxjQUFjLEtBQzNCTCxFQUFFSSxVQUFZVCxFQUNkSyxFQUFFeEMsYUFBYSxRQUFTLFdBRXhCeUMsRUFBU0ssWUFBWU4sR0FDckJULEVBQWlCZSxZQUFZTCxHQUU3QkosR0FBVSxHQWhEZCxHQUFJQSxJQUFVLENBMERkLE9BRkFoQixNQUdFZSxLQUFRQSxFQUNSbkQsS0FBUUEsSUFNWixTQUFXOEQsRUFBUWhGLEVBQVVDLEdBQzNCLFlBYUEsU0FBU2dGLEdBQVVDLEVBQU9DLEdBQ3hCLEdBQUl0QixHQUNGM0ksRUFBWSxHQUNaRSxFQUFZLEVBRVZnSyxPQUFNQyxRQUFRSCxJQUFVQSxFQUFNN0ksT0FBUyxHQUFLK0ksTUFBTUMsUUFBUUYsSUFBV0EsRUFBTzlJLE9BQVMsSUFFdEUsY0FBYjZJLEVBQU0sS0FDUmhLLEVBQVlpSyxFQUFPLElBSUosY0FBYkQsRUFBTSxLQUVOOUosRUFERStKLEVBQU8sR0FDR0EsRUFBTyxHQUdQLFdBS2hCN0ssV0FBV0MsT0FBT0MsWUFBWXFELE9BQU8zQyxFQUFXRSxHQUcvQixxQkFBYjhKLEVBQU0sS0FDUnJCLEVBQW1CN0csS0FBS0MsTUFBTWtJLEVBQU8sSUFFckM3SyxXQUFXeUYsUUFBUTZELG9CQUFvQkMsS0FLN0MsUUFBU0gsS0FDUHBKLFdBQVd5RixRQUFRMkQsT0FHckIsUUFBU0QsS0FDUG5KLFdBQVd5RixRQUFRMEQsUUFHckIsUUFBU0UsS0FDUHJKLFdBQVd5RixRQUFRNEQsT0FyRHJCLEdBQUkyQixJQUFLLEdBQUlyRixHQUFRNkQsT0FBUXhELFVBQVUsS0FHdkMwRSxHQUFPTyxjQUFnQixXQUNyQixPQUFPLEdBR1R2RixFQUFTd0YsS0FBS0MsWUFBYyxXQUMxQixPQUFPLEdBZ0RMSCxHQUFhLEtBQVBBLElBQ1JyRixFQUFRRSxJQUFJdUYsU0FBUyxjQUFnQkosRUFBSTVCLEdBQ3pDekQsRUFBUUUsSUFBSXVGLFNBQVMsZUFBaUJKLEVBQUk3QixHQUMxQ3hELEVBQVFFLElBQUl1RixTQUFTLGNBQWdCSixFQUFJM0IsR0FDekMxRCxFQUFRRSxJQUFJdUYsU0FBUyxlQUFpQkosRUFBSUwsR0FDMUNoRixFQUFRRSxJQUFJQyxLQUFLLEdBQUksY0FBZSxLQUFNa0YsR0FBSyxZQUFhLFlBQWEsdUJBRzFFTixPQUFRaEYsU0FBVUMsUUFLckIsSUFBSTBGLE1BQU9BLFFBRVhBLE1BQUtDLE1BQU0sY0FBZSxrQkFDMUJELEtBQUtDLE1BQU0sbUJBRVgsV0FDRSxHQUFJQyxHQUFLN0YsU0FBUzhFLGNBQWMsU0FBV2UsR0FBR0MsS0FBTyxrQkFBbUJELEVBQUdFLE9BQVEsRUFDbkZGLEVBQUd4QyxLQUFPLFVBQVlyRCxTQUFTZ0csU0FBU0MsU0FBVyxjQUFnQixjQUFnQiw2QkFDbkYsSUFBSUMsR0FBSWxHLFNBQVNtRyxxQkFBcUIsVUFBVSxFQUFJRCxHQUFFRSxXQUFXQyxhQUFhUixFQUFJSyIsImZpbGUiOiJqcy93aWRnZXQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXhwb3J0ZWQgV0lER0VUX0NPTU1PTl9DT05GSUcgKi9cbnZhciBXSURHRVRfQ09NTU9OX0NPTkZJRyA9IHtcbiAgQVVUSF9QQVRIX1VSTDogXCJ2MS93aWRnZXQvYXV0aFwiLFxuICBMT0dHRVJfQ0xJRU5UX0lEOiBcIjEwODg1MjcxNDcxMDktNnExbzJ2dGlobjM0MjkycGp0NGNraG1oY2swcmswbzcuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb21cIixcbiAgTE9HR0VSX0NMSUVOVF9TRUNSRVQ6IFwibmxaeXJjUExnNm9Fd085ZjlXZm4yOVdoXCIsXG4gIExPR0dFUl9SRUZSRVNIX1RPS0VOOiBcIjEveHp0NGt3ekUxSDdXOVZuS0I4Y0FhQ3g2emI0RXM0bktFb3FhWUhkVEQxNUlnT3JKRHRkdW42eks2WGlBVENLVFwiLFxuICBTVE9SQUdFX0VOVjogXCJwcm9kXCIsXG4gIFNUT1JFX1VSTDogXCJodHRwczovL3N0b3JlLWRvdC1ydmFzZXJ2ZXIyLmFwcHNwb3QuY29tL1wiXG59O1xuLyogZ2xvYmFsIFdJREdFVF9DT01NT05fQ09ORklHICovXG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uQ29tbW9uID0gUmlzZVZpc2lvbi5Db21tb24gfHwge307XG5cblJpc2VWaXNpb24uQ29tbW9uLkxvZ2dlclV0aWxzID0gKGZ1bmN0aW9uKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICAgdmFyIGRpc3BsYXlJZCA9IFwiXCIsXG4gICAgY29tcGFueUlkID0gXCJcIjtcblxuICAvKlxuICAgKiAgUHJpdmF0ZSBNZXRob2RzXG4gICAqL1xuXG4gIC8qIFJldHJpZXZlIHBhcmFtZXRlcnMgdG8gcGFzcyB0byB0aGUgZXZlbnQgbG9nZ2VyLiAqL1xuICBmdW5jdGlvbiBnZXRFdmVudFBhcmFtcyhwYXJhbXMsIGNiKSB7XG4gICAgdmFyIGpzb24gPSBudWxsO1xuXG4gICAgLy8gZXZlbnQgaXMgcmVxdWlyZWQuXG4gICAgaWYgKHBhcmFtcy5ldmVudCkge1xuICAgICAganNvbiA9IHBhcmFtcztcblxuICAgICAgaWYgKGpzb24uZmlsZV91cmwpIHtcbiAgICAgICAganNvbi5maWxlX2Zvcm1hdCA9IGdldEZpbGVGb3JtYXQoanNvbi5maWxlX3VybCk7XG4gICAgICB9XG5cbiAgICAgIGpzb24uY29tcGFueV9pZCA9IGNvbXBhbnlJZDtcbiAgICAgIGpzb24uZGlzcGxheV9pZCA9IGRpc3BsYXlJZDtcblxuICAgICAgY2IoanNvbik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgY2IoanNvbik7XG4gICAgfVxuICB9XG5cbiAgLy8gR2V0IHN1ZmZpeCBmb3IgQlEgdGFibGUgbmFtZS5cbiAgZnVuY3Rpb24gZ2V0U3VmZml4KCkge1xuICAgIHZhciBkYXRlID0gbmV3IERhdGUoKSxcbiAgICAgIHllYXIgPSBkYXRlLmdldFVUQ0Z1bGxZZWFyKCksXG4gICAgICBtb250aCA9IGRhdGUuZ2V0VVRDTW9udGgoKSArIDEsXG4gICAgICBkYXkgPSBkYXRlLmdldFVUQ0RhdGUoKTtcblxuICAgIGlmIChtb250aCA8IDEwKSB7XG4gICAgICBtb250aCA9IFwiMFwiICsgbW9udGg7XG4gICAgfVxuXG4gICAgaWYgKGRheSA8IDEwKSB7XG4gICAgICBkYXkgPSBcIjBcIiArIGRheTtcbiAgICB9XG5cbiAgICByZXR1cm4geWVhciArIG1vbnRoICsgZGF5O1xuICB9XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBnZXRGaWxlRm9ybWF0KHVybCkge1xuICAgIHZhciBoYXNQYXJhbXMgPSAvWz8jJl0vLFxuICAgICAgc3RyO1xuXG4gICAgaWYgKCF1cmwgfHwgdHlwZW9mIHVybCAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgc3RyID0gdXJsLnN1YnN0cih1cmwubGFzdEluZGV4T2YoXCIuXCIpICsgMSk7XG5cbiAgICAvLyBkb24ndCBpbmNsdWRlIGFueSBwYXJhbXMgYWZ0ZXIgdGhlIGZpbGVuYW1lXG4gICAgaWYgKGhhc1BhcmFtcy50ZXN0KHN0cikpIHtcbiAgICAgIHN0ciA9IHN0ci5zdWJzdHIoMCAsKHN0ci5pbmRleE9mKFwiP1wiKSAhPT0gLTEpID8gc3RyLmluZGV4T2YoXCI/XCIpIDogc3RyLmxlbmd0aCk7XG5cbiAgICAgIHN0ciA9IHN0ci5zdWJzdHIoMCwgKHN0ci5pbmRleE9mKFwiI1wiKSAhPT0gLTEpID8gc3RyLmluZGV4T2YoXCIjXCIpIDogc3RyLmxlbmd0aCk7XG5cbiAgICAgIHN0ciA9IHN0ci5zdWJzdHIoMCwgKHN0ci5pbmRleE9mKFwiJlwiKSAhPT0gLTEpID8gc3RyLmluZGV4T2YoXCImXCIpIDogc3RyLmxlbmd0aCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN0ci50b0xvd2VyQ2FzZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0SW5zZXJ0RGF0YShwYXJhbXMpIHtcbiAgICB2YXIgQkFTRV9JTlNFUlRfU0NIRU1BID0ge1xuICAgICAgXCJraW5kXCI6IFwiYmlncXVlcnkjdGFibGVEYXRhSW5zZXJ0QWxsUmVxdWVzdFwiLFxuICAgICAgXCJza2lwSW52YWxpZFJvd3NcIjogZmFsc2UsXG4gICAgICBcImlnbm9yZVVua25vd25WYWx1ZXNcIjogZmFsc2UsXG4gICAgICBcInRlbXBsYXRlU3VmZml4XCI6IGdldFN1ZmZpeCgpLFxuICAgICAgXCJyb3dzXCI6IFt7XG4gICAgICAgIFwiaW5zZXJ0SWRcIjogXCJcIlxuICAgICAgfV1cbiAgICB9LFxuICAgIGRhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KEJBU0VfSU5TRVJUX1NDSEVNQSkpO1xuXG4gICAgZGF0YS5yb3dzWzBdLmluc2VydElkID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIpLnRvVXBwZXJDYXNlKCk7XG4gICAgZGF0YS5yb3dzWzBdLmpzb24gPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHBhcmFtcykpO1xuICAgIGRhdGEucm93c1swXS5qc29uLnRzID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuXG4gICAgcmV0dXJuIGRhdGE7XG4gIH1cblxuICBmdW5jdGlvbiBsb2dFdmVudCh0YWJsZSwgcGFyYW1zKSB7XG4gICAgZ2V0RXZlbnRQYXJhbXMocGFyYW1zLCBmdW5jdGlvbihqc29uKSB7XG4gICAgICBpZiAoanNvbiAhPT0gbnVsbCkge1xuICAgICAgICBSaXNlVmlzaW9uLkNvbW1vbi5Mb2dnZXIubG9nKHRhYmxlLCBqc29uKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qIFNldCB0aGUgQ29tcGFueSBhbmQgRGlzcGxheSBJRHMuICovXG4gIGZ1bmN0aW9uIHNldElkcyhjb21wYW55LCBkaXNwbGF5KSB7XG4gICAgY29tcGFueUlkID0gY29tcGFueTtcbiAgICBkaXNwbGF5SWQgPSBkaXNwbGF5O1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcImdldEluc2VydERhdGFcIjogZ2V0SW5zZXJ0RGF0YSxcbiAgICBcImdldEZpbGVGb3JtYXRcIjogZ2V0RmlsZUZvcm1hdCxcbiAgICBcImxvZ0V2ZW50XCI6IGxvZ0V2ZW50LFxuICAgIFwic2V0SWRzXCI6IHNldElkc1xuICB9O1xufSkoKTtcblxuUmlzZVZpc2lvbi5Db21tb24uTG9nZ2VyID0gKGZ1bmN0aW9uKHV0aWxzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBSRUZSRVNIX1VSTCA9IFwiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3YzL3Rva2VuP2NsaWVudF9pZD1cIiArIFdJREdFVF9DT01NT05fQ09ORklHLkxPR0dFUl9DTElFTlRfSUQgK1xuICAgICAgXCImY2xpZW50X3NlY3JldD1cIiArIFdJREdFVF9DT01NT05fQ09ORklHLkxPR0dFUl9DTElFTlRfU0VDUkVUICtcbiAgICAgIFwiJnJlZnJlc2hfdG9rZW49XCIgKyBXSURHRVRfQ09NTU9OX0NPTkZJRy5MT0dHRVJfUkVGUkVTSF9UT0tFTiArXG4gICAgICBcIiZncmFudF90eXBlPXJlZnJlc2hfdG9rZW5cIjtcblxuICB2YXIgc2VydmljZVVybCA9IFwiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vYmlncXVlcnkvdjIvcHJvamVjdHMvY2xpZW50LXNpZGUtZXZlbnRzL2RhdGFzZXRzL1dpZGdldF9FdmVudHMvdGFibGVzL1RBQkxFX0lEL2luc2VydEFsbFwiLFxuICAgIHRocm90dGxlID0gZmFsc2UsXG4gICAgdGhyb3R0bGVEZWxheSA9IDEwMDAsXG4gICAgbGFzdEV2ZW50ID0gXCJcIixcbiAgICByZWZyZXNoRGF0ZSA9IDAsXG4gICAgdG9rZW4gPSBcIlwiO1xuXG4gIC8qXG4gICAqICBQcml2YXRlIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIHJlZnJlc2hUb2tlbihjYikge1xuICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblxuICAgIGlmIChuZXcgRGF0ZSgpIC0gcmVmcmVzaERhdGUgPCAzNTgwMDAwKSB7XG4gICAgICByZXR1cm4gY2Ioe30pO1xuICAgIH1cblxuICAgIHhoci5vcGVuKFwiUE9TVFwiLCBSRUZSRVNIX1VSTCwgdHJ1ZSk7XG4gICAgeGhyLm9ubG9hZGVuZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHJlc3AgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZSk7XG5cbiAgICAgIGNiKHsgdG9rZW46IHJlc3AuYWNjZXNzX3Rva2VuLCByZWZyZXNoZWRBdDogbmV3IERhdGUoKSB9KTtcbiAgICB9O1xuXG4gICAgeGhyLnNlbmQoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzVGhyb3R0bGVkKGV2ZW50KSB7XG4gICAgcmV0dXJuIHRocm90dGxlICYmIChsYXN0RXZlbnQgPT09IGV2ZW50KTtcbiAgfVxuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gbG9nKHRhYmxlTmFtZSwgcGFyYW1zKSB7XG4gICAgaWYgKCF0YWJsZU5hbWUgfHwgIXBhcmFtcyB8fCAocGFyYW1zLmhhc093blByb3BlcnR5KFwiZXZlbnRcIikgJiYgIXBhcmFtcy5ldmVudCkgfHxcbiAgICAgIChwYXJhbXMuaGFzT3duUHJvcGVydHkoXCJldmVudFwiKSAmJiBpc1Rocm90dGxlZChwYXJhbXMuZXZlbnQpKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRocm90dGxlID0gdHJ1ZTtcbiAgICBsYXN0RXZlbnQgPSBwYXJhbXMuZXZlbnQ7XG5cbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIHRocm90dGxlID0gZmFsc2U7XG4gICAgfSwgdGhyb3R0bGVEZWxheSk7XG5cbiAgICBmdW5jdGlvbiBpbnNlcnRXaXRoVG9rZW4ocmVmcmVzaERhdGEpIHtcbiAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKSxcbiAgICAgICAgaW5zZXJ0RGF0YSwgdXJsO1xuXG4gICAgICB1cmwgPSBzZXJ2aWNlVXJsLnJlcGxhY2UoXCJUQUJMRV9JRFwiLCB0YWJsZU5hbWUpO1xuICAgICAgcmVmcmVzaERhdGUgPSByZWZyZXNoRGF0YS5yZWZyZXNoZWRBdCB8fCByZWZyZXNoRGF0ZTtcbiAgICAgIHRva2VuID0gcmVmcmVzaERhdGEudG9rZW4gfHwgdG9rZW47XG4gICAgICBpbnNlcnREYXRhID0gdXRpbHMuZ2V0SW5zZXJ0RGF0YShwYXJhbXMpO1xuXG4gICAgICAvLyBJbnNlcnQgdGhlIGRhdGEuXG4gICAgICB4aHIub3BlbihcIlBPU1RcIiwgdXJsLCB0cnVlKTtcbiAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQ29udGVudC1UeXBlXCIsIFwiYXBwbGljYXRpb24vanNvblwiKTtcbiAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQXV0aG9yaXphdGlvblwiLCBcIkJlYXJlciBcIiArIHRva2VuKTtcblxuICAgICAgaWYgKHBhcmFtcy5jYiAmJiB0eXBlb2YgcGFyYW1zLmNiID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgeGhyLm9ubG9hZGVuZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHBhcmFtcy5jYih4aHIucmVzcG9uc2UpO1xuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICB4aHIuc2VuZChKU09OLnN0cmluZ2lmeShpbnNlcnREYXRhKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlZnJlc2hUb2tlbihpbnNlcnRXaXRoVG9rZW4pO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcImxvZ1wiOiBsb2dcbiAgfTtcbn0pKFJpc2VWaXNpb24uQ29tbW9uLkxvZ2dlclV0aWxzKTtcbi8qIGV4cG9ydGVkIGNvbmZpZyAqL1xuaWYgKHR5cGVvZiBhbmd1bGFyICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gIGFuZ3VsYXIubW9kdWxlKFwicmlzZXZpc2lvbi5jb21tb24uaTE4bi5jb25maWdcIiwgW10pXG4gICAgLmNvbnN0YW50KFwiTE9DQUxFU19QUkVGSVhcIiwgXCJsb2NhbGVzL3RyYW5zbGF0aW9uX1wiKVxuICAgIC5jb25zdGFudChcIkxPQ0FMRVNfU1VGSVhcIiwgXCIuanNvblwiKTtcbn1cblxudmFyIGNvbmZpZyA9IHtcbiAgU1RPUkFHRV9FTlY6IFwicHJvZFwiXG59O1xuXG4vKiBnbG9iYWwgZ2FkZ2V0cyAqL1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLldlYlBhZ2UgPSB7fTtcblxuUmlzZVZpc2lvbi5XZWJQYWdlID0gKGZ1bmN0aW9uIChkb2N1bWVudCwgZ2FkZ2V0cykge1xuXG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIC8vIHByaXZhdGUgdmFyaWFibGVzXG4gIHZhciBfcHJlZnMgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpLFxuICAgIF9hZGRpdGlvbmFsUGFyYW1zID0gbnVsbCxcbiAgICBfdXJsID0gXCJcIixcbiAgICBfdmVydGljYWwgPSAwLFxuICAgIF9pbnRlcnZhbElkID0gbnVsbDtcblxuICB2YXIgX21lc3NhZ2UgPSBudWxsO1xuXG4gIC8qXG4gICAqICBQcml2YXRlIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIF9yZWFkeSgpIHtcbiAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNldmVudF9yZWFkeVwiLCBudWxsLCBfcHJlZnMuZ2V0U3RyaW5nKFwiaWRcIiksXG4gICAgICB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlLCBmYWxzZSk7XG4gIH1cblxuICBmdW5jdGlvbiBfdmFsaWRhdGVVcmwoY2IpIHtcbiAgICB2YXIgcHJveHlVcmwgPSBcImh0dHBzOi8vcHJveHkucmlzZXZpc2lvbi5jb20vXCIgKyBfdXJsLFxuICAgICAgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuXG4gICAgZnVuY3Rpb24gaGFuZGxlUHJveHlSZXNwb25zZShlKSB7XG4gICAgICB2YXIgc3VjY2VzcyA9IHRydWUsXG4gICAgICAgIGhlYWRlciA9IGUudGFyZ2V0LmdldFJlc3BvbnNlSGVhZGVyKFwiWC1GcmFtZS1PcHRpb25zXCIpO1xuXG4gICAgICBpZiAoaGVhZGVyICYmIChoZWFkZXIudG9VcHBlckNhc2UoKSA9PT0gXCJTQU1FT1JJR0lOXCIpKSB7XG4gICAgICAgIGxvZ0V2ZW50KHtcbiAgICAgICAgICBcImV2ZW50XCI6IFwiZXJyb3JcIixcbiAgICAgICAgICBcImV2ZW50X2RldGFpbHNcIjogXCJYLUZyYW1lLU9wdGlvbnMgaGVhZGVyXCIsXG4gICAgICAgICAgXCJlcnJvcl9kZXRhaWxzXCI6IFwiU0FNRU9SSUdJTlwiLFxuICAgICAgICAgIFwidXJsXCI6IF91cmxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgX21lc3NhZ2Uuc2hvdyhcIlRoZSBvd25lciBvZiB0aGUgV2ViIFBhZ2UgYXQgdGhlIFVSTCBwcm92aWRlZCBkb2VzIG5vdCBhbGxvdyB0aGUgUGFnZSB0byBcIiArXG4gICAgICAgICAgXCJiZSBlbWJlZGRlZCB3aXRoaW4gYW4gaUZyYW1lLiBJZiBwb3NzaWJsZSwgcGxlYXNlIGNvbnRhY3QgdGhlIFdlYiBQYWdlIG93bmVyIHRvIFwiICtcbiAgICAgICAgICBcImRpc2N1c3MgWC1GcmFtZS1PcHRpb25zLlwiKTtcblxuICAgICAgICBzdWNjZXNzID0gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIGlmIChjYiAmJiAodHlwZW9mIGNiID09PSBcImZ1bmN0aW9uXCIpKSB7XG4gICAgICAgIGNiKHN1Y2Nlc3MpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgaGFuZGxlUHJveHlSZXNwb25zZSk7XG4gICAgcmVxdWVzdC5vcGVuKFwiR0VUXCIsIHByb3h5VXJsKTtcbiAgICByZXF1ZXN0LnNlbmQoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9jb25maWd1cmVQYWdlKCkge1xuICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvbnRhaW5lclwiKSxcbiAgICAgIGZyYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ3ZWJwYWdlLWZyYW1lXCIpLFxuICAgICAgYXNwZWN0UmF0aW8gPSAgKF9wcmVmcy5nZXRJbnQoXCJyc0hcIikgLyBfcHJlZnMuZ2V0SW50KFwicnNXXCIpKSAqIDEwMDtcblxuICAgIGlmIChjb250YWluZXIgJiYgZnJhbWUpIHtcbiAgICAgIC8vIEhpZGluZyBpZnJhbWUgY29udGFpbmVyLCB2aXNpYmxlIHdoZW4gdGhlIGlmcmFtZSBzdWNjZXNzZnVsbHkgbG9hZHNcbiAgICAgIGNvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcblxuICAgICAgX3NldFJlZ2lvbihmcmFtZSk7XG4gICAgICBfc2V0Wm9vbShmcmFtZSk7XG5cbiAgICAgIC8vIGltcGxlbWVudCByZXNwb25zaXZlIGlmcmFtZVxuICAgICAgaWYgKF92ZXJ0aWNhbCAhPT0gMCkge1xuICAgICAgICBhc3BlY3RSYXRpbyArPSAoX3ZlcnRpY2FsIC8gX3ByZWZzLmdldEludChcInJzV1wiKSkgKiAxMDA7XG4gICAgICB9XG5cbiAgICAgIGNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcInBhZGRpbmctYm90dG9tOlwiICsgYXNwZWN0UmF0aW8gKyBcIiVcIik7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gX3NldFpvb20oZnJhbWUpIHtcbiAgIHZhciB6b29tID0gcGFyc2VGbG9hdChfYWRkaXRpb25hbFBhcmFtcy56b29tKSxcbiAgICAgem9vbVN0eWxlO1xuXG4gICAgLy8gQ29uZmlndXJlIHRoZSB6b29tIChzY2FsZSkgc3R5bGluZ1xuICAgIHpvb21TdHlsZSA9IFwiLW1zLXpvb206XCIgKyB6b29tICsgXCI7XCIgK1xuICAgICAgXCItbW96LXRyYW5zZm9ybTogc2NhbGUoXCIgKyB6b29tICsgXCIpO1wiICtcbiAgICAgIFwiLW1vei10cmFuc2Zvcm0tb3JpZ2luOiAwIDA7XCIgK1xuICAgICAgXCItby10cmFuc2Zvcm06IHNjYWxlKFwiICsgem9vbSArIFwiKTtcIiArXG4gICAgICBcIi1vLXRyYW5zZm9ybS1vcmlnaW46IDAgMDtcIiArXG4gICAgICBcIi13ZWJraXQtdHJhbnNmb3JtOiBzY2FsZShcIiArIHpvb20gKyBcIik7XCIgK1xuICAgICAgXCItd2Via2l0LXRyYW5zZm9ybS1vcmlnaW46IDAgMDtcIiArXG4gICAgICBcInRyYW5zZm9ybTogc2NhbGUoXCIgKyB6b29tICsgXCIpO1wiICtcbiAgICAgIFwidHJhbnNmb3JtLW9yaWdpbjogMCAwO1wiO1xuXG4gICAgem9vbVN0eWxlICs9IFwid2lkdGg6IFwiICsgKCgxIC8gem9vbSkgKiAxMDApICsgXCIlO1wiICtcbiAgICAgIFwiaGVpZ2h0OiBcIiArICgoMSAvIHpvb20pICogMTAwKSArIFwiJTtcIjtcblxuICAgIHZhciBjdXJyZW50U3R5bGUgPSBmcmFtZS5nZXRBdHRyaWJ1dGUoXCJzdHlsZVwiKTtcbiAgICBpZiAoY3VycmVudFN0eWxlKSB7XG4gICAgICB6b29tU3R5bGUgPSBjdXJyZW50U3R5bGUgKyB6b29tU3R5bGU7XG4gICAgfVxuXG4gICAgZnJhbWUuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgem9vbVN0eWxlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9zZXRSZWdpb24oZnJhbWUpIHtcbiAgICB2YXIgbWFyZ2luU3R5bGUgPSBcIlwiLFxuICAgICAgaG9yaXpvbnRhbCA9IDA7XG5cbiAgICBpZiAoX2FkZGl0aW9uYWxQYXJhbXMucmVnaW9uICYmIF9hZGRpdGlvbmFsUGFyYW1zLnJlZ2lvbi5zaG93UmVnaW9uICYmXG4gICAgICAoX2FkZGl0aW9uYWxQYXJhbXMucmVnaW9uLnNob3dSZWdpb24gPT09IFwicmVnaW9uXCIpKSB7XG4gICAgICBpZiAoX2FkZGl0aW9uYWxQYXJhbXMucmVnaW9uLmhvcml6b250YWwgPiAwKSB7XG4gICAgICAgIGhvcml6b250YWwgPSBfYWRkaXRpb25hbFBhcmFtcy5yZWdpb24uaG9yaXpvbnRhbDtcbiAgICAgIH1cblxuICAgICAgaWYgKF9hZGRpdGlvbmFsUGFyYW1zLnJlZ2lvbi52ZXJ0aWNhbCA+IDApIHtcbiAgICAgICAgX3ZlcnRpY2FsID0gX2FkZGl0aW9uYWxQYXJhbXMucmVnaW9uLnZlcnRpY2FsO1xuICAgICAgfVxuXG4gICAgICAvLyBBcHBseSBuZWdhdGl2ZSBtYXJnaW5zIGluIG9yZGVyIHRvIHNob3cgYSByZWdpb24uXG4gICAgICBpZiAoKGhvcml6b250YWwgIT09IDApIHx8IChfdmVydGljYWwgIT09IDApKSB7XG4gICAgICAgIG1hcmdpblN0eWxlID0gXCJtYXJnaW46IFwiICsgXCItXCIgKyBfdmVydGljYWwgKyBcInB4IDAgMCAtXCIgKyBob3Jpem9udGFsICsgXCJweDtcIjtcblxuICAgICAgICB2YXIgY3VycmVudFN0eWxlID0gZnJhbWUuZ2V0QXR0cmlidXRlKFwic3R5bGVcIik7XG4gICAgICAgIGlmIChjdXJyZW50U3R5bGUpIHtcbiAgICAgICAgICBtYXJnaW5TdHlsZSA9IGN1cnJlbnRTdHlsZSArIG1hcmdpblN0eWxlO1xuICAgICAgICB9XG5cbiAgICAgICAgZnJhbWUuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgbWFyZ2luU3R5bGUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIF9zdGFydFJlZnJlc2hJbnRlcnZhbCgpIHtcbiAgICBfaW50ZXJ2YWxJZCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vIGNhbGwgcHVibGljIGZ1bmN0aW9uIGZvciBpbnRlZ3JhdGlvbiB0ZXN0aW5nIHB1cnBvc2VzXG4gICAgICBfbG9hZEZyYW1lKCk7XG4gICAgfSwgX2FkZGl0aW9uYWxQYXJhbXMucmVmcmVzaCk7XG4gIH1cblxuICBmdW5jdGlvbiBfbG9hZEZyYW1lKCkge1xuICAgIHZhciBmcmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwid2VicGFnZS1mcmFtZVwiKSxcbiAgICAgIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29udGFpbmVyXCIpO1xuXG4gICAgaWYgKGNvbnRhaW5lciAmJiBmcmFtZSkge1xuICAgICAgZnJhbWUub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBmcmFtZS5vbmxvYWQgPSBudWxsO1xuXG4gICAgICAgIC8vIFNob3cgdGhlIGlmcmFtZSBjb250YWluZXJcbiAgICAgICAgY29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSBcInZpc2libGVcIjtcblxuICAgICAgICAvLyBjaGVjayBpZiByZWZyZXNoIGludGVydmFsIHNob3VsZCBiZSBzdGFydGVkXG4gICAgICAgIGlmIChfYWRkaXRpb25hbFBhcmFtcy5yZWZyZXNoID4gMCAmJiBfaW50ZXJ2YWxJZCA9PT0gbnVsbCkge1xuICAgICAgICAgIF9zdGFydFJlZnJlc2hJbnRlcnZhbCgpO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBmcmFtZS5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgX3VybCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gX3VubG9hZEZyYW1lKCkge1xuICAgIHZhciBmcmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwid2VicGFnZS1mcmFtZVwiKTtcblxuICAgIGlmIChfYWRkaXRpb25hbFBhcmFtcy5yZWZyZXNoID4gMCkge1xuICAgICAgY2xlYXJJbnRlcnZhbChfaW50ZXJ2YWxJZCk7XG4gICAgfVxuXG4gICAgaWYgKGZyYW1lKSB7XG4gICAgICBmcmFtZS5zcmMgPSBcImFib3V0OmJsYW5rXCI7XG4gICAgfVxuXG4gIH1cblxuICBmdW5jdGlvbiBfaW5pdCgpIHtcbiAgICBfbWVzc2FnZSA9IG5ldyBSaXNlVmlzaW9uLkNvbW1vbi5NZXNzYWdlKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29udGFpbmVyXCIpLFxuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtZXNzYWdlQ29udGFpbmVyXCIpKTtcblxuICAgIC8vIENvbmZpZ3VyZSB0aGUgdmFsdWUgZm9yIF91cmxcbiAgICBfdXJsID0gX2FkZGl0aW9uYWxQYXJhbXMudXJsO1xuXG4gICAgLy8gQWRkIGh0dHA6Ly8gaWYgbm8gcHJvdG9jb2wgcGFyYW1ldGVyIGV4aXN0c1xuICAgIGlmIChfdXJsLmluZGV4T2YoXCI6Ly9cIikgPT09IC0xKSB7XG4gICAgICBfdXJsID0gXCJodHRwOi8vXCIgKyBfdXJsO1xuICAgIH1cblxuICAgIF92YWxpZGF0ZVVybChmdW5jdGlvbihzdWNjZXNzKSB7XG4gICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICBfY29uZmlndXJlUGFnZSgpO1xuICAgICAgfVxuXG4gICAgICBfcmVhZHkoKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gZ2V0VGFibGVOYW1lKCkge1xuICAgIHJldHVybiBcIndlYnBhZ2VfZXZlbnRzXCI7XG4gIH1cblxuICBmdW5jdGlvbiBsb2dFdmVudChwYXJhbXMpIHtcbiAgICBSaXNlVmlzaW9uLkNvbW1vbi5Mb2dnZXJVdGlscy5sb2dFdmVudChnZXRUYWJsZU5hbWUoKSwgcGFyYW1zKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhdXNlKCkge1xuICAgIF91bmxvYWRGcmFtZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGxheSgpIHtcbiAgICBfbG9hZEZyYW1lKCk7XG4gIH1cblxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIHBhdXNlKCk7XG4gIH1cblxuICBmdW5jdGlvbiBzZXRBZGRpdGlvbmFsUGFyYW1zKGFkZGl0aW9uYWxQYXJhbXMpIHtcbiAgICBfYWRkaXRpb25hbFBhcmFtcyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoYWRkaXRpb25hbFBhcmFtcykpO1xuXG4gICAgX2luaXQoKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJnZXRUYWJsZU5hbWVcIjogZ2V0VGFibGVOYW1lLFxuICAgIFwibG9nRXZlbnRcIjogbG9nRXZlbnQsXG4gICAgXCJzZXRBZGRpdGlvbmFsUGFyYW1zXCI6IHNldEFkZGl0aW9uYWxQYXJhbXMsXG4gICAgXCJwYXVzZVwiOiBwYXVzZSxcbiAgICBcInBsYXlcIjogcGxheSxcbiAgICBcInN0b3BcIjogc3RvcFxuICB9O1xuXG59KShkb2N1bWVudCwgZ2FkZ2V0cyk7XG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uQ29tbW9uID0gUmlzZVZpc2lvbi5Db21tb24gfHwge307XG5cblJpc2VWaXNpb24uQ29tbW9uLk1lc3NhZ2UgPSBmdW5jdGlvbiAobWFpbkNvbnRhaW5lciwgbWVzc2FnZUNvbnRhaW5lcikge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgX2FjdGl2ZSA9IGZhbHNlO1xuXG4gIGZ1bmN0aW9uIF9pbml0KCkge1xuICAgIHRyeSB7XG4gICAgICBtZXNzYWdlQ29udGFpbmVyLnN0eWxlLmhlaWdodCA9IG1haW5Db250YWluZXIuc3R5bGUuaGVpZ2h0O1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUud2FybihcIkNhbid0IGluaXRpYWxpemUgTWVzc2FnZSAtIFwiLCBlLm1lc3NhZ2UpO1xuICAgIH1cbiAgfVxuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gaGlkZSgpIHtcbiAgICBpZiAoX2FjdGl2ZSkge1xuICAgICAgLy8gY2xlYXIgY29udGVudCBvZiBtZXNzYWdlIGNvbnRhaW5lclxuICAgICAgd2hpbGUgKG1lc3NhZ2VDb250YWluZXIuZmlyc3RDaGlsZCkge1xuICAgICAgICBtZXNzYWdlQ29udGFpbmVyLnJlbW92ZUNoaWxkKG1lc3NhZ2VDb250YWluZXIuZmlyc3RDaGlsZCk7XG4gICAgICB9XG5cbiAgICAgIC8vIGhpZGUgbWVzc2FnZSBjb250YWluZXJcbiAgICAgIG1lc3NhZ2VDb250YWluZXIuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXG4gICAgICAvLyBzaG93IG1haW4gY29udGFpbmVyXG4gICAgICBtYWluQ29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSBcInZpc2libGVcIjtcblxuICAgICAgX2FjdGl2ZSA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHNob3cobWVzc2FnZSkge1xuICAgIHZhciBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSxcbiAgICAgIHA7XG5cbiAgICBpZiAoIV9hY3RpdmUpIHtcbiAgICAgIC8vIGhpZGUgbWFpbiBjb250YWluZXJcbiAgICAgIG1haW5Db250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XG5cbiAgICAgIG1lc3NhZ2VDb250YWluZXIuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcblxuICAgICAgLy8gY3JlYXRlIG1lc3NhZ2UgZWxlbWVudFxuICAgICAgcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwXCIpO1xuICAgICAgcC5pbm5lckhUTUwgPSBtZXNzYWdlO1xuICAgICAgcC5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcIm1lc3NhZ2VcIik7XG5cbiAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKHApO1xuICAgICAgbWVzc2FnZUNvbnRhaW5lci5hcHBlbmRDaGlsZChmcmFnbWVudCk7XG5cbiAgICAgIF9hY3RpdmUgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBtZXNzYWdlIGFscmVhZHkgYmVpbmcgc2hvd24sIHVwZGF0ZSBtZXNzYWdlIHRleHRcbiAgICAgIHAgPSBtZXNzYWdlQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCIubWVzc2FnZVwiKTtcbiAgICAgIHAuaW5uZXJIVE1MID0gbWVzc2FnZTtcbiAgICB9XG4gIH1cblxuICBfaW5pdCgpO1xuXG4gIHJldHVybiB7XG4gICAgXCJoaWRlXCI6IGhpZGUsXG4gICAgXCJzaG93XCI6IHNob3dcbiAgfTtcbn07XG5cbi8qIGdsb2JhbCBSaXNlVmlzaW9uLCBnYWRnZXRzICovXG5cbihmdW5jdGlvbiAod2luZG93LCBkb2N1bWVudCwgZ2FkZ2V0cykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgaWQgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpLmdldFN0cmluZyhcImlkXCIpO1xuXG4gIC8vIERpc2FibGUgY29udGV4dCBtZW51IChyaWdodCBjbGljayBtZW51KVxuICB3aW5kb3cub25jb250ZXh0bWVudSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgZG9jdW1lbnQuYm9keS5vbm1vdXNlZG93biA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBmdW5jdGlvbiBjb25maWd1cmUobmFtZXMsIHZhbHVlcykge1xuICAgIHZhciBhZGRpdGlvbmFsUGFyYW1zLFxuICAgICAgY29tcGFueUlkID0gXCJcIixcbiAgICAgIGRpc3BsYXlJZCA9IFwiXCI7XG5cbiAgICBpZiAoQXJyYXkuaXNBcnJheShuYW1lcykgJiYgbmFtZXMubGVuZ3RoID4gMCAmJiBBcnJheS5pc0FycmF5KHZhbHVlcykgJiYgdmFsdWVzLmxlbmd0aCA+IDApIHtcbiAgICAgIC8vIGNvbXBhbnkgaWRcbiAgICAgIGlmIChuYW1lc1swXSA9PT0gXCJjb21wYW55SWRcIikge1xuICAgICAgICBjb21wYW55SWQgPSB2YWx1ZXNbMF07XG4gICAgICB9XG5cbiAgICAgIC8vIGRpc3BsYXkgaWRcbiAgICAgIGlmIChuYW1lc1sxXSA9PT0gXCJkaXNwbGF5SWRcIikge1xuICAgICAgICBpZiAodmFsdWVzWzFdKSB7XG4gICAgICAgICAgZGlzcGxheUlkID0gdmFsdWVzWzFdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIGRpc3BsYXlJZCA9IFwicHJldmlld1wiO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIHByb3ZpZGUgTG9nZ2VyVXRpbHMgdGhlIGlkcyB0byB1c2VcbiAgICAgIFJpc2VWaXNpb24uQ29tbW9uLkxvZ2dlclV0aWxzLnNldElkcyhjb21wYW55SWQsIGRpc3BsYXlJZCk7XG5cbiAgICAgIC8vIGFkZGl0aW9uYWwgcGFyYW1zXG4gICAgICBpZiAobmFtZXNbMl0gPT09IFwiYWRkaXRpb25hbFBhcmFtc1wiKSB7XG4gICAgICAgIGFkZGl0aW9uYWxQYXJhbXMgPSBKU09OLnBhcnNlKHZhbHVlc1syXSk7XG5cbiAgICAgICAgUmlzZVZpc2lvbi5XZWJQYWdlLnNldEFkZGl0aW9uYWxQYXJhbXMoYWRkaXRpb25hbFBhcmFtcyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcGxheSgpIHtcbiAgICBSaXNlVmlzaW9uLldlYlBhZ2UucGxheSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGF1c2UoKSB7XG4gICAgUmlzZVZpc2lvbi5XZWJQYWdlLnBhdXNlKCk7XG4gIH1cblxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIFJpc2VWaXNpb24uV2ViUGFnZS5zdG9wKCk7XG4gIH1cblxuICBpZiAoaWQgJiYgaWQgIT09IFwiXCIpIHtcbiAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3BsYXlfXCIgKyBpZCwgcGxheSk7XG4gICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9wYXVzZV9cIiArIGlkLCBwYXVzZSk7XG4gICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9zdG9wX1wiICsgaWQsIHN0b3ApO1xuICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNwYXJhbV9zZXRfXCIgKyBpZCwgY29uZmlndXJlKTtcbiAgICBnYWRnZXRzLnJwYy5jYWxsKFwiXCIsIFwicnNwYXJhbV9nZXRcIiwgbnVsbCwgaWQsIFtcImNvbXBhbnlJZFwiLCBcImRpc3BsYXlJZFwiLCBcImFkZGl0aW9uYWxQYXJhbXNcIl0pO1xuICB9XG5cbn0pKHdpbmRvdywgZG9jdW1lbnQsIGdhZGdldHMpO1xuXG5cblxuLyoganNoaW50IGlnbm9yZTpzdGFydCAqL1xudmFyIF9nYXEgPSBfZ2FxIHx8IFtdO1xuXG5fZ2FxLnB1c2goWydfc2V0QWNjb3VudCcsICdVQS01NzA5MjE1OS02J10pO1xuX2dhcS5wdXNoKFsnX3RyYWNrUGFnZXZpZXcnXSk7XG5cbihmdW5jdGlvbigpIHtcbiAgdmFyIGdhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7IGdhLnR5cGUgPSAndGV4dC9qYXZhc2NyaXB0JzsgZ2EuYXN5bmMgPSB0cnVlO1xuICBnYS5zcmMgPSAoJ2h0dHBzOicgPT0gZG9jdW1lbnQubG9jYXRpb24ucHJvdG9jb2wgPyAnaHR0cHM6Ly9zc2wnIDogJ2h0dHA6Ly93d3cnKSArICcuZ29vZ2xlLWFuYWx5dGljcy5jb20vZ2EuanMnO1xuICB2YXIgcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzY3JpcHQnKVswXTsgcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShnYSwgcyk7XG59KSgpO1xuLyoganNoaW50IGlnbm9yZTplbmQgKi9cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
