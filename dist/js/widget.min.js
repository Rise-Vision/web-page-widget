var WIDGET_COMMON_CONFIG={AUTH_PATH_URL:"v1/widget/auth",LOGGER_CLIENT_ID:"1088527147109-6q1o2vtihn34292pjt4ckhmhck0rk0o7.apps.googleusercontent.com",LOGGER_CLIENT_SECRET:"nlZyrcPLg6oEwO9f9Wfn29Wh",LOGGER_REFRESH_TOKEN:"1/xzt4kwzE1H7W9VnKB8cAaCx6zb4Es4nKEoqaYHdTD15IgOrJDtdun6zK6XiATCKT",STORAGE_ENV:"prod",STORE_URL:"https://store-dot-rvaserver2.appspot.com/"},RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.LoggerUtils=function(){"use strict";function e(e,t){var i=null;e.event?(i=e,i.file_url&&(i.file_format=n(i.file_url)),i.company_id=a,i.display_id=r,t(i)):t(i)}function t(){var e=new Date,t=e.getUTCFullYear(),n=e.getUTCMonth()+1,i=e.getUTCDate();return 10>n&&(n="0"+n),10>i&&(i="0"+i),t+n+i}function n(e){var t,n=/[?#&]/;return e&&"string"==typeof e?(t=e.substr(e.lastIndexOf(".")+1),n.test(t)&&(t=t.substr(0,-1!==t.indexOf("?")?t.indexOf("?"):t.length),t=t.substr(0,-1!==t.indexOf("#")?t.indexOf("#"):t.length),t=t.substr(0,-1!==t.indexOf("&")?t.indexOf("&"):t.length)),t.toLowerCase()):null}function i(e){var n={kind:"bigquery#tableDataInsertAllRequest",skipInvalidRows:!1,ignoreUnknownValues:!1,templateSuffix:t(),rows:[{insertId:""}]},i=JSON.parse(JSON.stringify(n));return i.rows[0].insertId=Math.random().toString(36).substr(2).toUpperCase(),i.rows[0].json=JSON.parse(JSON.stringify(e)),i.rows[0].json.ts=(new Date).toISOString(),i}function o(t,n){e(n,function(e){null!==e&&RiseVision.Common.Logger.log(t,e)})}function s(e,t){a=e,r=t}var r="",a="";return{getInsertData:i,getFileFormat:n,logEvent:o,setIds:s}}(),RiseVision.Common.Logger=function(e){"use strict";function t(e){var t=new XMLHttpRequest;return new Date-c<358e4?e({}):(t.open("POST",o,!0),t.onloadend=function(){var n=JSON.parse(t.response);e({token:n.access_token,refreshedAt:new Date})},t.send(),void 0)}function n(e){return r&&l===e}function i(i,o){function u(t){var n,r,a=new XMLHttpRequest;r=s.replace("TABLE_ID",i),c=t.refreshedAt||c,g=t.token||g,n=e.getInsertData(o),a.open("POST",r,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Authorization","Bearer "+g),o.cb&&"function"==typeof o.cb&&(a.onloadend=function(){o.cb(a.response)}),a.send(JSON.stringify(n))}if(!(!i||!o||o.hasOwnProperty("event")&&!o.event||o.hasOwnProperty("event")&&n(o.event)))return r=!0,l=o.event,setTimeout(function(){r=!1},a),t(u)}var o="https://www.googleapis.com/oauth2/v3/token?client_id="+WIDGET_COMMON_CONFIG.LOGGER_CLIENT_ID+"&client_secret="+WIDGET_COMMON_CONFIG.LOGGER_CLIENT_SECRET+"&refresh_token="+WIDGET_COMMON_CONFIG.LOGGER_REFRESH_TOKEN+"&grant_type=refresh_token",s="https://www.googleapis.com/bigquery/v2/projects/client-side-events/datasets/Widget_Events/tables/TABLE_ID/insertAll",r=!1,a=1e3,l="",c=0,g="";return{log:i}}(RiseVision.Common.LoggerUtils),"undefined"!=typeof angular&&angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","locales/translation_").constant("LOCALES_SUFIX",".json");var config={STORAGE_ENV:"prod"},RiseVision=RiseVision||{};RiseVision.WebPage={},RiseVision.WebPage=function(e,t){"use strict";function n(){t.rpc.call("","rsevent_ready",null,v.getString("id"),!0,!0,!0,!0,!1)}function i(e){function t(t){var n=!0,i=t.target.getResponseHeader("X-Frame-Options");i&&"SAMEORIGIN"===i.toUpperCase()&&(u({event:"error",event_details:"X-Frame-Options header",error_details:"SAMEORIGIN",url:_}),E.show("The owner of the Web Page at the URL provided does not allow the Page to be embedded within an iFrame. If possible, please contact the Web Page owner to discuss X-Frame-Options."),n=!1),e&&"function"==typeof e&&e(n)}var n="https://proxy.risevision.com/"+_,i=new XMLHttpRequest;i.addEventListener("load",t),i.open("GET",n),i.send()}function o(){var t=e.getElementById("container"),n=e.getElementById("webpage-frame"),i=v.getInt("rsH")/v.getInt("rsW")*100;t&&n&&(t.style.visibility="hidden",r(n),s(n),0!==h&&(i+=h/v.getInt("rsW")*100),t.setAttribute("style","padding-bottom:"+i+"%"))}function s(e){var t,n=parseFloat(y.zoom);t="-ms-zoom:"+n+";-moz-transform: scale("+n+");-moz-transform-origin: 0 0;-o-transform: scale("+n+");-o-transform-origin: 0 0;-webkit-transform: scale("+n+");-webkit-transform-origin: 0 0;",t+="width: "+1/n*100+"%;height: "+1/n*100+"%;";var i=e.getAttribute("style");i&&(t=i+t),e.setAttribute("style",t)}function r(e){var t="",n=0;if(y.region&&y.region.showRegion&&"region"===y.region.showRegion&&(y.region.horizontal>0&&(n=y.region.horizontal),y.region.vertical>0&&(h=y.region.vertical),0!==n||0!==h)){t="margin: -"+h+"px 0 0 -"+n+"px;";var i=e.getAttribute("style");i&&(t=i+t),e.setAttribute("style",t)}}function a(){var t=e.getElementById("webpage-frame"),n=e.getElementById("container");n&&t&&(t.onload=function(){t.onload=null,n.style.visibility="visible"},t.setAttribute("src",_))}function l(){var t=e.getElementById("webpage-frame");t&&(t.src="about:blank")}function c(){E=new RiseVision.Common.Message(e.getElementById("container"),e.getElementById("messageContainer")),_=y.url,-1===_.indexOf("://")&&(_="http://"+_),i(function(e){e&&o(),n()})}function g(){return"webpage_events"}function u(e){RiseVision.Common.LoggerUtils.logEvent(g(),e)}function d(){l()}function p(){a()}function m(){d()}function f(e){y=JSON.parse(JSON.stringify(e)),c()}var v=new t.Prefs,y=null,_="",h=0,E=null;return{getTableName:g,logEvent:u,setAdditionalParams:f,pause:d,play:p,stop:m}}(document,gadgets);var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Message=function(e,t){"use strict";function n(){try{t.style.height=e.style.height}catch(n){console.warn("Can't initialize Message - ",n.message)}}function i(){if(s){for(;t.firstChild;)t.removeChild(t.firstChild);t.style.display="none",e.style.visibility="visible",s=!1}}function o(n){var i,o=document.createDocumentFragment();s?(i=t.querySelector(".message"),i.innerHTML=n):(e.style.visibility="hidden",t.style.display="block",i=document.createElement("p"),i.innerHTML=n,i.setAttribute("class","message"),o.appendChild(i),t.appendChild(o),s=!0)}var s=!1;return n(),{hide:i,show:o}},function(e,t,n){"use strict";function i(e,t){var n,i="",o="";Array.isArray(e)&&e.length>0&&Array.isArray(t)&&t.length>0&&("companyId"===e[0]&&(i=t[0]),"displayId"===e[1]&&(o=t[1]?t[1]:"preview"),RiseVision.Common.LoggerUtils.setIds(i,o),"additionalParams"===e[2]&&(n=JSON.parse(t[2]),RiseVision.WebPage.setAdditionalParams(n)))}function o(){RiseVision.WebPage.play()}function s(){RiseVision.WebPage.pause()}function r(){RiseVision.WebPage.stop()}var a=(new n.Prefs).getString("id");e.oncontextmenu=function(){return!1},t.body.onmousedown=function(){return!1},a&&""!==a&&(n.rpc.register("rscmd_play_"+a,o),n.rpc.register("rscmd_pause_"+a,s),n.rpc.register("rscmd_stop_"+a,r),n.rpc.register("rsparam_set_"+a,i),n.rpc.call("","rsparam_get",null,a,["companyId","displayId","additionalParams"]))}(window,document,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-6"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsiV0lER0VUX0NPTU1PTl9DT05GSUciLCJBVVRIX1BBVEhfVVJMIiwiTE9HR0VSX0NMSUVOVF9JRCIsIkxPR0dFUl9DTElFTlRfU0VDUkVUIiwiTE9HR0VSX1JFRlJFU0hfVE9LRU4iLCJTVE9SQUdFX0VOViIsIlNUT1JFX1VSTCIsIlJpc2VWaXNpb24iLCJDb21tb24iLCJMb2dnZXJVdGlscyIsImdldEV2ZW50UGFyYW1zIiwicGFyYW1zIiwiY2IiLCJqc29uIiwiZXZlbnQiLCJmaWxlX3VybCIsImZpbGVfZm9ybWF0IiwiZ2V0RmlsZUZvcm1hdCIsImNvbXBhbnlfaWQiLCJjb21wYW55SWQiLCJkaXNwbGF5X2lkIiwiZGlzcGxheUlkIiwiZ2V0U3VmZml4IiwiZGF0ZSIsIkRhdGUiLCJ5ZWFyIiwiZ2V0VVRDRnVsbFllYXIiLCJtb250aCIsImdldFVUQ01vbnRoIiwiZGF5IiwiZ2V0VVRDRGF0ZSIsInVybCIsInN0ciIsImhhc1BhcmFtcyIsInN1YnN0ciIsImxhc3RJbmRleE9mIiwidGVzdCIsImluZGV4T2YiLCJsZW5ndGgiLCJ0b0xvd2VyQ2FzZSIsImdldEluc2VydERhdGEiLCJCQVNFX0lOU0VSVF9TQ0hFTUEiLCJraW5kIiwic2tpcEludmFsaWRSb3dzIiwiaWdub3JlVW5rbm93blZhbHVlcyIsInRlbXBsYXRlU3VmZml4Iiwicm93cyIsImluc2VydElkIiwiZGF0YSIsIkpTT04iLCJwYXJzZSIsInN0cmluZ2lmeSIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInRvVXBwZXJDYXNlIiwidHMiLCJ0b0lTT1N0cmluZyIsImxvZ0V2ZW50IiwidGFibGUiLCJMb2dnZXIiLCJsb2ciLCJzZXRJZHMiLCJjb21wYW55IiwiZGlzcGxheSIsInV0aWxzIiwicmVmcmVzaFRva2VuIiwieGhyIiwiWE1MSHR0cFJlcXVlc3QiLCJyZWZyZXNoRGF0ZSIsIm9wZW4iLCJSRUZSRVNIX1VSTCIsIm9ubG9hZGVuZCIsInJlc3AiLCJyZXNwb25zZSIsInRva2VuIiwiYWNjZXNzX3Rva2VuIiwicmVmcmVzaGVkQXQiLCJzZW5kIiwiaXNUaHJvdHRsZWQiLCJ0aHJvdHRsZSIsImxhc3RFdmVudCIsInRhYmxlTmFtZSIsImluc2VydFdpdGhUb2tlbiIsInJlZnJlc2hEYXRhIiwiaW5zZXJ0RGF0YSIsInNlcnZpY2VVcmwiLCJyZXBsYWNlIiwic2V0UmVxdWVzdEhlYWRlciIsImhhc093blByb3BlcnR5Iiwic2V0VGltZW91dCIsInRocm90dGxlRGVsYXkiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uc3RhbnQiLCJjb25maWciLCJXZWJQYWdlIiwiZG9jdW1lbnQiLCJnYWRnZXRzIiwiX3JlYWR5IiwicnBjIiwiY2FsbCIsIl9wcmVmcyIsImdldFN0cmluZyIsIl92YWxpZGF0ZVVybCIsImhhbmRsZVByb3h5UmVzcG9uc2UiLCJlIiwic3VjY2VzcyIsImhlYWRlciIsInRhcmdldCIsImdldFJlc3BvbnNlSGVhZGVyIiwiZXZlbnRfZGV0YWlscyIsImVycm9yX2RldGFpbHMiLCJfdXJsIiwiX21lc3NhZ2UiLCJzaG93IiwicHJveHlVcmwiLCJyZXF1ZXN0IiwiYWRkRXZlbnRMaXN0ZW5lciIsIl9jb25maWd1cmVQYWdlIiwiY29udGFpbmVyIiwiZ2V0RWxlbWVudEJ5SWQiLCJmcmFtZSIsImFzcGVjdFJhdGlvIiwiZ2V0SW50Iiwic3R5bGUiLCJ2aXNpYmlsaXR5IiwiX3NldFJlZ2lvbiIsIl9zZXRab29tIiwiX3ZlcnRpY2FsIiwic2V0QXR0cmlidXRlIiwiem9vbVN0eWxlIiwiem9vbSIsInBhcnNlRmxvYXQiLCJfYWRkaXRpb25hbFBhcmFtcyIsImN1cnJlbnRTdHlsZSIsImdldEF0dHJpYnV0ZSIsIm1hcmdpblN0eWxlIiwiaG9yaXpvbnRhbCIsInJlZ2lvbiIsInNob3dSZWdpb24iLCJ2ZXJ0aWNhbCIsIl9sb2FkRnJhbWUiLCJvbmxvYWQiLCJfdW5sb2FkRnJhbWUiLCJzcmMiLCJfaW5pdCIsIk1lc3NhZ2UiLCJnZXRUYWJsZU5hbWUiLCJwYXVzZSIsInBsYXkiLCJzdG9wIiwic2V0QWRkaXRpb25hbFBhcmFtcyIsImFkZGl0aW9uYWxQYXJhbXMiLCJQcmVmcyIsIm1haW5Db250YWluZXIiLCJtZXNzYWdlQ29udGFpbmVyIiwiaGVpZ2h0IiwiY29uc29sZSIsIndhcm4iLCJtZXNzYWdlIiwiaGlkZSIsIl9hY3RpdmUiLCJmaXJzdENoaWxkIiwicmVtb3ZlQ2hpbGQiLCJwIiwiZnJhZ21lbnQiLCJjcmVhdGVEb2N1bWVudEZyYWdtZW50IiwicXVlcnlTZWxlY3RvciIsImlubmVySFRNTCIsImNyZWF0ZUVsZW1lbnQiLCJhcHBlbmRDaGlsZCIsIndpbmRvdyIsImNvbmZpZ3VyZSIsIm5hbWVzIiwidmFsdWVzIiwiQXJyYXkiLCJpc0FycmF5IiwiaWQiLCJvbmNvbnRleHRtZW51IiwiYm9keSIsIm9ubW91c2Vkb3duIiwicmVnaXN0ZXIiLCJfZ2FxIiwicHVzaCIsImdhIiwidHlwZSIsImFzeW5jIiwibG9jYXRpb24iLCJwcm90b2NvbCIsInMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInBhcmVudE5vZGUiLCJpbnNlcnRCZWZvcmUiXSwibWFwcGluZ3MiOiJBQUNBLEdBQUlBLHVCQUNGQyxjQUFlLGlCQUNmQyxpQkFBa0IsNEVBQ2xCQyxxQkFBc0IsMkJBQ3RCQyxxQkFBc0IscUVBQ3RCQyxZQUFhLE9BQ2JDLFVBQVcsNkNBSVRDLFdBQWFBLGNBQ2pCQSxZQUFXQyxPQUFTRCxXQUFXQyxXQUUvQkQsV0FBV0MsT0FBT0MsWUFBYyxXQUM5QixZQVVBLFNBQVNDLEdBQWVDLEVBQVFDLEdBQzlCLEdBQUlDLEdBQU8sSUFHUEYsR0FBT0csT0FDVEQsRUFBT0YsRUFFSEUsRUFBS0UsV0FDUEYsRUFBS0csWUFBY0MsRUFBY0osRUFBS0UsV0FHeENGLEVBQUtLLFdBQWFDLEVBQ2xCTixFQUFLTyxXQUFhQyxFQUVsQlQsRUFBR0MsSUFHSEQsRUFBR0MsR0FLUCxRQUFTUyxLQUNQLEdBQUlDLEdBQU8sR0FBSUMsTUFDYkMsRUFB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S0FDUnJCLEVBQW1CeEcsS0FBS0MsTUFBTTZILEVBQU8sSUFFckN4SyxXQUFXeUYsUUFBUXdELG9CQUFvQkMsS0FLN0MsUUFBU0gsS0FDUC9JLFdBQVd5RixRQUFRc0QsT0FHckIsUUFBU0QsS0FDUDlJLFdBQVd5RixRQUFRcUQsUUFHckIsUUFBU0UsS0FDUGhKLFdBQVd5RixRQUFRdUQsT0FyRHJCLEdBQUkyQixJQUFLLEdBQUloRixHQUFRd0QsT0FBUW5ELFVBQVUsS0FHdkNxRSxHQUFPTyxjQUFnQixXQUNyQixPQUFPLEdBR1RsRixFQUFTbUYsS0FBS0MsWUFBYyxXQUMxQixPQUFPLEdBZ0RMSCxHQUFhLEtBQVBBLElBQ1JoRixFQUFRRSxJQUFJa0YsU0FBUyxjQUFnQkosRUFBSTVCLEdBQ3pDcEQsRUFBUUUsSUFBSWtGLFNBQVMsZUFBaUJKLEVBQUk3QixHQUMxQ25ELEVBQVFFLElBQUlrRixTQUFTLGNBQWdCSixFQUFJM0IsR0FDekNyRCxFQUFRRSxJQUFJa0YsU0FBUyxlQUFpQkosRUFBSUwsR0FDMUMzRSxFQUFRRSxJQUFJQyxLQUFLLEdBQUksY0FBZSxLQUFNNkUsR0FBSyxZQUFhLFlBQWEsdUJBRzFFTixPQUFRM0UsU0FBVUMsUUFLckIsSUFBSXFGLE1BQU9BLFFBRVhBLE1BQUtDLE1BQU0sY0FBZSxrQkFDMUJELEtBQUtDLE1BQU0sbUJBRVgsV0FDRSxHQUFJQyxHQUFLeEYsU0FBU3lFLGNBQWMsU0FBV2UsR0FBR0MsS0FBTyxrQkFBbUJELEVBQUdFLE9BQVEsRUFDbkZGLEVBQUd4QyxLQUFPLFVBQVloRCxTQUFTMkYsU0FBU0MsU0FBVyxjQUFnQixjQUFnQiw2QkFDbkYsSUFBSUMsR0FBSTdGLFNBQVM4RixxQkFBcUIsVUFBVSxFQUFJRCxHQUFFRSxXQUFXQyxhQUFhUixFQUFJSyIsImZpbGUiOiJqcy93aWRnZXQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXhwb3J0ZWQgV0lER0VUX0NPTU1PTl9DT05GSUcgKi9cbnZhciBXSURHRVRfQ09NTU9OX0NPTkZJRyA9IHtcbiAgQVVUSF9QQVRIX1VSTDogXCJ2MS93aWRnZXQvYXV0aFwiLFxuICBMT0dHRVJfQ0xJRU5UX0lEOiBcIjEwODg1MjcxNDcxMDktNnExbzJ2dGlobjM0MjkycGp0NGNraG1oY2swcmswbzcuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb21cIixcbiAgTE9HR0VSX0NMSUVOVF9TRUNSRVQ6IFwibmxaeXJjUExnNm9Fd085ZjlXZm4yOVdoXCIsXG4gIExPR0dFUl9SRUZSRVNIX1RPS0VOOiBcIjEveHp0NGt3ekUxSDdXOVZuS0I4Y0FhQ3g2emI0RXM0bktFb3FhWUhkVEQxNUlnT3JKRHRkdW42eks2WGlBVENLVFwiLFxuICBTVE9SQUdFX0VOVjogXCJwcm9kXCIsXG4gIFNUT1JFX1VSTDogXCJodHRwczovL3N0b3JlLWRvdC1ydmFzZXJ2ZXIyLmFwcHNwb3QuY29tL1wiXG59O1xuLyogZ2xvYmFsIFdJREdFVF9DT01NT05fQ09ORklHICovXG5cbnZhciBSaXNlVmlzaW9uID0gUmlzZVZpc2lvbiB8fCB7fTtcblJpc2VWaXNpb24uQ29tbW9uID0gUmlzZVZpc2lvbi5Db21tb24gfHwge307XG5cblJpc2VWaXNpb24uQ29tbW9uLkxvZ2dlclV0aWxzID0gKGZ1bmN0aW9uKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICAgdmFyIGRpc3BsYXlJZCA9IFwiXCIsXG4gICAgY29tcGFueUlkID0gXCJcIjtcblxuICAvKlxuICAgKiAgUHJpdmF0ZSBNZXRob2RzXG4gICAqL1xuXG4gIC8qIFJldHJpZXZlIHBhcmFtZXRlcnMgdG8gcGFzcyB0byB0aGUgZXZlbnQgbG9nZ2VyLiAqL1xuICBmdW5jdGlvbiBnZXRFdmVudFBhcmFtcyhwYXJhbXMsIGNiKSB7XG4gICAgdmFyIGpzb24gPSBudWxsO1xuXG4gICAgLy8gZXZlbnQgaXMgcmVxdWlyZWQuXG4gICAgaWYgKHBhcmFtcy5ldmVudCkge1xuICAgICAganNvbiA9IHBhcmFtcztcblxuICAgICAgaWYgKGpzb24uZmlsZV91cmwpIHtcbiAgICAgICAganNvbi5maWxlX2Zvcm1hdCA9IGdldEZpbGVGb3JtYXQoanNvbi5maWxlX3VybCk7XG4gICAgICB9XG5cbiAgICAgIGpzb24uY29tcGFueV9pZCA9IGNvbXBhbnlJZDtcbiAgICAgIGpzb24uZGlzcGxheV9pZCA9IGRpc3BsYXlJZDtcblxuICAgICAgY2IoanNvbik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgY2IoanNvbik7XG4gICAgfVxuICB9XG5cbiAgLy8gR2V0IHN1ZmZpeCBmb3IgQlEgdGFibGUgbmFtZS5cbiAgZnVuY3Rpb24gZ2V0U3VmZml4KCkge1xuICAgIHZhciBkYXRlID0gbmV3IERhdGUoKSxcbiAgICAgIHllYXIgPSBkYXRlLmdldFVUQ0Z1bGxZZWFyKCksXG4gICAgICBtb250aCA9IGRhdGUuZ2V0VVRDTW9udGgoKSArIDEsXG4gICAgICBkYXkgPSBkYXRlLmdldFVUQ0RhdGUoKTtcblxuICAgIGlmIChtb250aCA8IDEwKSB7XG4gICAgICBtb250aCA9IFwiMFwiICsgbW9udGg7XG4gICAgfVxuXG4gICAgaWYgKGRheSA8IDEwKSB7XG4gICAgICBkYXkgPSBcIjBcIiArIGRheTtcbiAgICB9XG5cbiAgICByZXR1cm4geWVhciArIG1vbnRoICsgZGF5O1xuICB9XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBnZXRGaWxlRm9ybWF0KHVybCkge1xuICAgIHZhciBoYXNQYXJhbXMgPSAvWz8jJl0vLFxuICAgICAgc3RyO1xuXG4gICAgaWYgKCF1cmwgfHwgdHlwZW9mIHVybCAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgc3RyID0gdXJsLnN1YnN0cih1cmwubGFzdEluZGV4T2YoXCIuXCIpICsgMSk7XG5cbiAgICAvLyBkb24ndCBpbmNsdWRlIGFueSBwYXJhbXMgYWZ0ZXIgdGhlIGZpbGVuYW1lXG4gICAgaWYgKGhhc1BhcmFtcy50ZXN0KHN0cikpIHtcbiAgICAgIHN0ciA9IHN0ci5zdWJzdHIoMCAsKHN0ci5pbmRleE9mKFwiP1wiKSAhPT0gLTEpID8gc3RyLmluZGV4T2YoXCI/XCIpIDogc3RyLmxlbmd0aCk7XG5cbiAgICAgIHN0ciA9IHN0ci5zdWJzdHIoMCwgKHN0ci5pbmRleE9mKFwiI1wiKSAhPT0gLTEpID8gc3RyLmluZGV4T2YoXCIjXCIpIDogc3RyLmxlbmd0aCk7XG5cbiAgICAgIHN0ciA9IHN0ci5zdWJzdHIoMCwgKHN0ci5pbmRleE9mKFwiJlwiKSAhPT0gLTEpID8gc3RyLmluZGV4T2YoXCImXCIpIDogc3RyLmxlbmd0aCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN0ci50b0xvd2VyQ2FzZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0SW5zZXJ0RGF0YShwYXJhbXMpIHtcbiAgICB2YXIgQkFTRV9JTlNFUlRfU0NIRU1BID0ge1xuICAgICAgXCJraW5kXCI6IFwiYmlncXVlcnkjdGFibGVEYXRhSW5zZXJ0QWxsUmVxdWVzdFwiLFxuICAgICAgXCJza2lwSW52YWxpZFJvd3NcIjogZmFsc2UsXG4gICAgICBcImlnbm9yZVVua25vd25WYWx1ZXNcIjogZmFsc2UsXG4gICAgICBcInRlbXBsYXRlU3VmZml4XCI6IGdldFN1ZmZpeCgpLFxuICAgICAgXCJyb3dzXCI6IFt7XG4gICAgICAgIFwiaW5zZXJ0SWRcIjogXCJcIlxuICAgICAgfV1cbiAgICB9LFxuICAgIGRhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KEJBU0VfSU5TRVJUX1NDSEVNQSkpO1xuXG4gICAgZGF0YS5yb3dzWzBdLmluc2VydElkID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIpLnRvVXBwZXJDYXNlKCk7XG4gICAgZGF0YS5yb3dzWzBdLmpzb24gPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHBhcmFtcykpO1xuICAgIGRhdGEucm93c1swXS5qc29uLnRzID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuXG4gICAgcmV0dXJuIGRhdGE7XG4gIH1cblxuICBmdW5jdGlvbiBsb2dFdmVudCh0YWJsZSwgcGFyYW1zKSB7XG4gICAgZ2V0RXZlbnRQYXJhbXMocGFyYW1zLCBmdW5jdGlvbihqc29uKSB7XG4gICAgICBpZiAoanNvbiAhPT0gbnVsbCkge1xuICAgICAgICBSaXNlVmlzaW9uLkNvbW1vbi5Mb2dnZXIubG9nKHRhYmxlLCBqc29uKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qIFNldCB0aGUgQ29tcGFueSBhbmQgRGlzcGxheSBJRHMuICovXG4gIGZ1bmN0aW9uIHNldElkcyhjb21wYW55LCBkaXNwbGF5KSB7XG4gICAgY29tcGFueUlkID0gY29tcGFueTtcbiAgICBkaXNwbGF5SWQgPSBkaXNwbGF5O1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcImdldEluc2VydERhdGFcIjogZ2V0SW5zZXJ0RGF0YSxcbiAgICBcImdldEZpbGVGb3JtYXRcIjogZ2V0RmlsZUZvcm1hdCxcbiAgICBcImxvZ0V2ZW50XCI6IGxvZ0V2ZW50LFxuICAgIFwic2V0SWRzXCI6IHNldElkc1xuICB9O1xufSkoKTtcblxuUmlzZVZpc2lvbi5Db21tb24uTG9nZ2VyID0gKGZ1bmN0aW9uKHV0aWxzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBSRUZSRVNIX1VSTCA9IFwiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3YzL3Rva2VuP2NsaWVudF9pZD1cIiArIFdJREdFVF9DT01NT05fQ09ORklHLkxPR0dFUl9DTElFTlRfSUQgK1xuICAgICAgXCImY2xpZW50X3NlY3JldD1cIiArIFdJREdFVF9DT01NT05fQ09ORklHLkxPR0dFUl9DTElFTlRfU0VDUkVUICtcbiAgICAgIFwiJnJlZnJlc2hfdG9rZW49XCIgKyBXSURHRVRfQ09NTU9OX0NPTkZJRy5MT0dHRVJfUkVGUkVTSF9UT0tFTiArXG4gICAgICBcIiZncmFudF90eXBlPXJlZnJlc2hfdG9rZW5cIjtcblxuICB2YXIgc2VydmljZVVybCA9IFwiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vYmlncXVlcnkvdjIvcHJvamVjdHMvY2xpZW50LXNpZGUtZXZlbnRzL2RhdGFzZXRzL1dpZGdldF9FdmVudHMvdGFibGVzL1RBQkxFX0lEL2luc2VydEFsbFwiLFxuICAgIHRocm90dGxlID0gZmFsc2UsXG4gICAgdGhyb3R0bGVEZWxheSA9IDEwMDAsXG4gICAgbGFzdEV2ZW50ID0gXCJcIixcbiAgICByZWZyZXNoRGF0ZSA9IDAsXG4gICAgdG9rZW4gPSBcIlwiO1xuXG4gIC8qXG4gICAqICBQcml2YXRlIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIHJlZnJlc2hUb2tlbihjYikge1xuICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblxuICAgIGlmIChuZXcgRGF0ZSgpIC0gcmVmcmVzaERhdGUgPCAzNTgwMDAwKSB7XG4gICAgICByZXR1cm4gY2Ioe30pO1xuICAgIH1cblxuICAgIHhoci5vcGVuKFwiUE9TVFwiLCBSRUZSRVNIX1VSTCwgdHJ1ZSk7XG4gICAgeGhyLm9ubG9hZGVuZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHJlc3AgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZSk7XG5cbiAgICAgIGNiKHsgdG9rZW46IHJlc3AuYWNjZXNzX3Rva2VuLCByZWZyZXNoZWRBdDogbmV3IERhdGUoKSB9KTtcbiAgICB9O1xuXG4gICAgeGhyLnNlbmQoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzVGhyb3R0bGVkKGV2ZW50KSB7XG4gICAgcmV0dXJuIHRocm90dGxlICYmIChsYXN0RXZlbnQgPT09IGV2ZW50KTtcbiAgfVxuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gbG9nKHRhYmxlTmFtZSwgcGFyYW1zKSB7XG4gICAgaWYgKCF0YWJsZU5hbWUgfHwgIXBhcmFtcyB8fCAocGFyYW1zLmhhc093blByb3BlcnR5KFwiZXZlbnRcIikgJiYgIXBhcmFtcy5ldmVudCkgfHxcbiAgICAgIChwYXJhbXMuaGFzT3duUHJvcGVydHkoXCJldmVudFwiKSAmJiBpc1Rocm90dGxlZChwYXJhbXMuZXZlbnQpKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRocm90dGxlID0gdHJ1ZTtcbiAgICBsYXN0RXZlbnQgPSBwYXJhbXMuZXZlbnQ7XG5cbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIHRocm90dGxlID0gZmFsc2U7XG4gICAgfSwgdGhyb3R0bGVEZWxheSk7XG5cbiAgICBmdW5jdGlvbiBpbnNlcnRXaXRoVG9rZW4ocmVmcmVzaERhdGEpIHtcbiAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKSxcbiAgICAgICAgaW5zZXJ0RGF0YSwgdXJsO1xuXG4gICAgICB1cmwgPSBzZXJ2aWNlVXJsLnJlcGxhY2UoXCJUQUJMRV9JRFwiLCB0YWJsZU5hbWUpO1xuICAgICAgcmVmcmVzaERhdGUgPSByZWZyZXNoRGF0YS5yZWZyZXNoZWRBdCB8fCByZWZyZXNoRGF0ZTtcbiAgICAgIHRva2VuID0gcmVmcmVzaERhdGEudG9rZW4gfHwgdG9rZW47XG4gICAgICBpbnNlcnREYXRhID0gdXRpbHMuZ2V0SW5zZXJ0RGF0YShwYXJhbXMpO1xuXG4gICAgICAvLyBJbnNlcnQgdGhlIGRhdGEuXG4gICAgICB4aHIub3BlbihcIlBPU1RcIiwgdXJsLCB0cnVlKTtcbiAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQ29udGVudC1UeXBlXCIsIFwiYXBwbGljYXRpb24vanNvblwiKTtcbiAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQXV0aG9yaXphdGlvblwiLCBcIkJlYXJlciBcIiArIHRva2VuKTtcblxuICAgICAgaWYgKHBhcmFtcy5jYiAmJiB0eXBlb2YgcGFyYW1zLmNiID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgeGhyLm9ubG9hZGVuZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHBhcmFtcy5jYih4aHIucmVzcG9uc2UpO1xuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICB4aHIuc2VuZChKU09OLnN0cmluZ2lmeShpbnNlcnREYXRhKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlZnJlc2hUb2tlbihpbnNlcnRXaXRoVG9rZW4pO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcImxvZ1wiOiBsb2dcbiAgfTtcbn0pKFJpc2VWaXNpb24uQ29tbW9uLkxvZ2dlclV0aWxzKTtcbi8qIGV4cG9ydGVkIGNvbmZpZyAqL1xuaWYgKHR5cGVvZiBhbmd1bGFyICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gIGFuZ3VsYXIubW9kdWxlKFwicmlzZXZpc2lvbi5jb21tb24uaTE4bi5jb25maWdcIiwgW10pXG4gICAgLmNvbnN0YW50KFwiTE9DQUxFU19QUkVGSVhcIiwgXCJsb2NhbGVzL3RyYW5zbGF0aW9uX1wiKVxuICAgIC5jb25zdGFudChcIkxPQ0FMRVNfU1VGSVhcIiwgXCIuanNvblwiKTtcbn1cblxudmFyIGNvbmZpZyA9IHtcbiAgU1RPUkFHRV9FTlY6IFwicHJvZFwiXG59O1xuXG4vKiBnbG9iYWwgZ2FkZ2V0cyAqL1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLldlYlBhZ2UgPSB7fTtcblxuUmlzZVZpc2lvbi5XZWJQYWdlID0gKGZ1bmN0aW9uIChkb2N1bWVudCwgZ2FkZ2V0cykge1xuXG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIC8vIHByaXZhdGUgdmFyaWFibGVzXG4gIHZhciBfcHJlZnMgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpLFxuICAgIF9hZGRpdGlvbmFsUGFyYW1zID0gbnVsbCxcbiAgICBfdXJsID0gXCJcIixcbiAgICBfdmVydGljYWwgPSAwO1xuXG4gIHZhciBfbWVzc2FnZSA9IG51bGw7XG5cbiAgLypcbiAgICogIFByaXZhdGUgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gX3JlYWR5KCkge1xuICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc2V2ZW50X3JlYWR5XCIsIG51bGwsIF9wcmVmcy5nZXRTdHJpbmcoXCJpZFwiKSxcbiAgICAgIHRydWUsIHRydWUsIHRydWUsIHRydWUsIGZhbHNlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF92YWxpZGF0ZVVybChjYikge1xuICAgIHZhciBwcm94eVVybCA9IFwiaHR0cHM6Ly9wcm94eS5yaXNldmlzaW9uLmNvbS9cIiArIF91cmwsXG4gICAgICByZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cbiAgICBmdW5jdGlvbiBoYW5kbGVQcm94eVJlc3BvbnNlKGUpIHtcbiAgICAgIHZhciBzdWNjZXNzID0gdHJ1ZSxcbiAgICAgICAgaGVhZGVyID0gZS50YXJnZXQuZ2V0UmVzcG9uc2VIZWFkZXIoXCJYLUZyYW1lLU9wdGlvbnNcIik7XG5cbiAgICAgIGlmIChoZWFkZXIgJiYgKGhlYWRlci50b1VwcGVyQ2FzZSgpID09PSBcIlNBTUVPUklHSU5cIikpIHtcbiAgICAgICAgbG9nRXZlbnQoe1xuICAgICAgICAgIFwiZXZlbnRcIjogXCJlcnJvclwiLFxuICAgICAgICAgIFwiZXZlbnRfZGV0YWlsc1wiOiBcIlgtRnJhbWUtT3B0aW9ucyBoZWFkZXJcIixcbiAgICAgICAgICBcImVycm9yX2RldGFpbHNcIjogXCJTQU1FT1JJR0lOXCIsXG4gICAgICAgICAgXCJ1cmxcIjogX3VybFxuICAgICAgICB9KTtcblxuICAgICAgICBfbWVzc2FnZS5zaG93KFwiVGhlIG93bmVyIG9mIHRoZSBXZWIgUGFnZSBhdCB0aGUgVVJMIHByb3ZpZGVkIGRvZXMgbm90IGFsbG93IHRoZSBQYWdlIHRvIFwiICtcbiAgICAgICAgICBcImJlIGVtYmVkZGVkIHdpdGhpbiBhbiBpRnJhbWUuIElmIHBvc3NpYmxlLCBwbGVhc2UgY29udGFjdCB0aGUgV2ViIFBhZ2Ugb3duZXIgdG8gXCIgK1xuICAgICAgICAgIFwiZGlzY3VzcyBYLUZyYW1lLU9wdGlvbnMuXCIpO1xuXG4gICAgICAgIHN1Y2Nlc3MgPSBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgaWYgKGNiICYmICh0eXBlb2YgY2IgPT09IFwiZnVuY3Rpb25cIikpIHtcbiAgICAgICAgY2Ioc3VjY2Vzcyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCBoYW5kbGVQcm94eVJlc3BvbnNlKTtcbiAgICByZXF1ZXN0Lm9wZW4oXCJHRVRcIiwgcHJveHlVcmwpO1xuICAgIHJlcXVlc3Quc2VuZCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gX2NvbmZpZ3VyZVBhZ2UoKSB7XG4gICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29udGFpbmVyXCIpLFxuICAgICAgZnJhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIndlYnBhZ2UtZnJhbWVcIiksXG4gICAgICBhc3BlY3RSYXRpbyA9ICAoX3ByZWZzLmdldEludChcInJzSFwiKSAvIF9wcmVmcy5nZXRJbnQoXCJyc1dcIikpICogMTAwO1xuXG4gICAgaWYgKGNvbnRhaW5lciAmJiBmcmFtZSkge1xuICAgICAgLy8gSGlkaW5nIGlmcmFtZSBjb250YWluZXIsIHZpc2libGUgd2hlbiB0aGUgaWZyYW1lIHN1Y2Nlc3NmdWxseSBsb2Fkc1xuICAgICAgY29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSBcImhpZGRlblwiO1xuXG4gICAgICBfc2V0UmVnaW9uKGZyYW1lKTtcbiAgICAgIF9zZXRab29tKGZyYW1lKTtcblxuICAgICAgLy8gaW1wbGVtZW50IHJlc3BvbnNpdmUgaWZyYW1lXG4gICAgICBpZiAoX3ZlcnRpY2FsICE9PSAwKSB7XG4gICAgICAgIGFzcGVjdFJhdGlvICs9IChfdmVydGljYWwgLyBfcHJlZnMuZ2V0SW50KFwicnNXXCIpKSAqIDEwMDtcbiAgICAgIH1cblxuICAgICAgY29udGFpbmVyLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwicGFkZGluZy1ib3R0b206XCIgKyBhc3BlY3RSYXRpbyArIFwiJVwiKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBfc2V0Wm9vbShmcmFtZSkge1xuICAgdmFyIHpvb20gPSBwYXJzZUZsb2F0KF9hZGRpdGlvbmFsUGFyYW1zLnpvb20pLFxuICAgICB6b29tU3R5bGU7XG5cbiAgICAvLyBDb25maWd1cmUgdGhlIHpvb20gKHNjYWxlKSBzdHlsaW5nXG4gICAgem9vbVN0eWxlID0gXCItbXMtem9vbTpcIiArIHpvb20gKyBcIjtcIiArXG4gICAgICBcIi1tb3otdHJhbnNmb3JtOiBzY2FsZShcIiArIHpvb20gKyBcIik7XCIgK1xuICAgICAgXCItbW96LXRyYW5zZm9ybS1vcmlnaW46IDAgMDtcIiArXG4gICAgICBcIi1vLXRyYW5zZm9ybTogc2NhbGUoXCIgKyB6b29tICsgXCIpO1wiICtcbiAgICAgIFwiLW8tdHJhbnNmb3JtLW9yaWdpbjogMCAwO1wiICtcbiAgICAgIFwiLXdlYmtpdC10cmFuc2Zvcm06IHNjYWxlKFwiICsgem9vbSArIFwiKTtcIiArXG4gICAgICBcIi13ZWJraXQtdHJhbnNmb3JtLW9yaWdpbjogMCAwO1wiO1xuXG4gICAgem9vbVN0eWxlICs9IFwid2lkdGg6IFwiICsgKCgxIC8gem9vbSkgKiAxMDApICsgXCIlO1wiICtcbiAgICAgIFwiaGVpZ2h0OiBcIiArICgoMSAvIHpvb20pICogMTAwKSArIFwiJTtcIjtcblxuICAgIHZhciBjdXJyZW50U3R5bGUgPSBmcmFtZS5nZXRBdHRyaWJ1dGUoXCJzdHlsZVwiKTtcbiAgICBpZiAoY3VycmVudFN0eWxlKSB7XG4gICAgICB6b29tU3R5bGUgPSBjdXJyZW50U3R5bGUgKyB6b29tU3R5bGU7XG4gICAgfVxuXG4gICAgZnJhbWUuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgem9vbVN0eWxlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9zZXRSZWdpb24oZnJhbWUpIHtcbiAgICB2YXIgbWFyZ2luU3R5bGUgPSBcIlwiLFxuICAgICAgaG9yaXpvbnRhbCA9IDA7XG5cbiAgICBpZiAoX2FkZGl0aW9uYWxQYXJhbXMucmVnaW9uICYmIF9hZGRpdGlvbmFsUGFyYW1zLnJlZ2lvbi5zaG93UmVnaW9uICYmXG4gICAgICAoX2FkZGl0aW9uYWxQYXJhbXMucmVnaW9uLnNob3dSZWdpb24gPT09IFwicmVnaW9uXCIpKSB7XG4gICAgICBpZiAoX2FkZGl0aW9uYWxQYXJhbXMucmVnaW9uLmhvcml6b250YWwgPiAwKSB7XG4gICAgICAgIGhvcml6b250YWwgPSBfYWRkaXRpb25hbFBhcmFtcy5yZWdpb24uaG9yaXpvbnRhbDtcbiAgICAgIH1cblxuICAgICAgaWYgKF9hZGRpdGlvbmFsUGFyYW1zLnJlZ2lvbi52ZXJ0aWNhbCA+IDApIHtcbiAgICAgICAgX3ZlcnRpY2FsID0gX2FkZGl0aW9uYWxQYXJhbXMucmVnaW9uLnZlcnRpY2FsO1xuICAgICAgfVxuXG4gICAgICAvLyBBcHBseSBuZWdhdGl2ZSBtYXJnaW5zIGluIG9yZGVyIHRvIHNob3cgYSByZWdpb24uXG4gICAgICBpZiAoKGhvcml6b250YWwgIT09IDApIHx8IChfdmVydGljYWwgIT09IDApKSB7XG4gICAgICAgIG1hcmdpblN0eWxlID0gXCJtYXJnaW46IFwiICsgXCItXCIgKyBfdmVydGljYWwgKyBcInB4IDAgMCAtXCIgKyBob3Jpem9udGFsICsgXCJweDtcIjtcblxuICAgICAgICB2YXIgY3VycmVudFN0eWxlID0gZnJhbWUuZ2V0QXR0cmlidXRlKFwic3R5bGVcIik7XG4gICAgICAgIGlmIChjdXJyZW50U3R5bGUpIHtcbiAgICAgICAgICBtYXJnaW5TdHlsZSA9IGN1cnJlbnRTdHlsZSArIG1hcmdpblN0eWxlO1xuICAgICAgICB9XG5cbiAgICAgICAgZnJhbWUuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgbWFyZ2luU3R5bGUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIF9sb2FkRnJhbWUoKSB7XG4gICAgdmFyIGZyYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ3ZWJwYWdlLWZyYW1lXCIpLFxuICAgICAgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjb250YWluZXJcIik7XG5cbiAgICBpZiAoY29udGFpbmVyICYmIGZyYW1lKSB7XG4gICAgICBmcmFtZS5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZyYW1lLm9ubG9hZCA9IG51bGw7XG5cbiAgICAgICAgLy8gU2hvdyB0aGUgaWZyYW1lIGNvbnRhaW5lclxuICAgICAgICBjb250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9IFwidmlzaWJsZVwiO1xuICAgICAgfTtcblxuICAgICAgZnJhbWUuc2V0QXR0cmlidXRlKFwic3JjXCIsIF91cmwpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIF91bmxvYWRGcmFtZSgpIHtcbiAgICB2YXIgZnJhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIndlYnBhZ2UtZnJhbWVcIik7XG5cbiAgICBpZiAoZnJhbWUpIHtcbiAgICAgIGZyYW1lLnNyYyA9IFwiYWJvdXQ6YmxhbmtcIjtcbiAgICB9XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIF9pbml0KCkge1xuICAgIF9tZXNzYWdlID0gbmV3IFJpc2VWaXNpb24uQ29tbW9uLk1lc3NhZ2UoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjb250YWluZXJcIiksXG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1lc3NhZ2VDb250YWluZXJcIikpO1xuXG4gICAgLy8gQ29uZmlndXJlIHRoZSB2YWx1ZSBmb3IgX3VybFxuICAgIF91cmwgPSBfYWRkaXRpb25hbFBhcmFtcy51cmw7XG5cbiAgICAvLyBBZGQgaHR0cDovLyBpZiBubyBwcm90b2NvbCBwYXJhbWV0ZXIgZXhpc3RzXG4gICAgaWYgKF91cmwuaW5kZXhPZihcIjovL1wiKSA9PT0gLTEpIHtcbiAgICAgIF91cmwgPSBcImh0dHA6Ly9cIiArIF91cmw7XG4gICAgfVxuXG4gICAgX3ZhbGlkYXRlVXJsKGZ1bmN0aW9uKHN1Y2Nlc3MpIHtcbiAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgIF9jb25maWd1cmVQYWdlKCk7XG4gICAgICB9XG5cbiAgICAgIF9yZWFkeSgpO1xuICAgIH0pO1xuICB9XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBnZXRUYWJsZU5hbWUoKSB7XG4gICAgcmV0dXJuIFwid2VicGFnZV9ldmVudHNcIjtcbiAgfVxuXG4gIGZ1bmN0aW9uIGxvZ0V2ZW50KHBhcmFtcykge1xuICAgIFJpc2VWaXNpb24uQ29tbW9uLkxvZ2dlclV0aWxzLmxvZ0V2ZW50KGdldFRhYmxlTmFtZSgpLCBwYXJhbXMpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGF1c2UoKSB7XG4gICAgX3VubG9hZEZyYW1lKCk7XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5KCkge1xuICAgIF9sb2FkRnJhbWUoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgcGF1c2UoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNldEFkZGl0aW9uYWxQYXJhbXMoYWRkaXRpb25hbFBhcmFtcykge1xuICAgIF9hZGRpdGlvbmFsUGFyYW1zID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShhZGRpdGlvbmFsUGFyYW1zKSk7XG5cbiAgICBfaW5pdCgpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBcImdldFRhYmxlTmFtZVwiOiBnZXRUYWJsZU5hbWUsXG4gICAgXCJsb2dFdmVudFwiOiBsb2dFdmVudCxcbiAgICBcInNldEFkZGl0aW9uYWxQYXJhbXNcIjogc2V0QWRkaXRpb25hbFBhcmFtcyxcbiAgICBcInBhdXNlXCI6IHBhdXNlLFxuICAgIFwicGxheVwiOiBwbGF5LFxuICAgIFwic3RvcFwiOiBzdG9wXG4gIH07XG5cbn0pKGRvY3VtZW50LCBnYWRnZXRzKTtcblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5Db21tb24gPSBSaXNlVmlzaW9uLkNvbW1vbiB8fCB7fTtcblxuUmlzZVZpc2lvbi5Db21tb24uTWVzc2FnZSA9IGZ1bmN0aW9uIChtYWluQ29udGFpbmVyLCBtZXNzYWdlQ29udGFpbmVyKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBfYWN0aXZlID0gZmFsc2U7XG5cbiAgZnVuY3Rpb24gX2luaXQoKSB7XG4gICAgdHJ5IHtcbiAgICAgIG1lc3NhZ2VDb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gbWFpbkNvbnRhaW5lci5zdHlsZS5oZWlnaHQ7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY29uc29sZS53YXJuKFwiQ2FuJ3QgaW5pdGlhbGl6ZSBNZXNzYWdlIC0gXCIsIGUubWVzc2FnZSk7XG4gICAgfVxuICB9XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBoaWRlKCkge1xuICAgIGlmIChfYWN0aXZlKSB7XG4gICAgICAvLyBjbGVhciBjb250ZW50IG9mIG1lc3NhZ2UgY29udGFpbmVyXG4gICAgICB3aGlsZSAobWVzc2FnZUNvbnRhaW5lci5maXJzdENoaWxkKSB7XG4gICAgICAgIG1lc3NhZ2VDb250YWluZXIucmVtb3ZlQ2hpbGQobWVzc2FnZUNvbnRhaW5lci5maXJzdENoaWxkKTtcbiAgICAgIH1cblxuICAgICAgLy8gaGlkZSBtZXNzYWdlIGNvbnRhaW5lclxuICAgICAgbWVzc2FnZUNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cbiAgICAgIC8vIHNob3cgbWFpbiBjb250YWluZXJcbiAgICAgIG1haW5Db250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9IFwidmlzaWJsZVwiO1xuXG4gICAgICBfYWN0aXZlID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gc2hvdyhtZXNzYWdlKSB7XG4gICAgdmFyIGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLFxuICAgICAgcDtcblxuICAgIGlmICghX2FjdGl2ZSkge1xuICAgICAgLy8gaGlkZSBtYWluIGNvbnRhaW5lclxuICAgICAgbWFpbkNvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcblxuICAgICAgbWVzc2FnZUNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuXG4gICAgICAvLyBjcmVhdGUgbWVzc2FnZSBlbGVtZW50XG4gICAgICBwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XG4gICAgICBwLmlubmVySFRNTCA9IG1lc3NhZ2U7XG4gICAgICBwLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwibWVzc2FnZVwiKTtcblxuICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQocCk7XG4gICAgICBtZXNzYWdlQ29udGFpbmVyLmFwcGVuZENoaWxkKGZyYWdtZW50KTtcblxuICAgICAgX2FjdGl2ZSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIG1lc3NhZ2UgYWxyZWFkeSBiZWluZyBzaG93biwgdXBkYXRlIG1lc3NhZ2UgdGV4dFxuICAgICAgcCA9IG1lc3NhZ2VDb250YWluZXIucXVlcnlTZWxlY3RvcihcIi5tZXNzYWdlXCIpO1xuICAgICAgcC5pbm5lckhUTUwgPSBtZXNzYWdlO1xuICAgIH1cbiAgfVxuXG4gIF9pbml0KCk7XG5cbiAgcmV0dXJuIHtcbiAgICBcImhpZGVcIjogaGlkZSxcbiAgICBcInNob3dcIjogc2hvd1xuICB9O1xufTtcblxuLyogZ2xvYmFsIFJpc2VWaXNpb24sIGdhZGdldHMgKi9cblxuKGZ1bmN0aW9uICh3aW5kb3csIGRvY3VtZW50LCBnYWRnZXRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBpZCA9IG5ldyBnYWRnZXRzLlByZWZzKCkuZ2V0U3RyaW5nKFwiaWRcIik7XG5cbiAgLy8gRGlzYWJsZSBjb250ZXh0IG1lbnUgKHJpZ2h0IGNsaWNrIG1lbnUpXG4gIHdpbmRvdy5vbmNvbnRleHRtZW51ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBkb2N1bWVudC5ib2R5Lm9ubW91c2Vkb3duID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIGZ1bmN0aW9uIGNvbmZpZ3VyZShuYW1lcywgdmFsdWVzKSB7XG4gICAgdmFyIGFkZGl0aW9uYWxQYXJhbXMsXG4gICAgICBjb21wYW55SWQgPSBcIlwiLFxuICAgICAgZGlzcGxheUlkID0gXCJcIjtcblxuICAgIGlmIChBcnJheS5pc0FycmF5KG5hbWVzKSAmJiBuYW1lcy5sZW5ndGggPiAwICYmIEFycmF5LmlzQXJyYXkodmFsdWVzKSAmJiB2YWx1ZXMubGVuZ3RoID4gMCkge1xuICAgICAgLy8gY29tcGFueSBpZFxuICAgICAgaWYgKG5hbWVzWzBdID09PSBcImNvbXBhbnlJZFwiKSB7XG4gICAgICAgIGNvbXBhbnlJZCA9IHZhbHVlc1swXTtcbiAgICAgIH1cblxuICAgICAgLy8gZGlzcGxheSBpZFxuICAgICAgaWYgKG5hbWVzWzFdID09PSBcImRpc3BsYXlJZFwiKSB7XG4gICAgICAgIGlmICh2YWx1ZXNbMV0pIHtcbiAgICAgICAgICBkaXNwbGF5SWQgPSB2YWx1ZXNbMV07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgZGlzcGxheUlkID0gXCJwcmV2aWV3XCI7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gcHJvdmlkZSBMb2dnZXJVdGlscyB0aGUgaWRzIHRvIHVzZVxuICAgICAgUmlzZVZpc2lvbi5Db21tb24uTG9nZ2VyVXRpbHMuc2V0SWRzKGNvbXBhbnlJZCwgZGlzcGxheUlkKTtcblxuICAgICAgLy8gYWRkaXRpb25hbCBwYXJhbXNcbiAgICAgIGlmIChuYW1lc1syXSA9PT0gXCJhZGRpdGlvbmFsUGFyYW1zXCIpIHtcbiAgICAgICAgYWRkaXRpb25hbFBhcmFtcyA9IEpTT04ucGFyc2UodmFsdWVzWzJdKTtcblxuICAgICAgICBSaXNlVmlzaW9uLldlYlBhZ2Uuc2V0QWRkaXRpb25hbFBhcmFtcyhhZGRpdGlvbmFsUGFyYW1zKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5KCkge1xuICAgIFJpc2VWaXNpb24uV2ViUGFnZS5wbGF5KCk7XG4gIH1cblxuICBmdW5jdGlvbiBwYXVzZSgpIHtcbiAgICBSaXNlVmlzaW9uLldlYlBhZ2UucGF1c2UoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgUmlzZVZpc2lvbi5XZWJQYWdlLnN0b3AoKTtcbiAgfVxuXG4gIGlmIChpZCAmJiBpZCAhPT0gXCJcIikge1xuICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfcGxheV9cIiArIGlkLCBwbGF5KTtcbiAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3BhdXNlX1wiICsgaWQsIHBhdXNlKTtcbiAgICBnYWRnZXRzLnJwYy5yZWdpc3RlcihcInJzY21kX3N0b3BfXCIgKyBpZCwgc3RvcCk7XG4gICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc3BhcmFtX3NldF9cIiArIGlkLCBjb25maWd1cmUpO1xuICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc3BhcmFtX2dldFwiLCBudWxsLCBpZCwgW1wiY29tcGFueUlkXCIsIFwiZGlzcGxheUlkXCIsIFwiYWRkaXRpb25hbFBhcmFtc1wiXSk7XG4gIH1cblxufSkod2luZG93LCBkb2N1bWVudCwgZ2FkZ2V0cyk7XG5cblxuXG4vKiBqc2hpbnQgaWdub3JlOnN0YXJ0ICovXG52YXIgX2dhcSA9IF9nYXEgfHwgW107XG5cbl9nYXEucHVzaChbJ19zZXRBY2NvdW50JywgJ1VBLTU3MDkyMTU5LTYnXSk7XG5fZ2FxLnB1c2goWydfdHJhY2tQYWdldmlldyddKTtcblxuKGZ1bmN0aW9uKCkge1xuICB2YXIgZ2EgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsgZ2EudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnOyBnYS5hc3luYyA9IHRydWU7XG4gIGdhLnNyYyA9ICgnaHR0cHM6JyA9PSBkb2N1bWVudC5sb2NhdGlvbi5wcm90b2NvbCA/ICdodHRwczovL3NzbCcgOiAnaHR0cDovL3d3dycpICsgJy5nb29nbGUtYW5hbHl0aWNzLmNvbS9nYS5qcyc7XG4gIHZhciBzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpWzBdOyBzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGdhLCBzKTtcbn0pKCk7XG4vKiBqc2hpbnQgaWdub3JlOmVuZCAqL1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
