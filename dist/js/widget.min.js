var WIDGET_COMMON_CONFIG={AUTH_PATH_URL:"v1/widget/auth",LOGGER_CLIENT_ID:"1088527147109-6q1o2vtihn34292pjt4ckhmhck0rk0o7.apps.googleusercontent.com",LOGGER_CLIENT_SECRET:"nlZyrcPLg6oEwO9f9Wfn29Wh",LOGGER_REFRESH_TOKEN:"1/xzt4kwzE1H7W9VnKB8cAaCx6zb4Es4nKEoqaYHdTD15IgOrJDtdun6zK6XiATCKT",STORAGE_ENV:"prod",STORE_URL:"https://store-dot-rvaserver2.appspot.com/"},RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.LoggerUtils=function(){"use strict";function e(e,t){var o=null;e.event?(o=e,o.file_url&&(o.file_format=n(o.file_url)),o.company_id=a,o.display_id=s,t(o)):t(o)}function t(){var e=new Date,t=e.getUTCFullYear(),n=e.getUTCMonth()+1,o=e.getUTCDate();return 10>n&&(n="0"+n),10>o&&(o="0"+o),t+n+o}function n(e){var t,n=/[?#&]/;return e&&"string"==typeof e?(t=e.substr(e.lastIndexOf(".")+1),n.test(t)&&(t=t.substr(0,-1!==t.indexOf("?")?t.indexOf("?"):t.length),t=t.substr(0,-1!==t.indexOf("#")?t.indexOf("#"):t.length),t=t.substr(0,-1!==t.indexOf("&")?t.indexOf("&"):t.length)),t.toLowerCase()):null}function o(e){var n={kind:"bigquery#tableDataInsertAllRequest",skipInvalidRows:!1,ignoreUnknownValues:!1,templateSuffix:t(),rows:[{insertId:""}]},o=JSON.parse(JSON.stringify(n));return o.rows[0].insertId=Math.random().toString(36).substr(2).toUpperCase(),o.rows[0].json=JSON.parse(JSON.stringify(e)),o.rows[0].json.ts=(new Date).toISOString(),o}function r(t,n){e(n,function(e){null!==e&&RiseVision.Common.Logger.log(t,e)})}function i(e,t){a=e,s=t}var s="",a="";return{getInsertData:o,getFileFormat:n,logEvent:r,setIds:i}}(),RiseVision.Common.Logger=function(e){"use strict";function t(e){var t=new XMLHttpRequest;return new Date-c<358e4?e({}):(t.open("POST",r,!0),t.onloadend=function(){var n=JSON.parse(t.response);e({token:n.access_token,refreshedAt:new Date})},t.send(),void 0)}function n(e){return s&&l===e}function o(o,r){function g(t){var n,s,a=new XMLHttpRequest;s=i.replace("TABLE_ID",o),c=t.refreshedAt||c,u=t.token||u,n=e.getInsertData(r),a.open("POST",s,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Authorization","Bearer "+u),r.cb&&"function"==typeof r.cb&&(a.onloadend=function(){r.cb(a.response)}),a.send(JSON.stringify(n))}if(!(!o||!r||r.hasOwnProperty("event")&&!r.event||r.hasOwnProperty("event")&&n(r.event)))return s=!0,l=r.event,setTimeout(function(){s=!1},a),t(g)}var r="https://www.googleapis.com/oauth2/v3/token?client_id="+WIDGET_COMMON_CONFIG.LOGGER_CLIENT_ID+"&client_secret="+WIDGET_COMMON_CONFIG.LOGGER_CLIENT_SECRET+"&refresh_token="+WIDGET_COMMON_CONFIG.LOGGER_REFRESH_TOKEN+"&grant_type=refresh_token",i="https://www.googleapis.com/bigquery/v2/projects/client-side-events/datasets/Widget_Events/tables/TABLE_ID/insertAll",s=!1,a=1e3,l="",c=0,u="";return{log:o}}(RiseVision.Common.LoggerUtils),"undefined"!=typeof angular&&angular.module("risevision.common.i18n.config",[]).constant("LOCALES_PREFIX","locales/translation_").constant("LOCALES_SUFIX",".json");var config={STORAGE_ENV:"prod"},RiseVision=RiseVision||{};RiseVision.WebPage={},RiseVision.WebPage=function(e,t){"use strict";function n(){var t,n,o,r=e.getElementById("webpage-container"),i=e.getElementById("webpage-frame"),s=m.getInt("rsH")/m.getInt("rsW")*100,a=f.scrollHorizontal>0?f.scrollHorizontal:0,l=f.scrollVertical>0?f.scrollVertical:0,c=parseFloat(f.zoom);r&&i&&(t=r.getElementsByClassName("blocker")[0],r.style.visibility="hidden",0!==l&&(s+=l/m.getInt("rsW")*100),r.setAttribute("style","padding-bottom:"+s+"%"),t.style.display=f.interactive?"none":"block",i.setAttribute("scrolling",f.scrollbars?"yes":"no"),n="-ms-zoom:"+c+";-moz-transform: scale("+c+");-moz-transform-origin: 0 0;-o-transform: scale("+c+");-o-transform-origin: 0 0;-webkit-transform: scale("+c+");-webkit-transform-origin: 0 0;",n+="width: "+1/c*100+"%;height: "+1/c*100+"%;",i.setAttribute("style",n),(0!==a||0!==l)&&(o="margin: -"+l+"px 0 0 -"+a+"px;",i.setAttribute("style",n+o)))}function o(){var t=e.getElementById("webpage-frame"),n=e.getElementById("webpage-container"),r=/[?#&]/.test(p),i=Math.ceil(100*Math.random()),s=p;f.refresh>0&&(s=r?p+"&dummyVar="+i:p+"?dummyVar="+i),n&&t&&(t.onload=function(){t.onload=null,n.style.visibility="visible",f.refresh>0&&null===b&&(b=setInterval(function(){o()},f.refresh))},t.setAttribute("src",s))}function r(){var t=e.getElementById("webpage-frame");f.refresh>0&&clearInterval(b),t&&(t.src="about:blank")}function i(){t.rpc.call("","rsevent_ready",null,m.getString("id"),!0,!0,!0,!0,!1)}function s(){p=f.url,-1===p.indexOf("://")&&(p="http://"+p),n(),i()}function a(){return"webpage_events"}function l(e){RiseVision.Common.LoggerUtils.logEvent(a(),e)}function c(){r()}function u(){o()}function g(){r()}function d(e){m=new t.Prefs,f=e,y=new RiseVision.Common.Background(f),y.init(s)}var m=null,f={},p="",b=null,y=null;return{getTableName:a,logEvent:l,setAdditionalParams:d,pause:c,play:u,stop:g}}(document,gadgets);var RiseVision=RiseVision||{};RiseVision.Common=RiseVision.Common||{},RiseVision.Common.Background=function(e){"use strict";function t(){setTimeout(function(){a.style.backgroundImage="url("+e.background.image.url+g+"cb="+(new Date).getTime()+")",t()},c)}function n(){s=!0,e.background.useImage&&!u&&t(),i&&"function"==typeof i&&i()}function o(){var t;a=document.getElementById("background"),l=document.getElementById("backgroundStorage"),document.body.style.background=e.background.color,a?e.background.useImage?(a.className=e.background.image.position,a.className=e.background.image.scale?a.className+" scale-to-fit":a.className,u=0!==Object.keys(e.backgroundStorage).length,u?l?(l.addEventListener("rise-storage-response",function(e){s?e.detail&&e.detail.url&&e.detail.hasOwnProperty("changed")&&e.detail.changed&&(a.style.backgroundImage="url('"+e.detail.url.replace("'","\\'")+"')"):(e.detail&&e.detail.url&&(a.style.backgroundImage="url('"+e.detail.url.replace("'","\\'")+"')"),n())}),l.setAttribute("folder",e.backgroundStorage.folder),l.setAttribute("fileName",e.backgroundStorage.fileName),l.setAttribute("companyId",e.backgroundStorage.companyId),l.setAttribute("env",WIDGET_COMMON_CONFIG.STORAGE_ENV),l.go()):console.log("Missing element with id value of 'backgroundStorage'"):(t=e.background.image.url.split("?"),g=1===t.length?"?":"&",a.style.backgroundImage="url("+e.background.image.url+")",n())):n():console.log("Missing element with id value of 'background'")}function r(e){s?e&&"function"==typeof e&&e():(e&&(i=e),o())}var i=null,s=!1,a=null,l=null,c=9e5,u=!1,g="";return{init:r}},function(e,t,n){"use strict";function o(e,t){var n,o="",r="";Array.isArray(e)&&e.length>0&&Array.isArray(t)&&t.length>0&&("companyId"===e[0]&&(o=t[0]),"displayId"===e[1]&&(r=t[1]?t[1]:"preview"),RiseVision.Common.LoggerUtils.setIds(o,r),"additionalParams"===e[2]&&(n=JSON.parse(t[2]),RiseVision.WebPage.setAdditionalParams(n)))}function r(){RiseVision.WebPage.play()}function i(){RiseVision.WebPage.pause()}function s(){RiseVision.WebPage.stop()}function a(){e.removeEventListener("WebComponentsReady",a),l&&""!==l&&(n.rpc.register("rscmd_play_"+l,r),n.rpc.register("rscmd_pause_"+l,i),n.rpc.register("rscmd_stop_"+l,s),n.rpc.register("rsparam_set_"+l,o),n.rpc.call("","rsparam_get",null,l,["companyId","displayId","additionalParams"]))}var l=(new n.Prefs).getString("id");e.oncontextmenu=function(){return!1},t.body.onmousedown=function(){return!1},e.addEventListener("WebComponentsReady",a)}(window,document,gadgets);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-57092159-6"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3dpZGdldC5taW4uanMiXSwibmFtZXMiOlsiV0lER0VUX0NPTU1PTl9DT05GSUciLCJBVVRIX1BBVEhfVVJMIiwiTE9HR0VSX0NMSUVOVF9JRCIsIkxPR0dFUl9DTElFTlRfU0VDUkVUIiwiTE9HR0VSX1JFRlJFU0hfVE9LRU4iLCJTVE9SQUdFX0VOViIsIlNUT1JFX1VSTCIsIlJpc2VWaXNpb24iLCJDb21tb24iLCJMb2dnZXJVdGlscyIsImdldEV2ZW50UGFyYW1zIiwicGFyYW1zIiwiY2IiLCJqc29uIiwiZXZlbnQiLCJmaWxlX3VybCIsImZpbGVfZm9ybWF0IiwiZ2V0RmlsZUZvcm1hdCIsImNvbXBhbnlfaWQiLCJjb21wYW55SWQiLCJkaXNwbGF5X2lkIiwiZGlzcGxheUlkIiwiZ2V0U3VmZml4IiwiZGF0ZSIsIkRhdGUiLCJ5ZWFyIiwiZ2V0VVRDRnVsbFllYXIiLCJtb250aCIsImdldFVUQ01vbnRoIiwiZGF5IiwiZ2V0VVRDRGF0ZSIsInVybCIsInN0ciIsImhhc1BhcmFtcyIsInN1YnN0ciIsImxhc3RJbmRleE9mIiwidGVzdCIsImluZGV4T2YiLCJsZW5ndGgiLCJ0b0xvd2VyQ2FzZSIsImdldEluc2VydERhdGEiLCJCQVNFX0lOU0VSVF9TQ0hFTUEiLCJraW5kIiwic2tpcEludmFsaWRSb3dzIiwiaWdub3JlVW5rbm93blZhbHVlcyIsInRlbXBsYXRlU3VmZml4Iiwicm93cyIsImluc2VydElkIiwiZGF0YSIsIkpTT04iLCJwYXJzZSIsInN0cmluZ2lmeSIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInRvVXBwZXJDYXNlIiwidHMiLCJ0b0lTT1N0cmluZyIsImxvZ0V2ZW50IiwidGFibGUiLCJMb2dnZXIiLCJsb2ciLCJzZXRJZHMiLCJjb21wYW55IiwiZGlzcGxheSIsInV0aWxzIiwicmVmcmVzaFRva2VuIiwieGhyIiwiWE1MSHR0cFJlcXVlc3QiLCJyZWZyZXNoRGF0ZSIsIm9wZW4iLCJSRUZSRVNIX1VSTCIsIm9ubG9hZGVuZCIsInJlc3AiLCJyZXNwb25zZSIsInRva2VuIiwiYWNjZXNzX3Rva2VuIiwicmVmcmVzaGVkQXQiLCJzZW5kIiwiaXNUaHJvdHRsZWQiLCJ0aHJvdHRsZSIsImxhc3RFdmVudCIsInRhYmxlTmFtZSIsImluc2VydFdpdGhUb2tlbiIsInJlZnJlc2hEYXRhIiwiaW5zZXJ0RGF0YSIsInNlcnZpY2VVcmwiLCJyZXBsYWNlIiwic2V0UmVxdWVzdEhlYWRlciIsImhhc093blByb3BlcnR5Iiwic2V0VGltZW91dCIsInRocm90dGxlRGVsYXkiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uc3RhbnQiLCJjb25maWciLCJXZWJQYWdlIiwiZG9jdW1lbnQiLCJnYWRnZXRzIiwiX2NvbmZpZ3VyZVBhZ2UiLCJibG9ja2VyIiwiem9vbVN0eWxlIiwibWFyZ2luU3R5bGUiLCJjb250YWluZXIiLCJnZXRFbGVtZW50QnlJZCIsImZyYW1lIiwiYXNwZWN0UmF0aW8iLCJfcHJlZnMiLCJnZXRJbnQiLCJzY3JvbGxIb3JpelZhbCIsIl9hZGRpdGlvbmFsUGFyYW1zIiwic2Nyb2xsSG9yaXpvbnRhbCIsInNjcm9sbFZlcnRWYWwiLCJzY3JvbGxWZXJ0aWNhbCIsInpvb20iLCJwYXJzZUZsb2F0IiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsInN0eWxlIiwidmlzaWJpbGl0eSIsInNldEF0dHJpYnV0ZSIsIl9sb2FkRnJhbWUiLCJfdXJsIiwicmFuZG9tTnVtIiwiY2VpbCIsInJlZnJlc2hVUkwiLCJyZWZyZXNoIiwib25sb2FkIiwiX2ludGVydmFsSWQiLCJzZXRJbnRlcnZhbCIsIl91bmxvYWRGcmFtZSIsImNsZWFySW50ZXJ2YWwiLCJzcmMiLCJfcmVhZHkiLCJycGMiLCJjYWxsIiwiZ2V0U3RyaW5nIiwiX2JhY2tncm91bmRSZWFkeSIsImdldFRhYmxlTmFtZSIsInBhdXNlIiwicGxheSIsInN0b3AiLCJzZXRBZGRpdGlvbmFsUGFyYW1zIiwiUHJlZnMiLCJfYmFja2dyb3VuZCIsIkJhY2tncm91bmQiLCJpbml0IiwiX3JlZnJlc2hUaW1lciIsImJhY2tncm91bmRJbWFnZSIsImJhY2tncm91bmQiLCJpbWFnZSIsIl9zZXBhcmF0b3IiLCJnZXRUaW1lIiwiX3JlZnJlc2hEdXJhdGlvbiIsInVzZUltYWdlIiwiX2lzU3RvcmFnZUZpbGUiLCJfY2FsbGJhY2siLCJfY29uZmlndXJlIiwiX3N0b3JhZ2UiLCJib2R5IiwiY29sb3IiLCJjbGFzc05hbWUiLCJwb3NpdGlvbiIsInNjYWxlIiwiT2JqZWN0Iiwia2V5cyIsImJhY2tncm91bmRTdG9yYWdlIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJkZXRhaWwiLCJjaGFuZ2VkIiwiZm9sZGVyIiwiZmlsZU5hbWUiLCJnbyIsImNvbnNvbGUiLCJzcGxpdCIsIndpbmRvdyIsImNvbmZpZ3VyZSIsIm5hbWVzIiwidmFsdWVzIiwiYWRkaXRpb25hbFBhcmFtcyIsIkFycmF5IiwiaXNBcnJheSIsInBvbHltZXJSZWFkeSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJpZCIsInJlZ2lzdGVyIiwib25jb250ZXh0bWVudSIsIm9ubW91c2Vkb3duIiwiX2dhcSIsInB1c2giLCJnYSIsImNyZWF0ZUVsZW1lbnQiLCJ0eXBlIiwiYXN5bmMiLCJsb2NhdGlvbiIsInByb3RvY29sIiwicyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwicGFyZW50Tm9kZSIsImluc2VydEJlZm9yZSJdLCJtYXBwaW5ncyI6IkFBQ0EsR0FBSUEsdUJBQ0ZDLGNBQWUsaUJBQ2ZDLGlCQUFrQiw0RUFDbEJDLHFCQUFzQiwyQkFDdEJDLHFCQUFzQixxRUFDdEJDLFlBQWEsT0FDYkMsVUFBVyw2Q0FJVEMsV0FBYUEsY0FDakJBLFlBQVdDLE9BQVNELFdBQVdDLFdBRS9CRCxXQUFXQyxPQUFPQyxZQUFjLFdBQzlCLFlBVUEsU0FBU0MsR0FBZUMsRUFBUUMsR0FDOUIsR0FBSUMsR0FBTyxJQUdQRixHQUFPRyxPQUNURCxFQUFPRixFQUVIRSxFQUFLRSxXQUNQRixFQUFLRyxZQUFjQyxFQUFjSixFQUFLRSxXQUd4Q0YsRUFB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QkQsRUFBSTlDLEdBQzFDeEMsRUFBUW1DLElBQUlvRCxTQUFTLGNBQWdCRCxFQUFJNUMsR0FDekMxQyxFQUFRbUMsSUFBSW9ELFNBQVMsZUFBaUJELEVBQUlSLEdBQzFDOUUsRUFBUW1DLElBQUlDLEtBQUssR0FBSSxjQUFlLEtBQU1rRCxHQUFLLFlBQWEsWUFBYSxzQkFoRTdFLEdBQUlBLElBQUssR0FBSXRGLEdBQVE0QyxPQUFRUCxVQUFVLEtBR3ZDd0MsR0FBT1csY0FBZ0IsV0FDckIsT0FBTyxHQUdUekYsRUFBUzZELEtBQUs2QixZQUFjLFdBQzFCLE9BQU8sR0E0RFRaLEVBQU9ULGlCQUFpQixxQkFBc0JnQixJQUU3Q1AsT0FBUTlFLFNBQVVDLFFBS3JCLElBQUkwRixNQUFPQSxRQUVYQSxNQUFLQyxNQUFNLGNBQWUsa0JBQzFCRCxLQUFLQyxNQUFNLG1CQUVYLFdBQ0UsR0FBSUMsR0FBSzdGLFNBQVM4RixjQUFjLFNBQVdELEdBQUdFLEtBQU8sa0JBQW1CRixFQUFHRyxPQUFRLEVBQ25GSCxFQUFHM0QsS0FBTyxVQUFZbEMsU0FBU2lHLFNBQVNDLFNBQVcsY0FBZ0IsY0FBZ0IsNkJBQ25GLElBQUlDLEdBQUluRyxTQUFTb0cscUJBQXFCLFVBQVUsRUFBSUQsR0FBRUUsV0FBV0MsYUFBYVQsRUFBSU0iLCJmaWxlIjoianMvd2lkZ2V0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGV4cG9ydGVkIFdJREdFVF9DT01NT05fQ09ORklHICovXG52YXIgV0lER0VUX0NPTU1PTl9DT05GSUcgPSB7XG4gIEFVVEhfUEFUSF9VUkw6IFwidjEvd2lkZ2V0L2F1dGhcIixcbiAgTE9HR0VSX0NMSUVOVF9JRDogXCIxMDg4NTI3MTQ3MTA5LTZxMW8ydnRpaG4zNDI5MnBqdDRja2htaGNrMHJrMG83LmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tXCIsXG4gIExPR0dFUl9DTElFTlRfU0VDUkVUOiBcIm5sWnlyY1BMZzZvRXdPOWY5V2ZuMjlXaFwiLFxuICBMT0dHRVJfUkVGUkVTSF9UT0tFTjogXCIxL3h6dDRrd3pFMUg3VzlWbktCOGNBYUN4NnpiNEVzNG5LRW9xYVlIZFREMTVJZ09ySkR0ZHVuNnpLNlhpQVRDS1RcIixcbiAgU1RPUkFHRV9FTlY6IFwicHJvZFwiLFxuICBTVE9SRV9VUkw6IFwiaHR0cHM6Ly9zdG9yZS1kb3QtcnZhc2VydmVyMi5hcHBzcG90LmNvbS9cIlxufTtcbi8qIGdsb2JhbCBXSURHRVRfQ09NTU9OX0NPTkZJRyAqL1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLkNvbW1vbiA9IFJpc2VWaXNpb24uQ29tbW9uIHx8IHt9O1xuXG5SaXNlVmlzaW9uLkNvbW1vbi5Mb2dnZXJVdGlscyA9IChmdW5jdGlvbigpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgIHZhciBkaXNwbGF5SWQgPSBcIlwiLFxuICAgIGNvbXBhbnlJZCA9IFwiXCI7XG5cbiAgLypcbiAgICogIFByaXZhdGUgTWV0aG9kc1xuICAgKi9cblxuICAvKiBSZXRyaWV2ZSBwYXJhbWV0ZXJzIHRvIHBhc3MgdG8gdGhlIGV2ZW50IGxvZ2dlci4gKi9cbiAgZnVuY3Rpb24gZ2V0RXZlbnRQYXJhbXMocGFyYW1zLCBjYikge1xuICAgIHZhciBqc29uID0gbnVsbDtcblxuICAgIC8vIGV2ZW50IGlzIHJlcXVpcmVkLlxuICAgIGlmIChwYXJhbXMuZXZlbnQpIHtcbiAgICAgIGpzb24gPSBwYXJhbXM7XG5cbiAgICAgIGlmIChqc29uLmZpbGVfdXJsKSB7XG4gICAgICAgIGpzb24uZmlsZV9mb3JtYXQgPSBnZXRGaWxlRm9ybWF0KGpzb24uZmlsZV91cmwpO1xuICAgICAgfVxuXG4gICAgICBqc29uLmNvbXBhbnlfaWQgPSBjb21wYW55SWQ7XG4gICAgICBqc29uLmRpc3BsYXlfaWQgPSBkaXNwbGF5SWQ7XG5cbiAgICAgIGNiKGpzb24pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGNiKGpzb24pO1xuICAgIH1cbiAgfVxuXG4gIC8vIEdldCBzdWZmaXggZm9yIEJRIHRhYmxlIG5hbWUuXG4gIGZ1bmN0aW9uIGdldFN1ZmZpeCgpIHtcbiAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCksXG4gICAgICB5ZWFyID0gZGF0ZS5nZXRVVENGdWxsWWVhcigpLFxuICAgICAgbW9udGggPSBkYXRlLmdldFVUQ01vbnRoKCkgKyAxLFxuICAgICAgZGF5ID0gZGF0ZS5nZXRVVENEYXRlKCk7XG5cbiAgICBpZiAobW9udGggPCAxMCkge1xuICAgICAgbW9udGggPSBcIjBcIiArIG1vbnRoO1xuICAgIH1cblxuICAgIGlmIChkYXkgPCAxMCkge1xuICAgICAgZGF5ID0gXCIwXCIgKyBkYXk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHllYXIgKyBtb250aCArIGRheTtcbiAgfVxuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gZ2V0RmlsZUZvcm1hdCh1cmwpIHtcbiAgICB2YXIgaGFzUGFyYW1zID0gL1s/IyZdLyxcbiAgICAgIHN0cjtcblxuICAgIGlmICghdXJsIHx8IHR5cGVvZiB1cmwgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHN0ciA9IHVybC5zdWJzdHIodXJsLmxhc3RJbmRleE9mKFwiLlwiKSArIDEpO1xuXG4gICAgLy8gZG9uJ3QgaW5jbHVkZSBhbnkgcGFyYW1zIGFmdGVyIHRoZSBmaWxlbmFtZVxuICAgIGlmIChoYXNQYXJhbXMudGVzdChzdHIpKSB7XG4gICAgICBzdHIgPSBzdHIuc3Vic3RyKDAgLChzdHIuaW5kZXhPZihcIj9cIikgIT09IC0xKSA/IHN0ci5pbmRleE9mKFwiP1wiKSA6IHN0ci5sZW5ndGgpO1xuXG4gICAgICBzdHIgPSBzdHIuc3Vic3RyKDAsIChzdHIuaW5kZXhPZihcIiNcIikgIT09IC0xKSA/IHN0ci5pbmRleE9mKFwiI1wiKSA6IHN0ci5sZW5ndGgpO1xuXG4gICAgICBzdHIgPSBzdHIuc3Vic3RyKDAsIChzdHIuaW5kZXhPZihcIiZcIikgIT09IC0xKSA/IHN0ci5pbmRleE9mKFwiJlwiKSA6IHN0ci5sZW5ndGgpO1xuICAgIH1cblxuICAgIHJldHVybiBzdHIudG9Mb3dlckNhc2UoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldEluc2VydERhdGEocGFyYW1zKSB7XG4gICAgdmFyIEJBU0VfSU5TRVJUX1NDSEVNQSA9IHtcbiAgICAgIFwia2luZFwiOiBcImJpZ3F1ZXJ5I3RhYmxlRGF0YUluc2VydEFsbFJlcXVlc3RcIixcbiAgICAgIFwic2tpcEludmFsaWRSb3dzXCI6IGZhbHNlLFxuICAgICAgXCJpZ25vcmVVbmtub3duVmFsdWVzXCI6IGZhbHNlLFxuICAgICAgXCJ0ZW1wbGF0ZVN1ZmZpeFwiOiBnZXRTdWZmaXgoKSxcbiAgICAgIFwicm93c1wiOiBbe1xuICAgICAgICBcImluc2VydElkXCI6IFwiXCJcbiAgICAgIH1dXG4gICAgfSxcbiAgICBkYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShCQVNFX0lOU0VSVF9TQ0hFTUEpKTtcblxuICAgIGRhdGEucm93c1swXS5pbnNlcnRJZCA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyKS50b1VwcGVyQ2FzZSgpO1xuICAgIGRhdGEucm93c1swXS5qc29uID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShwYXJhbXMpKTtcbiAgICBkYXRhLnJvd3NbMF0uanNvbi50cyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcblxuICAgIHJldHVybiBkYXRhO1xuICB9XG5cbiAgZnVuY3Rpb24gbG9nRXZlbnQodGFibGUsIHBhcmFtcykge1xuICAgIGdldEV2ZW50UGFyYW1zKHBhcmFtcywgZnVuY3Rpb24oanNvbikge1xuICAgICAgaWYgKGpzb24gIT09IG51bGwpIHtcbiAgICAgICAgUmlzZVZpc2lvbi5Db21tb24uTG9nZ2VyLmxvZyh0YWJsZSwganNvbik7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKiBTZXQgdGhlIENvbXBhbnkgYW5kIERpc3BsYXkgSURzLiAqL1xuICBmdW5jdGlvbiBzZXRJZHMoY29tcGFueSwgZGlzcGxheSkge1xuICAgIGNvbXBhbnlJZCA9IGNvbXBhbnk7XG4gICAgZGlzcGxheUlkID0gZGlzcGxheTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJnZXRJbnNlcnREYXRhXCI6IGdldEluc2VydERhdGEsXG4gICAgXCJnZXRGaWxlRm9ybWF0XCI6IGdldEZpbGVGb3JtYXQsXG4gICAgXCJsb2dFdmVudFwiOiBsb2dFdmVudCxcbiAgICBcInNldElkc1wiOiBzZXRJZHNcbiAgfTtcbn0pKCk7XG5cblJpc2VWaXNpb24uQ29tbW9uLkxvZ2dlciA9IChmdW5jdGlvbih1dGlscykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgUkVGUkVTSF9VUkwgPSBcImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92My90b2tlbj9jbGllbnRfaWQ9XCIgKyBXSURHRVRfQ09NTU9OX0NPTkZJRy5MT0dHRVJfQ0xJRU5UX0lEICtcbiAgICAgIFwiJmNsaWVudF9zZWNyZXQ9XCIgKyBXSURHRVRfQ09NTU9OX0NPTkZJRy5MT0dHRVJfQ0xJRU5UX1NFQ1JFVCArXG4gICAgICBcIiZyZWZyZXNoX3Rva2VuPVwiICsgV0lER0VUX0NPTU1PTl9DT05GSUcuTE9HR0VSX1JFRlJFU0hfVE9LRU4gK1xuICAgICAgXCImZ3JhbnRfdHlwZT1yZWZyZXNoX3Rva2VuXCI7XG5cbiAgdmFyIHNlcnZpY2VVcmwgPSBcImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL2JpZ3F1ZXJ5L3YyL3Byb2plY3RzL2NsaWVudC1zaWRlLWV2ZW50cy9kYXRhc2V0cy9XaWRnZXRfRXZlbnRzL3RhYmxlcy9UQUJMRV9JRC9pbnNlcnRBbGxcIixcbiAgICB0aHJvdHRsZSA9IGZhbHNlLFxuICAgIHRocm90dGxlRGVsYXkgPSAxMDAwLFxuICAgIGxhc3RFdmVudCA9IFwiXCIsXG4gICAgcmVmcmVzaERhdGUgPSAwLFxuICAgIHRva2VuID0gXCJcIjtcblxuICAvKlxuICAgKiAgUHJpdmF0ZSBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiByZWZyZXNoVG9rZW4oY2IpIHtcbiAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cbiAgICBpZiAobmV3IERhdGUoKSAtIHJlZnJlc2hEYXRlIDwgMzU4MDAwMCkge1xuICAgICAgcmV0dXJuIGNiKHt9KTtcbiAgICB9XG5cbiAgICB4aHIub3BlbihcIlBPU1RcIiwgUkVGUkVTSF9VUkwsIHRydWUpO1xuICAgIHhoci5vbmxvYWRlbmQgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciByZXNwID0gSlNPTi5wYXJzZSh4aHIucmVzcG9uc2UpO1xuXG4gICAgICBjYih7IHRva2VuOiByZXNwLmFjY2Vzc190b2tlbiwgcmVmcmVzaGVkQXQ6IG5ldyBEYXRlKCkgfSk7XG4gICAgfTtcblxuICAgIHhoci5zZW5kKCk7XG4gIH1cblxuICBmdW5jdGlvbiBpc1Rocm90dGxlZChldmVudCkge1xuICAgIHJldHVybiB0aHJvdHRsZSAmJiAobGFzdEV2ZW50ID09PSBldmVudCk7XG4gIH1cblxuICAvKlxuICAgKiAgUHVibGljIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIGxvZyh0YWJsZU5hbWUsIHBhcmFtcykge1xuICAgIGlmICghdGFibGVOYW1lIHx8ICFwYXJhbXMgfHwgKHBhcmFtcy5oYXNPd25Qcm9wZXJ0eShcImV2ZW50XCIpICYmICFwYXJhbXMuZXZlbnQpIHx8XG4gICAgICAocGFyYW1zLmhhc093blByb3BlcnR5KFwiZXZlbnRcIikgJiYgaXNUaHJvdHRsZWQocGFyYW1zLmV2ZW50KSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aHJvdHRsZSA9IHRydWU7XG4gICAgbGFzdEV2ZW50ID0gcGFyYW1zLmV2ZW50O1xuXG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICB0aHJvdHRsZSA9IGZhbHNlO1xuICAgIH0sIHRocm90dGxlRGVsYXkpO1xuXG4gICAgZnVuY3Rpb24gaW5zZXJ0V2l0aFRva2VuKHJlZnJlc2hEYXRhKSB7XG4gICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCksXG4gICAgICAgIGluc2VydERhdGEsIHVybDtcblxuICAgICAgdXJsID0gc2VydmljZVVybC5yZXBsYWNlKFwiVEFCTEVfSURcIiwgdGFibGVOYW1lKTtcbiAgICAgIHJlZnJlc2hEYXRlID0gcmVmcmVzaERhdGEucmVmcmVzaGVkQXQgfHwgcmVmcmVzaERhdGU7XG4gICAgICB0b2tlbiA9IHJlZnJlc2hEYXRhLnRva2VuIHx8IHRva2VuO1xuICAgICAgaW5zZXJ0RGF0YSA9IHV0aWxzLmdldEluc2VydERhdGEocGFyYW1zKTtcblxuICAgICAgLy8gSW5zZXJ0IHRoZSBkYXRhLlxuICAgICAgeGhyLm9wZW4oXCJQT1NUXCIsIHVybCwgdHJ1ZSk7XG4gICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkNvbnRlbnQtVHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb25cIik7XG4gICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkF1dGhvcml6YXRpb25cIiwgXCJCZWFyZXIgXCIgKyB0b2tlbik7XG5cbiAgICAgIGlmIChwYXJhbXMuY2IgJiYgdHlwZW9mIHBhcmFtcy5jYiA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIHhoci5vbmxvYWRlbmQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICBwYXJhbXMuY2IoeGhyLnJlc3BvbnNlKTtcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgeGhyLnNlbmQoSlNPTi5zdHJpbmdpZnkoaW5zZXJ0RGF0YSkpO1xuICAgIH1cblxuICAgIHJldHVybiByZWZyZXNoVG9rZW4oaW5zZXJ0V2l0aFRva2VuKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJsb2dcIjogbG9nXG4gIH07XG59KShSaXNlVmlzaW9uLkNvbW1vbi5Mb2dnZXJVdGlscyk7XG4vKiBleHBvcnRlZCBjb25maWcgKi9cbmlmICh0eXBlb2YgYW5ndWxhciAhPT0gXCJ1bmRlZmluZWRcIikge1xuICBhbmd1bGFyLm1vZHVsZShcInJpc2V2aXNpb24uY29tbW9uLmkxOG4uY29uZmlnXCIsIFtdKVxuICAgIC5jb25zdGFudChcIkxPQ0FMRVNfUFJFRklYXCIsIFwibG9jYWxlcy90cmFuc2xhdGlvbl9cIilcbiAgICAuY29uc3RhbnQoXCJMT0NBTEVTX1NVRklYXCIsIFwiLmpzb25cIik7XG59XG5cbnZhciBjb25maWcgPSB7XG4gIFNUT1JBR0VfRU5WOiBcInByb2RcIlxufTtcblxuLyogZ2xvYmFsIGdhZGdldHMgKi9cblxudmFyIFJpc2VWaXNpb24gPSBSaXNlVmlzaW9uIHx8IHt9O1xuUmlzZVZpc2lvbi5XZWJQYWdlID0ge307XG5cblJpc2VWaXNpb24uV2ViUGFnZSA9IChmdW5jdGlvbiAoZG9jdW1lbnQsIGdhZGdldHMpIHtcblxuICBcInVzZSBzdHJpY3RcIjtcblxuICAvLyBwcml2YXRlIHZhcmlhYmxlc1xuICB2YXIgX3ByZWZzID0gbnVsbCxcbiAgICBfYWRkaXRpb25hbFBhcmFtcyA9IHt9LFxuICAgIF91cmwgPSBcIlwiLFxuICAgIF9pbnRlcnZhbElkID0gbnVsbCxcbiAgICBfYmFja2dyb3VuZCA9IG51bGw7XG5cbiAgLypcbiAgICogIFByaXZhdGUgTWV0aG9kc1xuICAgKi9cblxuICBmdW5jdGlvbiBfY29uZmlndXJlUGFnZSgpIHtcbiAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ3ZWJwYWdlLWNvbnRhaW5lclwiKSxcbiAgICAgIGZyYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ3ZWJwYWdlLWZyYW1lXCIpLFxuICAgICAgYXNwZWN0UmF0aW8gPSAgKF9wcmVmcy5nZXRJbnQoXCJyc0hcIikgLyBfcHJlZnMuZ2V0SW50KFwicnNXXCIpKSAqIDEwMCxcbiAgICAgIHNjcm9sbEhvcml6VmFsID0gKF9hZGRpdGlvbmFsUGFyYW1zLnNjcm9sbEhvcml6b250YWwgPiAwKSA/XG4gICAgICAgICAgX2FkZGl0aW9uYWxQYXJhbXMuc2Nyb2xsSG9yaXpvbnRhbCA6IDAsXG4gICAgICBzY3JvbGxWZXJ0VmFsID0gKF9hZGRpdGlvbmFsUGFyYW1zLnNjcm9sbFZlcnRpY2FsID4gMCkgP1xuICAgICAgICAgIF9hZGRpdGlvbmFsUGFyYW1zLnNjcm9sbFZlcnRpY2FsIDogMCxcbiAgICAgIHpvb20gPSBwYXJzZUZsb2F0KF9hZGRpdGlvbmFsUGFyYW1zLnpvb20pLFxuICAgICAgYmxvY2tlciwgem9vbVN0eWxlLCBtYXJnaW5TdHlsZTtcblxuICAgIGlmIChjb250YWluZXIgJiYgZnJhbWUpIHtcbiAgICAgIGJsb2NrZXIgPSBjb250YWluZXIuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcImJsb2NrZXJcIilbMF07XG5cbiAgICAgIC8vIEhpZGluZyBpZnJhbWUgY29udGFpbmVyLCB2aXNpYmxlIHdoZW4gdGhlIGlmcmFtZSBzdWNjZXNzZnVsbHkgbG9hZHNcbiAgICAgIGNvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcblxuICAgICAgLy8gc2V0IHRoZSBwYWRkaW5nLWJvdHRvbSB3aXRoIHRoZSBhc3BlY3QgcmF0aW8gJSAocmVzcG9uc2l2ZSlcbiAgICAgIGlmIChzY3JvbGxWZXJ0VmFsICE9PSAwKSB7XG4gICAgICAgIC8vIHJlY2FsY3VsYXRlIGFzcGVjdCByYXRpb1xuICAgICAgICBhc3BlY3RSYXRpbyArPSAoc2Nyb2xsVmVydFZhbCAvIF9wcmVmcy5nZXRJbnQoXCJyc1dcIikpICogMTAwO1xuICAgICAgfVxuICAgICAgY29udGFpbmVyLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwicGFkZGluZy1ib3R0b206XCIgKyBhc3BlY3RSYXRpbyArIFwiJVwiKTtcblxuICAgICAgLy8gQ29uZmlndXJlIGludGVyYWN0aXZpdHkgb2YgaWZyYW1lXG4gICAgICBibG9ja2VyLnN0eWxlLmRpc3BsYXkgPSAoX2FkZGl0aW9uYWxQYXJhbXMuaW50ZXJhY3RpdmUpID8gXCJub25lXCIgOiBcImJsb2NrXCI7XG4gICAgICBmcmFtZS5zZXRBdHRyaWJ1dGUoXCJzY3JvbGxpbmdcIixcbiAgICAgICAgKF9hZGRpdGlvbmFsUGFyYW1zLnNjcm9sbGJhcnMpID8gXCJ5ZXNcIiA6IFwibm9cIik7XG5cbiAgICAgIC8vIENvbmZpZ3VyZSB0aGUgem9vbSAoc2NhbGUpIHN0eWxpbmdcbiAgICAgIHpvb21TdHlsZSA9IFwiLW1zLXpvb206XCIgKyB6b29tICsgXCI7XCIgK1xuICAgICAgICBcIi1tb3otdHJhbnNmb3JtOiBzY2FsZShcIiArIHpvb20gKyBcIik7XCIgK1xuICAgICAgICBcIi1tb3otdHJhbnNmb3JtLW9yaWdpbjogMCAwO1wiICtcbiAgICAgICAgXCItby10cmFuc2Zvcm06IHNjYWxlKFwiICsgem9vbSArIFwiKTtcIiArXG4gICAgICAgIFwiLW8tdHJhbnNmb3JtLW9yaWdpbjogMCAwO1wiICtcbiAgICAgICAgXCItd2Via2l0LXRyYW5zZm9ybTogc2NhbGUoXCIgKyB6b29tICsgXCIpO1wiICtcbiAgICAgICAgXCItd2Via2l0LXRyYW5zZm9ybS1vcmlnaW46IDAgMDtcIjtcblxuICAgICAgem9vbVN0eWxlICs9IFwid2lkdGg6IFwiICsgKCgxIC8gem9vbSkgKiAxMDApICsgXCIlO1wiICtcbiAgICAgIFwiaGVpZ2h0OiBcIiArICgoMSAvIHpvb20pICogMTAwKSArIFwiJTtcIjtcblxuICAgICAgLy8gQXBwbHkgdGhlIHpvb20gKHNjYWxlKSBvbiB0aGUgaWZyYW1lXG4gICAgICBmcmFtZS5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCB6b29tU3R5bGUpO1xuXG4gICAgICBpZiAoc2Nyb2xsSG9yaXpWYWwgIT09IDAgfHwgc2Nyb2xsVmVydFZhbCAhPT0gMCkge1xuICAgICAgICAvLyBDb25maWd1cmUgdGhlIG1hcmdpbiBzdHlsaW5nXG4gICAgICAgIG1hcmdpblN0eWxlID0gXCJtYXJnaW46IFwiICsgXCItXCIgKyBzY3JvbGxWZXJ0VmFsICsgXCJweCAwIDAgLVwiICtcbiAgICAgICAgICBzY3JvbGxIb3JpelZhbCArIFwicHg7XCI7XG5cbiAgICAgICAgLyogQXBwbHkgdGhlIG1hcmdpbiBzdHlsaW5nIG9uIHRoZSBpZnJhbWUgd2hpbGUgbWFpbnRhaW5pbmdcbiAgICAgICAgIHRoZSB6b29tIHN0eWxpbmcgKi9cbiAgICAgICAgZnJhbWUuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgem9vbVN0eWxlICsgbWFyZ2luU3R5bGUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIF9sb2FkRnJhbWUoKSB7XG4gICAgdmFyIGZyYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ3ZWJwYWdlLWZyYW1lXCIpLFxuICAgICAgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ3ZWJwYWdlLWNvbnRhaW5lclwiKSxcbiAgICAgIGhhc1BhcmFtcyA9IC9bPyMmXS8udGVzdChfdXJsKSxcbiAgICAgIHJhbmRvbU51bSA9IE1hdGguY2VpbChNYXRoLnJhbmRvbSgpICogMTAwKSxcbiAgICAgIHJlZnJlc2hVUkwgPSBfdXJsO1xuXG4gICAgaWYgKF9hZGRpdGlvbmFsUGFyYW1zLnJlZnJlc2ggPiAwKSB7XG4gICAgICByZWZyZXNoVVJMID0gaGFzUGFyYW1zID9cbiAgICAgIF91cmwgKyBcIiZkdW1teVZhcj1cIiArIHJhbmRvbU51bSA6XG4gICAgICBfdXJsICsgXCI/ZHVtbXlWYXI9XCIgKyByYW5kb21OdW07XG4gICAgfVxuXG4gICAgaWYgKGNvbnRhaW5lciAmJiBmcmFtZSkge1xuICAgICAgZnJhbWUub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBmcmFtZS5vbmxvYWQgPSBudWxsO1xuXG4gICAgICAgIC8vIFNob3cgdGhlIGlmcmFtZSBjb250YWluZXJcbiAgICAgICAgY29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSBcInZpc2libGVcIjtcblxuICAgICAgICAvLyBSdW4gc2V0SW50ZXJ2YWwgdG8gcmVsb2FkIHBhZ2UgYmFzZWQgb24gdGhlIGRhdGEgcmVmcmVzaCB2YWx1ZVxuICAgICAgICBpZiAoX2FkZGl0aW9uYWxQYXJhbXMucmVmcmVzaCA+IDAgJiYgX2ludGVydmFsSWQgPT09IG51bGwpIHtcbiAgICAgICAgICBfaW50ZXJ2YWxJZCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF9sb2FkRnJhbWUoKTtcbiAgICAgICAgICB9LCBfYWRkaXRpb25hbFBhcmFtcy5yZWZyZXNoKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgZnJhbWUuc2V0QXR0cmlidXRlKFwic3JjXCIsIHJlZnJlc2hVUkwpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIF91bmxvYWRGcmFtZSgpIHtcbiAgICB2YXIgZnJhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIndlYnBhZ2UtZnJhbWVcIik7XG5cbiAgICBpZiAoX2FkZGl0aW9uYWxQYXJhbXMucmVmcmVzaCA+IDApIHtcbiAgICAgIGNsZWFySW50ZXJ2YWwoX2ludGVydmFsSWQpO1xuICAgIH1cblxuICAgIGlmIChmcmFtZSkge1xuICAgICAgZnJhbWUuc3JjID0gXCJhYm91dDpibGFua1wiO1xuICAgIH1cblxuICB9XG5cbiAgZnVuY3Rpb24gX3JlYWR5KCkge1xuICAgIGdhZGdldHMucnBjLmNhbGwoXCJcIiwgXCJyc2V2ZW50X3JlYWR5XCIsIG51bGwsIF9wcmVmcy5nZXRTdHJpbmcoXCJpZFwiKSxcbiAgICAgIHRydWUsIHRydWUsIHRydWUsIHRydWUsIGZhbHNlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9iYWNrZ3JvdW5kUmVhZHkoKSB7XG4gICAgLy8gQ29uZmlndXJlIHRoZSB2YWx1ZSBmb3IgX3VybFxuICAgIF91cmwgPSBfYWRkaXRpb25hbFBhcmFtcy51cmw7XG5cbiAgICAvLyBBZGQgaHR0cDovLyBpZiBubyBwcm90b2NvbCBwYXJhbWV0ZXIgZXhpc3RzXG4gICAgaWYgKF91cmwuaW5kZXhPZihcIjovL1wiKSA9PT0gLTEpIHtcbiAgICAgIF91cmwgPSBcImh0dHA6Ly9cIiArIF91cmw7XG4gICAgfVxuXG4gICAgX2NvbmZpZ3VyZVBhZ2UoKTtcbiAgICBfcmVhZHkoKTtcbiAgfVxuXG4gIC8qXG4gICAqICBQdWJsaWMgTWV0aG9kc1xuICAgKi9cbiAgZnVuY3Rpb24gZ2V0VGFibGVOYW1lKCkge1xuICAgIHJldHVybiBcIndlYnBhZ2VfZXZlbnRzXCI7XG4gIH1cblxuICBmdW5jdGlvbiBsb2dFdmVudChwYXJhbXMpIHtcbiAgICBSaXNlVmlzaW9uLkNvbW1vbi5Mb2dnZXJVdGlscy5sb2dFdmVudChnZXRUYWJsZU5hbWUoKSwgcGFyYW1zKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhdXNlKCkge1xuICAgIF91bmxvYWRGcmFtZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGxheSgpIHtcbiAgICBfbG9hZEZyYW1lKCk7XG4gIH1cblxuICBmdW5jdGlvbiBzdG9wKCkge1xuICAgIF91bmxvYWRGcmFtZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gc2V0QWRkaXRpb25hbFBhcmFtcyhwYXJhbXMpIHtcbiAgICBfcHJlZnMgPSBuZXcgZ2FkZ2V0cy5QcmVmcygpO1xuICAgIF9hZGRpdGlvbmFsUGFyYW1zID0gcGFyYW1zO1xuXG4gICAgLy8gY3JlYXRlIGFuZCBpbml0aWFsaXplIHRoZSBCYWNrZ3JvdW5kIGluc3RhbmNlXG4gICAgX2JhY2tncm91bmQgPSBuZXcgUmlzZVZpc2lvbi5Db21tb24uQmFja2dyb3VuZChfYWRkaXRpb25hbFBhcmFtcyk7XG4gICAgX2JhY2tncm91bmQuaW5pdChfYmFja2dyb3VuZFJlYWR5KTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgXCJnZXRUYWJsZU5hbWVcIjogZ2V0VGFibGVOYW1lLFxuICAgIFwibG9nRXZlbnRcIjogbG9nRXZlbnQsXG4gICAgXCJzZXRBZGRpdGlvbmFsUGFyYW1zXCI6IHNldEFkZGl0aW9uYWxQYXJhbXMsXG4gICAgXCJwYXVzZVwiOiBwYXVzZSxcbiAgICBcInBsYXlcIjogcGxheSxcbiAgICBcInN0b3BcIjogc3RvcFxuICB9O1xuXG59KShkb2N1bWVudCwgZ2FkZ2V0cyk7XG5cbi8qIGdsb2JhbCBXSURHRVRfQ09NTU9OX0NPTkZJRyAqL1xuXG52YXIgUmlzZVZpc2lvbiA9IFJpc2VWaXNpb24gfHwge307XG5SaXNlVmlzaW9uLkNvbW1vbiA9IFJpc2VWaXNpb24uQ29tbW9uIHx8IHt9O1xuXG5SaXNlVmlzaW9uLkNvbW1vbi5CYWNrZ3JvdW5kID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIF9jYWxsYmFjayA9IG51bGwsXG4gICAgX3JlYWR5ID0gZmFsc2UsXG4gICAgX2JhY2tncm91bmQgPSBudWxsLFxuICAgIF9zdG9yYWdlID0gbnVsbCxcbiAgICBfcmVmcmVzaER1cmF0aW9uID0gOTAwMDAwLCAvLyAxNSBtaW51dGVzXG4gICAgX2lzU3RvcmFnZUZpbGUgPSBmYWxzZSxcbiAgICBfc2VwYXJhdG9yID0gXCJcIjtcblxuICAvKlxuICAgKiBQcml2YXRlIE1ldGhvZHNcbiAgICovXG4gIGZ1bmN0aW9uIF9yZWZyZXNoVGltZXIoKSB7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbiBiYWNrZ3JvdW5kUmVmcmVzaCgpIHtcbiAgICAgIF9iYWNrZ3JvdW5kLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IFwidXJsKFwiICsgZGF0YS5iYWNrZ3JvdW5kLmltYWdlLnVybCArIF9zZXBhcmF0b3IgKyBcImNiPVwiICsgbmV3IERhdGUoKS5nZXRUaW1lKCkgKyBcIilcIjtcbiAgICAgIF9yZWZyZXNoVGltZXIoKTtcbiAgICB9LCBfcmVmcmVzaER1cmF0aW9uKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9iYWNrZ3JvdW5kUmVhZHkoKSB7XG4gICAgX3JlYWR5ID0gdHJ1ZTtcblxuICAgIGlmIChkYXRhLmJhY2tncm91bmQudXNlSW1hZ2UgJiYgIV9pc1N0b3JhZ2VGaWxlKSB7XG4gICAgICAvLyBzdGFydCB0aGUgcmVmcmVzaCBwb2xsIGZvciBub24tc3RvcmFnZSBiYWNrZ3JvdW5kIGltYWdlXG4gICAgICBfcmVmcmVzaFRpbWVyKCk7XG4gICAgfVxuXG4gICAgaWYgKF9jYWxsYmFjayAmJiB0eXBlb2YgX2NhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgIF9jYWxsYmFjaygpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIF9jb25maWd1cmUoKSB7XG4gICAgdmFyIHN0cjtcblxuICAgIF9iYWNrZ3JvdW5kID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJiYWNrZ3JvdW5kXCIpO1xuICAgIF9zdG9yYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJiYWNrZ3JvdW5kU3RvcmFnZVwiKTtcblxuICAgIC8vIHNldCB0aGUgZG9jdW1lbnQgYmFja2dyb3VuZFxuICAgIGRvY3VtZW50LmJvZHkuc3R5bGUuYmFja2dyb3VuZCA9IGRhdGEuYmFja2dyb3VuZC5jb2xvcjtcblxuICAgIGlmIChfYmFja2dyb3VuZCkge1xuICAgICAgaWYgKGRhdGEuYmFja2dyb3VuZC51c2VJbWFnZSkge1xuICAgICAgICBfYmFja2dyb3VuZC5jbGFzc05hbWUgPSBkYXRhLmJhY2tncm91bmQuaW1hZ2UucG9zaXRpb247XG4gICAgICAgIF9iYWNrZ3JvdW5kLmNsYXNzTmFtZSA9IGRhdGEuYmFja2dyb3VuZC5pbWFnZS5zY2FsZSA/IF9iYWNrZ3JvdW5kLmNsYXNzTmFtZSArIFwiIHNjYWxlLXRvLWZpdFwiXG4gICAgICAgICAgOiBfYmFja2dyb3VuZC5jbGFzc05hbWU7XG5cbiAgICAgICAgX2lzU3RvcmFnZUZpbGUgPSAoT2JqZWN0LmtleXMoZGF0YS5iYWNrZ3JvdW5kU3RvcmFnZSkubGVuZ3RoICE9PSAwKTtcblxuICAgICAgICBpZiAoIV9pc1N0b3JhZ2VGaWxlKSB7XG4gICAgICAgICAgc3RyID0gZGF0YS5iYWNrZ3JvdW5kLmltYWdlLnVybC5zcGxpdChcIj9cIik7XG5cbiAgICAgICAgICAvLyBzdG9yZSB0aGlzIGZvciB0aGUgcmVmcmVzaCB0aW1lclxuICAgICAgICAgIF9zZXBhcmF0b3IgPSAoc3RyLmxlbmd0aCA9PT0gMSkgPyBcIj9cIiA6IFwiJlwiO1xuXG4gICAgICAgICAgX2JhY2tncm91bmQuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gXCJ1cmwoXCIgKyBkYXRhLmJhY2tncm91bmQuaW1hZ2UudXJsICsgXCIpXCI7XG4gICAgICAgICAgX2JhY2tncm91bmRSZWFkeSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChfc3RvcmFnZSkge1xuICAgICAgICAgICAgLy8gUmlzZSBTdG9yYWdlXG4gICAgICAgICAgICBfc3RvcmFnZS5hZGRFdmVudExpc3RlbmVyKFwicmlzZS1zdG9yYWdlLXJlc3BvbnNlXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgIGlmICghX3JlYWR5KSB7XG4gICAgICAgICAgICAgICAgaWYgKGUuZGV0YWlsICYmIGUuZGV0YWlsLnVybCkge1xuICAgICAgICAgICAgICAgICAgLy8gRXNjYXBlIHNpbmdsZSBxdW90ZXMuXG4gICAgICAgICAgICAgICAgICBfYmFja2dyb3VuZC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybCgnXCIgKyBlLmRldGFpbC51cmwucmVwbGFjZShcIidcIiwgXCJcXFxcJ1wiKSArIFwiJylcIjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBfYmFja2dyb3VuZFJlYWR5KCk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGUuZGV0YWlsICYmIGUuZGV0YWlsLnVybCkge1xuICAgICAgICAgICAgICAgICAgLy8gY2hlY2sgZm9yIFwiY2hhbmdlZFwiIHByb3BlcnR5IGFuZCBlbnN1cmUgaXQgaXMgdHJ1ZVxuICAgICAgICAgICAgICAgICAgaWYgKGUuZGV0YWlsLmhhc093blByb3BlcnR5KFwiY2hhbmdlZFwiKSAmJiBlLmRldGFpbC5jaGFuZ2VkKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEVzY2FwZSBzaW5nbGUgcXVvdGVzLlxuICAgICAgICAgICAgICAgICAgICBfYmFja2dyb3VuZC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybCgnXCIgKyBlLmRldGFpbC51cmwucmVwbGFjZShcIidcIiwgXCJcXFxcJ1wiKSArIFwiJylcIjtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBfc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJmb2xkZXJcIiwgZGF0YS5iYWNrZ3JvdW5kU3RvcmFnZS5mb2xkZXIpO1xuICAgICAgICAgICAgX3N0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZmlsZU5hbWVcIiwgZGF0YS5iYWNrZ3JvdW5kU3RvcmFnZS5maWxlTmFtZSk7XG4gICAgICAgICAgICBfc3RvcmFnZS5zZXRBdHRyaWJ1dGUoXCJjb21wYW55SWRcIiwgZGF0YS5iYWNrZ3JvdW5kU3RvcmFnZS5jb21wYW55SWQpO1xuICAgICAgICAgICAgX3N0b3JhZ2Uuc2V0QXR0cmlidXRlKFwiZW52XCIsIFdJREdFVF9DT01NT05fQ09ORklHLlNUT1JBR0VfRU5WKTtcbiAgICAgICAgICAgIF9zdG9yYWdlLmdvKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiTWlzc2luZyBlbGVtZW50IHdpdGggaWQgdmFsdWUgb2YgJ2JhY2tncm91bmRTdG9yYWdlJ1wiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIF9iYWNrZ3JvdW5kUmVhZHkoKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5sb2coXCJNaXNzaW5nIGVsZW1lbnQgd2l0aCBpZCB2YWx1ZSBvZiAnYmFja2dyb3VuZCdcIik7XG4gICAgfVxuICB9XG5cbiAgLypcbiAgICogIFB1YmxpYyBNZXRob2RzXG4gICAqL1xuICBmdW5jdGlvbiBpbml0KGNiKSB7XG4gICAgaWYgKCFfcmVhZHkpIHtcbiAgICAgIGlmIChjYikge1xuICAgICAgICBfY2FsbGJhY2sgPSBjYjtcbiAgICAgIH1cblxuICAgICAgX2NvbmZpZ3VyZSgpO1xuXG4gICAgfSBlbHNlIGlmIChjYiAmJiB0eXBlb2YgY2IgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgY2IoKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIFwiaW5pdFwiOiBpbml0XG4gIH07XG59O1xuXG4vKiBnbG9iYWwgUmlzZVZpc2lvbiwgZ2FkZ2V0cyAqL1xuXG4oZnVuY3Rpb24gKHdpbmRvdywgZG9jdW1lbnQsIGdhZGdldHMpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIGlkID0gbmV3IGdhZGdldHMuUHJlZnMoKS5nZXRTdHJpbmcoXCJpZFwiKTtcblxuICAvLyBEaXNhYmxlIGNvbnRleHQgbWVudSAocmlnaHQgY2xpY2sgbWVudSlcbiAgd2luZG93Lm9uY29udGV4dG1lbnUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIGRvY3VtZW50LmJvZHkub25tb3VzZWRvd24gPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgZnVuY3Rpb24gY29uZmlndXJlKG5hbWVzLCB2YWx1ZXMpIHtcbiAgICB2YXIgYWRkaXRpb25hbFBhcmFtcyxcbiAgICAgIGNvbXBhbnlJZCA9IFwiXCIsXG4gICAgICBkaXNwbGF5SWQgPSBcIlwiO1xuXG4gICAgaWYgKEFycmF5LmlzQXJyYXkobmFtZXMpICYmIG5hbWVzLmxlbmd0aCA+IDAgJiYgQXJyYXkuaXNBcnJheSh2YWx1ZXMpICYmIHZhbHVlcy5sZW5ndGggPiAwKSB7XG4gICAgICAvLyBjb21wYW55IGlkXG4gICAgICBpZiAobmFtZXNbMF0gPT09IFwiY29tcGFueUlkXCIpIHtcbiAgICAgICAgY29tcGFueUlkID0gdmFsdWVzWzBdO1xuICAgICAgfVxuXG4gICAgICAvLyBkaXNwbGF5IGlkXG4gICAgICBpZiAobmFtZXNbMV0gPT09IFwiZGlzcGxheUlkXCIpIHtcbiAgICAgICAgaWYgKHZhbHVlc1sxXSkge1xuICAgICAgICAgIGRpc3BsYXlJZCA9IHZhbHVlc1sxXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBkaXNwbGF5SWQgPSBcInByZXZpZXdcIjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBwcm92aWRlIExvZ2dlclV0aWxzIHRoZSBpZHMgdG8gdXNlXG4gICAgICBSaXNlVmlzaW9uLkNvbW1vbi5Mb2dnZXJVdGlscy5zZXRJZHMoY29tcGFueUlkLCBkaXNwbGF5SWQpO1xuXG4gICAgICAvLyBhZGRpdGlvbmFsIHBhcmFtc1xuICAgICAgaWYgKG5hbWVzWzJdID09PSBcImFkZGl0aW9uYWxQYXJhbXNcIikge1xuICAgICAgICBhZGRpdGlvbmFsUGFyYW1zID0gSlNPTi5wYXJzZSh2YWx1ZXNbMl0pO1xuXG4gICAgICAgIFJpc2VWaXNpb24uV2ViUGFnZS5zZXRBZGRpdGlvbmFsUGFyYW1zKGFkZGl0aW9uYWxQYXJhbXMpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXkoKSB7XG4gICAgUmlzZVZpc2lvbi5XZWJQYWdlLnBsYXkoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhdXNlKCkge1xuICAgIFJpc2VWaXNpb24uV2ViUGFnZS5wYXVzZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RvcCgpIHtcbiAgICBSaXNlVmlzaW9uLldlYlBhZ2Uuc3RvcCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gcG9seW1lclJlYWR5KCkge1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwiV2ViQ29tcG9uZW50c1JlYWR5XCIsIHBvbHltZXJSZWFkeSk7XG5cbiAgICBpZiAoaWQgJiYgaWQgIT09IFwiXCIpIHtcbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfcGxheV9cIiArIGlkLCBwbGF5KTtcbiAgICAgIGdhZGdldHMucnBjLnJlZ2lzdGVyKFwicnNjbWRfcGF1c2VfXCIgKyBpZCwgcGF1c2UpO1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc2NtZF9zdG9wX1wiICsgaWQsIHN0b3ApO1xuICAgICAgZ2FkZ2V0cy5ycGMucmVnaXN0ZXIoXCJyc3BhcmFtX3NldF9cIiArIGlkLCBjb25maWd1cmUpO1xuICAgICAgZ2FkZ2V0cy5ycGMuY2FsbChcIlwiLCBcInJzcGFyYW1fZ2V0XCIsIG51bGwsIGlkLCBbXCJjb21wYW55SWRcIiwgXCJkaXNwbGF5SWRcIiwgXCJhZGRpdGlvbmFsUGFyYW1zXCJdKTtcbiAgICB9XG4gIH1cblxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcIldlYkNvbXBvbmVudHNSZWFkeVwiLCBwb2x5bWVyUmVhZHkpO1xuXG59KSh3aW5kb3csIGRvY3VtZW50LCBnYWRnZXRzKTtcblxuXG5cbi8qIGpzaGludCBpZ25vcmU6c3RhcnQgKi9cbnZhciBfZ2FxID0gX2dhcSB8fCBbXTtcblxuX2dhcS5wdXNoKFsnX3NldEFjY291bnQnLCAnVUEtNTcwOTIxNTktNiddKTtcbl9nYXEucHVzaChbJ190cmFja1BhZ2V2aWV3J10pO1xuXG4oZnVuY3Rpb24oKSB7XG4gIHZhciBnYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOyBnYS50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7IGdhLmFzeW5jID0gdHJ1ZTtcbiAgZ2Euc3JjID0gKCdodHRwczonID09IGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sID8gJ2h0dHBzOi8vc3NsJyA6ICdodHRwOi8vd3d3JykgKyAnLmdvb2dsZS1hbmFseXRpY3MuY29tL2dhLmpzJztcbiAgdmFyIHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0JylbMF07IHMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZ2EsIHMpO1xufSkoKTtcbi8qIGpzaGludCBpZ25vcmU6ZW5kICovXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
